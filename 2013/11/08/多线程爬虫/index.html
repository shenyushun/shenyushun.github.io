<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Hi!Roy!"><title>多线程爬虫 - Hi!Roy!</title><meta name="author" content="Roy"><link rel="icon" href="http://www.hi-roy.com/assets/images/favicon.ico"><link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml"><meta name="description" content="原文链接：http://www.dongwm.com/archives/pa-chong-lian-xi/正好最近学习多线程、爬虫相关的东西，这篇文章写的十分不错！"><meta name="keywords" content="python"><meta property="og:type" content="blog"><meta property="og:title" content="多线程爬虫"><meta property="og:url" content="http://www.hi-roy.com/2013/11/08/多线程爬虫/index.html"><meta property="og:site_name" content="Hi!Roy!"><meta property="og:description" content="原文链接：http://www.dongwm.com/archives/pa-chong-lian-xi/正好最近学习多线程、爬虫相关的东西，这篇文章写的十分不错！"><meta property="og:locale" content="zh-cn"><meta property="og:updated_time" content="2019-09-16T08:11:51.523Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="多线程爬虫"><meta name="twitter:description" content="原文链接：http://www.dongwm.com/archives/pa-chong-lian-xi/正好最近学习多线程、爬虫相关的东西，这篇文章写的十分不错！"><meta property="og:image" content="http://www.hi-roy.com/assets/images/my.jpg"><link rel="stylesheet" href="/assets/css/style-sxklfps8ywgfyyjcowvnb4gxdgt0zjts3hsguljmv9uqanxjbnitrovtbrek.min.css"><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?21513ec2bcd577b3297a1b16da82fa40";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></head><body><div id="blog"><header id="header" data-behavior="4"><i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i><div class="header-title"><a class="header-title-link" href="/">Hi!Roy!</a></div><a class="header-right-icon" href="#about"><i class="fa fa-lg fa-question"></i></a></header><nav id="sidebar" data-behavior="4"><div class="sidebar-container"><div class="sidebar-profile"><a href="/#about"><img class="sidebar-profile-picture" src="/assets/images/my.jpg" alt="作者的图片"></a><h4 class="sidebar-profile-name">Roy</h4><h5 class="sidebar-profile-bio"><p>君以国士待我，我必以国士报君。</p></h5></div><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="/"><i class="sidebar-button-icon fa fa-lg fa-home"></i> <span class="sidebar-button-desc">首页</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-categories"><i class="sidebar-button-icon fa fa-lg fa-bookmark"></i> <span class="sidebar-button-desc">分类</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-tags"><i class="sidebar-button-icon fa fa-lg fa-tags"></i> <span class="sidebar-button-desc">标签</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-archives"><i class="sidebar-button-icon fa fa-lg fa-archive"></i> <span class="sidebar-button-desc">归档</span></a></li><li class="sidebar-button"><a class="sidebar-button-link open-algolia-search" href="#search"><i class="sidebar-button-icon fa fa-lg fa-search"></i> <span class="sidebar-button-desc">搜索</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="#about"><i class="sidebar-button-icon fa fa-lg fa-question"></i> <span class="sidebar-button-desc">关于</span></a></li></ul><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="https://github.com/shenyushun" target="_blank" rel="noopener"><i class="sidebar-button-icon fa fa-lg fa-github"></i> <span class="sidebar-button-desc">GitHub</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="mailto:darkcooking@gmail.com" target="_blank" rel="noopener"><i class="sidebar-button-icon fa fa-lg fa-envelope-o"></i> <span class="sidebar-button-desc">邮箱</span></a></li></ul><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="/atom.xml"><i class="sidebar-button-icon fa fa-lg fa-rss"></i> <span class="sidebar-button-desc">RSS</span></a></li></ul></div></nav><div id="main" data-behavior="4" class="hasCoverMetaIn"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><div class="post-header main-content-wrap text-left"><h1 class="post-title" itemprop="headline">多线程爬虫</h1><div class="post-meta"><time itemprop="datePublished" datetime="2013-11-08T11:52:43+08:00">11月 08, 2013 </time><span>发布在 </span><a class="category-link" href="/source/all-categories/Python/">Python</a></div></div><div class="post-content markdown" itemprop="articleBody"><div class="main-content-wrap"><p>原文链接：<a href="http://www.dongwm.com/archives/pa-chong-lian-xi/" target="_blank" rel="noopener">http://www.dongwm.com/archives/pa-chong-lian-xi/</a></p><p>正好最近学习多线程、爬虫相关的东西，这篇文章写的十分不错！</p><a id="more"></a><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="keyword">import</span> Queue</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> traceback</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> lxml</span><br><span class="line"><span class="keyword">import</span> chardet</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> logging.handlers</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">from</span> urlparse <span class="keyword">import</span> urlparse</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">from</span> optparse <span class="keyword">import</span> OptionParser</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">from</span> sqlite3 <span class="keyword">import</span> dbapi2 <span class="keyword">as</span> sqlite</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="keyword">from</span> pysqlite2 <span class="keyword">import</span> dbapi2 <span class="keyword">as</span> sqlite</span><br><span class="line"><span class="comment">#__doc__注释  执行脚本 -h 或者 --help  打印输出的内容</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">This script is used to crawl analyzing web!</span></span><br><span class="line"><span class="string">The Feature:</span></span><br><span class="line"><span class="string">1 可以指定抓取的深度</span></span><br><span class="line"><span class="string">2 将抓取到的关键字数据存放在sqlite</span></span><br><span class="line"><span class="string">3 使用logging记录日志</span></span><br><span class="line"><span class="string">4 并发线程池</span></span><br><span class="line"><span class="string">Required dependencies:</span></span><br><span class="line"><span class="string">1 chardet #分析抓取页面的字符集</span></span><br><span class="line"><span class="string">sudo easy_install chardet</span></span><br><span class="line"><span class="string">Usage:</span></span><br><span class="line"><span class="string">spider.py -u url -d deep -f logfile -l loglevel(1-5)  --testself -thread number --dbfile  filepath  --key=”HTML5”</span></span><br><span class="line"><span class="string">Writer: Dongweiming</span></span><br><span class="line"><span class="string">Date: 2012.10.22</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">lock = threading.Lock() <span class="comment">#设置线程锁</span></span><br><span class="line">LOGGER = logging.getLogger(<span class="string">'Crawler'</span>) <span class="comment">#设置logging模块的前缀</span></span><br><span class="line">LEVELS=&#123;   <span class="comment">#日志级别</span></span><br><span class="line">        <span class="number">1</span>:<span class="string">'CRITICAL'</span>,</span><br><span class="line">        <span class="number">2</span>:<span class="string">'ERROR'</span>,</span><br><span class="line">        <span class="number">3</span>:<span class="string">'WARNING'</span>,</span><br><span class="line">        <span class="number">4</span>:<span class="string">'INFO'</span>,</span><br><span class="line">        <span class="number">5</span>:<span class="string">'DEBUG'</span>,<span class="comment">#数字越大记录越详细</span></span><br><span class="line">        &#125;</span><br><span class="line">formatter = logging.Formatter(<span class="string">'%(name)s %(asctime)s %(levelname)s %(message)s'</span>) <span class="comment">#自定义日志格式</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">mySqlite</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, path, logger, level)</span>:</span></span><br><span class="line">        <span class="string">'''初始化数据库连接.</span></span><br><span class="line"><span class="string">            from sqlite3 import dbapi2 as sqlite</span></span><br><span class="line"><span class="string">            conn = sqlite.connect('testdb')</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.conn = sqlite.connect(path) <span class="comment">#连接sqlite</span></span><br><span class="line">            self.cur = self.conn.cursor()  <span class="comment">#cursor是一个记录游标，用于一行一行迭代的访问查询返回的结果</span></span><br><span class="line">        <span class="keyword">except</span> Exception, e:</span><br><span class="line">            myLogger(logger, self.loglevel, e, <span class="literal">True</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">        self.logger = logger</span><br><span class="line">        self.loglevel = level</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(self, table)</span>:</span></span><br><span class="line">        <span class="string">'''创建table，我这里创建包含2个段 ID（数字型，自增长），Data（char 128字符）'''</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.cur.execute(<span class="string">"CREATE TABLE IF NOT EXISTS %s(Id INTEGER PRIMARY KEY AUTOINCREMENT, Data VARCHAR(40))"</span>% table)</span><br><span class="line">            self.done()</span><br><span class="line">        <span class="keyword">except</span> sqlite.Error ,e: <span class="comment">#异常记录日志并且做事务回滚,以下相同</span></span><br><span class="line">            myLogger(self.logger, self.loglevel, e, <span class="literal">True</span>)</span><br><span class="line">            self.conn.rollback()</span><br><span class="line">        <span class="keyword">if</span> self.loglevel <span class="number">3</span>: <span class="comment">#设置在日志级别较高才记录,这样级别高的详细</span></span><br><span class="line">                myLogger(self.logger, self.loglevel, <span class="string">'创建表%s'</span> % table)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self, table, data)</span>:</span></span><br><span class="line">        <span class="string">'''插入数据，指定表名，设置data的数据'''</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.cur.execute(<span class="string">"INSERT INTO %s(Data) VALUES('%s')"</span> % (table,data))</span><br><span class="line">            self.done()</span><br><span class="line">        <span class="keyword">except</span> sqlite.Error ,e:</span><br><span class="line">            myLogger(self.logger, self.loglevel, e, <span class="literal">True</span>)</span><br><span class="line">            self.conn.rollback()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> self.loglevel <span class="number">4</span>:</span><br><span class="line">                myLogger(self.logger, self.loglevel, <span class="string">'插入数据成功'</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">done</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">'''事务提交'''</span></span><br><span class="line">        self.conn.commit()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">'''关闭连接'''</span></span><br><span class="line">        self.cur.close()</span><br><span class="line">        self.conn.close()</span><br><span class="line">        <span class="keyword">if</span> self.loglevel <span class="number">3</span>:</span><br><span class="line">            myLogger(self.logger, self.loglevel, <span class="string">'关闭sqlite操作'</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Crawler</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, args, app, table, logger)</span>:</span></span><br><span class="line">        self.deep = args.depth  <span class="comment">#指定网页的抓取深度        </span></span><br><span class="line">        self.url = args.urlpth <span class="comment">#指定网站地址</span></span><br><span class="line">        self.key = args.key <span class="comment">#要搜索的关键字</span></span><br><span class="line">        self.logfile = args.logfile <span class="comment">#日志文件路径和名字</span></span><br><span class="line">        self.loglevel = args.loglevel <span class="comment">#日志级别</span></span><br><span class="line">        self.dbpth = args.dbpth <span class="comment">#指定sqlite数据文件路径和名字</span></span><br><span class="line">        self.tp = app <span class="comment">#连接池回调实例</span></span><br><span class="line">        self.table = table <span class="comment">#每次请求的table不同</span></span><br><span class="line">        self.logger = logger <span class="comment">#logging模块实例</span></span><br><span class="line">        self.visitedUrl = [] <span class="comment">#抓取的网页放入列表,防止重复抓取</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_hasCrawler</span><span class="params">(self, url)</span>:</span></span><br><span class="line">        <span class="string">'''判断是否已经抓取过这个页面'''</span></span><br><span class="line">        <span class="keyword">return</span> (<span class="literal">True</span> <span class="keyword">if</span> url <span class="keyword">in</span> self.visitedUrl <span class="keyword">else</span> <span class="literal">False</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getPageSource</span><span class="params">(self, url, key, deep)</span>:</span></span><br><span class="line">        <span class="string">''' 抓取页面,分析,入库.</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        headers = &#123;  <span class="comment">#设计一个用户代理,更好防止被认为是爬虫</span></span><br><span class="line">            <span class="string">'User-Agent'</span>:<span class="string">'Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US;</span></span><br><span class="line"><span class="string">            rv:1.9.1.6) Gecko/20091201 Firefox/3.5.6'</span> &#125;</span><br><span class="line">        <span class="keyword">if</span> self._hasCrawler(url): <span class="comment">#发现重复直接return</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.visitedUrl.append(url) <span class="comment">#发现新地址假如到这个列表</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            request = urllib2.Request(url = url, headers = headers) <span class="comment">#创建一个访问请求,指定url,并且把访问请求保存在request</span></span><br><span class="line">            result = urllib2.urlopen(request).read() <span class="comment">#打开这个请求,并保存读取数据</span></span><br><span class="line">        <span class="keyword">except</span> urllib2.HTTPError, e:  <span class="comment">#触发http异常记录日志并返回</span></span><br><span class="line">            myLogger(self.logger, self.loglevel, e, <span class="literal">True</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            encoding = chardet.detect(result)[<span class="string">'encoding'</span>] <span class="comment">#判断页面的编码</span></span><br><span class="line">            <span class="keyword">if</span> encoding.lower() == <span class="string">'gb2312'</span>:</span><br><span class="line">                encoding = <span class="string">'gbk'</span>  <span class="comment">#今天我抓取新浪是gb2312,但是其中有个'蔡旻佑'不能被识别,所以用gbk去解码gb2312的页面</span></span><br><span class="line">            <span class="keyword">if</span> encoding.lower() != <span class="string">'utf-8'</span>: <span class="comment">#发现不是默认编码就用应该的类型解码</span></span><br><span class="line">                result = result.decode(encoding)</span><br><span class="line">        <span class="keyword">except</span> Exception, e:</span><br><span class="line">            myLogger(self.logger, self.loglevel, e, <span class="literal">True</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> self.loglevel <span class="number">3</span>:</span><br><span class="line">                myLogger(self.logger, self.loglevel, <span class="string">'抓取网页 %s 成功'</span> % url)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self._xpath(url, result, [<span class="string">'a'</span>], unicode(key, <span class="string">'utf8'</span>), deep) <span class="comment">#分析页面中的连接地址,以及它的内容</span></span><br><span class="line">            self._xpath(url, result, [<span class="string">'title'</span>, <span class="string">'p'</span>, <span class="string">'li'</span>, <span class="string">'div'</span>], unicode(key, <span class="string">"utf8"</span>), deep) <span class="comment">#分析这几个标签的内容</span></span><br><span class="line">        <span class="keyword">except</span> TypeError: <span class="comment">#对编码类型异常处理,有些深度页面和主页的编码不同</span></span><br><span class="line">            self._xpath(url, result, [<span class="string">'a'</span>], key, deep)</span><br><span class="line">            self._xpath(url, result, [<span class="string">'title'</span>, <span class="string">'p'</span>, <span class="string">'li'</span>, <span class="string">'div'</span>], key, deep)</span><br><span class="line">        <span class="keyword">except</span> Exception, e:</span><br><span class="line">            myLogger(self.logger, self.loglevel, e, <span class="literal">True</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> self.loglevel <span class="number">3</span>:</span><br><span class="line">                myLogger(self.logger, self.loglevel, <span class="string">'分析网页 %s 成功'</span> % url)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_xpath</span><span class="params">(self, weburl, data, xpath, key, deep)</span>:</span></span><br><span class="line">        sq = mySqlite(self.dbpth, self.logger, self.loglevel)</span><br><span class="line">        page = etree.HTML(data)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xpath:</span><br><span class="line">            hrefs = page.xpath(<span class="string">u"//%s"</span> % i) <span class="comment">#根据xpath标签</span></span><br><span class="line">            <span class="keyword">if</span> deep <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">for</span> href <span class="keyword">in</span> hrefs:</span><br><span class="line">                    url = href.attrib.get(<span class="string">'href'</span>,<span class="string">''</span>)</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> url.startswith(<span class="string">'java'</span>) <span class="keyword">and</span> <span class="keyword">not</span>  </span><br><span class="line">                        url.startswith(<span class="string">'mailto'</span>):  <span class="comment">#过滤javascript和发送邮件的链接</span></span><br><span class="line">                            self.tp.add_job(self.getPageSource,url, key, deep<span class="number">-1</span>) <span class="comment">#递归调用,直到符合的深度</span></span><br><span class="line">            <span class="keyword">for</span> href <span class="keyword">in</span> hrefs:</span><br><span class="line">                value = href.text  <span class="comment">#抓取相应标签的内容</span></span><br><span class="line">                <span class="keyword">if</span> value:</span><br><span class="line">                    m = re.compile(<span class="string">r'.*%s.*'</span> % key).match(value) <span class="comment">#根据key匹配相应内容</span></span><br><span class="line">                    <span class="keyword">if</span> m:</span><br><span class="line">                        sq.insert(self.table, m.group().strip()) <span class="comment">#将匹配的数据插入到sqlite</span></span><br><span class="line">        sq.close()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">work</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">'''主方法调用.</span></span><br><span class="line"><span class="string">         import datetime</span></span><br><span class="line"><span class="string">         logger = configLogger('test.log')</span></span><br><span class="line"><span class="string">         time = datetime.datetime.now().strftime("%m%d%H%M%S")</span></span><br><span class="line"><span class="string">         sq = mySqlite('test.db', logger, 1)</span></span><br><span class="line"><span class="string">         table = 'd' + str(time)</span></span><br><span class="line"><span class="string">         sq.create(table)</span></span><br><span class="line"><span class="string">         tp = ThreadPool(5)</span></span><br><span class="line"><span class="string">         def t():pass</span></span><br><span class="line"><span class="string">         t.depth=1</span></span><br><span class="line"><span class="string">         t.urlpth='http://www.baidu.com'</span></span><br><span class="line"><span class="string">         t.logfile = 'test.log'</span></span><br><span class="line"><span class="string">         t.loglevel = 1</span></span><br><span class="line"><span class="string">         t.dbpth = 'test.db'</span></span><br><span class="line"><span class="string">         t.key = 'test'</span></span><br><span class="line"><span class="string">         d = Crawler(t, tp, table, logger)</span></span><br><span class="line"><span class="string">         d.getPageSource(t.urlpth, t.key, t.depth)</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.url.startswith(<span class="string">'http://'</span>): <span class="comment">#支持用户直接写域名,当然也支持带前缀</span></span><br><span class="line">            self.url = <span class="string">'http://'</span> + self.url</span><br><span class="line">        self.tp.add_job(self.getPageSource, self.url, self.key, self.deep)</span><br><span class="line">        self.tp.wait_for_complete() <span class="comment">#等待线程池完成</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span><span class="params">(threading.Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, workQueue, timeout=<span class="number">30</span>, **kwargs)</span>:</span></span><br><span class="line">        threading.Thread.__init__(self, kwargs=kwargs)</span><br><span class="line">        self.timeout = timeout <span class="comment">#线程在结束前等待任务队列多长时间</span></span><br><span class="line">        self.setDaemon(<span class="literal">True</span>)  <span class="comment">#设置deamon,表示主线程死掉,子线程不跟随死掉</span></span><br><span class="line">        self.workQueue = workQueue</span><br><span class="line">        self.start() <span class="comment">#初始化直接启动线程</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">'''重载run方法'''</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                lock.acquire()   <span class="comment">#线程安全上锁</span></span><br><span class="line">                callable, args = self.workQueue.get(timeout=self.timeout) <span class="comment">#从工作队列中获取一个任务</span></span><br><span class="line">                res = callable(*args)  <span class="comment">#执行的任务</span></span><br><span class="line">                lock.release()  <span class="comment">#执行完,释放锁</span></span><br><span class="line">            <span class="keyword">except</span> Queue.Empty: <span class="comment">#任务队列空的时候结束此线程</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span> Exception, e:</span><br><span class="line">                myLogger(self.logger, self.loglevel, e, <span class="literal">True</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadPool</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, num_of_threads)</span>:</span></span><br><span class="line">         self.workQueue = Queue.Queue()</span><br><span class="line">         self.threads = []</span><br><span class="line">         self.__createThreadPool(num_of_threads)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__createThreadPool</span><span class="params">(self, num_of_threads)</span>:</span></span><br><span class="line">         <span class="keyword">for</span> i <span class="keyword">in</span> range(num_of_threads):</span><br><span class="line">             thread = MyThread(self.workQueue)</span><br><span class="line">             self.threads.append(thread)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wait_for_complete</span><span class="params">(self)</span>:</span></span><br><span class="line">         <span class="string">'''等待所有线程完成'''</span></span><br><span class="line">         <span class="keyword">while</span> len(self.threads):</span><br><span class="line">             thread = self.threads.pop()</span><br><span class="line">         <span class="keyword">if</span> thread.isAlive():  <span class="comment">#判断线程是否还存活来决定是否调用join</span></span><br><span class="line">             thread.join()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_job</span><span class="params">( self, callable, *args)</span>:</span></span><br><span class="line">        <span class="string">'''增加任务,放到队列里面'''</span></span><br><span class="line">        self.workQueue.put((callable, args))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">configLogger</span><span class="params">(logfile)</span>:</span></span><br><span class="line">    <span class="string">'''配置日志文件和记录等级'''</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        handler = logging.handlers.RotatingFileHandler(logfile,</span><br><span class="line">                                                       maxBytes=<span class="number">10240000</span>, <span class="comment">#文件最大字节数</span></span><br><span class="line">                                                       backupCount=<span class="number">5</span>, <span class="comment">#会轮转5个文件，共6个</span></span><br><span class="line">                                                        )</span><br><span class="line">    <span class="keyword">except</span> IOError, e:</span><br><span class="line">        <span class="keyword">print</span> e</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        handler.setFormatter(formatter)  <span class="comment">#设置日志格式</span></span><br><span class="line">        LOGGER.addHandler(handler) <span class="comment">#增加处理器</span></span><br><span class="line">        logging.basicConfig(level=logging.NOTSET) <span class="comment">#设置,不打印小于4级别的日志</span></span><br><span class="line">    <span class="keyword">return</span> LOGGER <span class="comment">#返回logging实例</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">myLogger</span><span class="params">(logger, lv, mes, err=False)</span>:</span></span><br><span class="line">    <span class="string">'''记录日志函数'''</span></span><br><span class="line">    getattr(logger, LEVELS.get(lv, <span class="string">'WARNING'</span>).lower())(mes)</span><br><span class="line">    <span class="keyword">if</span> err: <span class="comment">#当发现是错误日志,还会记录错误的堆栈信息</span></span><br><span class="line">        getattr(logger, LEVELS.get(lv, <span class="string">'WARNING'</span>).lower())(traceback.format_exc())</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">()</span>:</span></span><br><span class="line">    parser = OptionParser(</span><br><span class="line">                  description=<span class="string">"This script is used to crawl analyzing web!"</span>)</span><br><span class="line">    parser.add_option(<span class="string">"-u"</span>, <span class="string">"--url"</span>, dest=<span class="string">"urlpth"</span>, action=<span class="string">"store"</span>,</span><br><span class="line">                  help=<span class="string">"Path you want to fetch"</span>, metavar=<span class="string">"www.sina.com.cn"</span>)</span><br><span class="line">    parser.add_option(<span class="string">"-d"</span>, <span class="string">"--deep"</span>, dest=<span class="string">"depth"</span>, action=<span class="string">"store"</span>,type=<span class="string">"int"</span>,</span><br><span class="line">                  help=<span class="string">"Url path's deep, default 1"</span>, default=<span class="number">1</span>)</span><br><span class="line">    parser.add_option(<span class="string">"-k"</span>, <span class="string">"--key"</span>, dest=<span class="string">"key"</span>, action=<span class="string">"store"</span>,</span><br><span class="line">                  help=<span class="string">"You want to query keywords, For example 'test'"</span>)</span><br><span class="line">    parser.add_option(<span class="string">"-f"</span>, <span class="string">"--file"</span>, dest=<span class="string">"logfile"</span>, action=<span class="string">"store"</span>,</span><br><span class="line">                  help=<span class="string">"Record log file path and name, default spider.log"</span>,</span><br><span class="line">                  default=<span class="string">'spider.log'</span>)</span><br><span class="line">    parser.add_option(<span class="string">"-l"</span>, <span class="string">"--level"</span>, dest=<span class="string">"loglevel"</span>, action = <span class="string">"store"</span>,</span><br><span class="line">                  type=<span class="string">"int"</span>,help=<span class="string">"Log file level, default 1(CRITICAL)"</span>,</span><br><span class="line">                  default=<span class="number">1</span>)</span><br><span class="line">    parser.add_option(<span class="string">"-t"</span>, <span class="string">"--thread"</span>, dest=<span class="string">"thread"</span>, action=<span class="string">"store"</span>,</span><br><span class="line">                  type=<span class="string">"int"</span>,help=<span class="string">"Specify the thread pool, default 10"</span>,</span><br><span class="line">                  default=<span class="number">10</span>)</span><br><span class="line">    parser.add_option(<span class="string">"-q"</span>, <span class="string">"--dbfile"</span>, dest=<span class="string">"dbpth"</span>, action=<span class="string">"store"</span>,</span><br><span class="line">                  help=<span class="string">"Specify the the sqlite file directory and name,</span></span><br><span class="line"><span class="string">                  default  test.db"</span>, metavar=<span class="string">'test.db'</span>)</span><br><span class="line">    parser.add_option(<span class="string">"-s"</span>, <span class="string">"--testself"</span>, dest=<span class="string">"testself"</span>, action=<span class="string">"store_true"</span>,</span><br><span class="line">                  help=<span class="string">"Test myself"</span>, default=<span class="literal">False</span>)</span><br><span class="line">    (options, args) = parser.parse_args()  </span><br><span class="line">    <span class="keyword">return</span> options</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">'''主函数'''</span></span><br><span class="line">    options = parse()</span><br><span class="line">    <span class="keyword">if</span> options.testself: <span class="comment">#如果testself,执行doctest</span></span><br><span class="line">        <span class="keyword">import</span> doctest</span><br><span class="line">        <span class="keyword">print</span> doctest.testmod()</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> options.urlpth <span class="keyword">or</span> <span class="keyword">not</span> options.key <span class="keyword">or</span> <span class="keyword">not</span> options.dbpth: <span class="comment">#判断必选项是否存在</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">'Need to specify the parameters option "-u " or "-k" or "-q"!'</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">'-h'</span> <span class="keyword">in</span> sys.argv  <span class="keyword">or</span> <span class="string">'--help'</span> <span class="keyword">in</span> sys.argv:  <span class="comment">#选择帮助信息,打印__doc__</span></span><br><span class="line">        <span class="keyword">print</span> __doc__</span><br><span class="line">    logger = configLogger(options.logfile) <span class="comment">#实例化日志调用</span></span><br><span class="line">    time = datetime.datetime.now().strftime(<span class="string">"%m%d%H%M%S"</span>) <span class="comment">#每次请求都会根据时间创建table</span></span><br><span class="line">    tp = ThreadPool(options.thread)</span><br><span class="line">    sq = mySqlite(options.dbpth, logger, options.loglevel)</span><br><span class="line">    table = <span class="string">'d'</span> + str(time)</span><br><span class="line">    sq.create(table) <span class="comment">#创建table</span></span><br><span class="line">    sq.close()</span><br><span class="line">    crawler = Crawler(options, tp, table, logger)</span><br><span class="line">    crawler.work()  <span class="comment">#主方法</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()&lt;/pre&gt;</span><br></pre></td></tr></table></figure></div></div><div id="post-footer" class="post-footer main-content-wrap"><div class="post-footer-tags"><span class="text-color-light text-small">标签</span><br><a class="tag tag--primary tag--small t-link" href="/source/all-tags/python/">python</a></div><div class="post-actions-wrap"><nav><ul class="post-actions post-action-nav"><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/2013/11/08/阳朔归来（11-10）/" data-tooltip="阳朔归来（11.10）"><i class="fa fa-angle-left"></i> <span class="hide-xs hide-sm text-small icon-ml">上一篇</span></a></li><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/2013/11/08/为什么买的数量越多，得到的折扣反而低了？/" data-tooltip="为什么买的数量越多，得到的折扣反而低了？"><span class="hide-xs hide-sm text-small icon-mr">下一篇</span> <i class="fa fa-angle-right"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions"><i class="fa fa-share-alt"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://www.hi-roy.com/2013/11/08/多线程爬虫/"><i class="fa fa-facebook-official"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://www.hi-roy.com/2013/11/08/多线程爬虫/"><i class="fa fa-twitter"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://www.hi-roy.com/2013/11/08/多线程爬虫/"><i class="fa fa-google-plus"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://service.weibo.com/share/share.php?&amp;title=http://www.hi-roy.com/2013/11/08/多线程爬虫/"><i class="fa fa-weibo"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.hi-roy.com/2013/11/08/多线程爬虫/&amp;title=多线程爬虫"><i class="fa fa-qq"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://www.hi-roy.com/2013/11/08/多线程爬虫/"><i class="fa fa-star"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://widget.renren.com/dialog/share?resourceUrl=http://www.hi-roy.com/2013/11/08/多线程爬虫/"><i class="fa fa-renren"></i></a></li><li class="post-action"><a class="post-action-btn btn btn--default" href="#"><i class="fa fa-list"></i></a></li></ul></div></div></article><footer id="footer" class="main-content-wrap"><span class="copyrights">Copyrights &copy; 2019 Roy. All Rights Reserved.</span></footer></div><div id="bottom-bar" class="post-bottom-bar" data-behavior="4"><div class="post-actions-wrap"><nav><ul class="post-actions post-action-nav"><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/2013/11/08/阳朔归来（11-10）/" data-tooltip="阳朔归来（11.10）"><i class="fa fa-angle-left"></i> <span class="hide-xs hide-sm text-small icon-ml">上一篇</span></a></li><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/2013/11/08/为什么买的数量越多，得到的折扣反而低了？/" data-tooltip="为什么买的数量越多，得到的折扣反而低了？"><span class="hide-xs hide-sm text-small icon-mr">下一篇</span> <i class="fa fa-angle-right"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions"><i class="fa fa-share-alt"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://www.hi-roy.com/2013/11/08/多线程爬虫/"><i class="fa fa-facebook-official"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://www.hi-roy.com/2013/11/08/多线程爬虫/"><i class="fa fa-twitter"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://www.hi-roy.com/2013/11/08/多线程爬虫/"><i class="fa fa-google-plus"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://service.weibo.com/share/share.php?&amp;title=http://www.hi-roy.com/2013/11/08/多线程爬虫/"><i class="fa fa-weibo"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.hi-roy.com/2013/11/08/多线程爬虫/&amp;title=多线程爬虫"><i class="fa fa-qq"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://www.hi-roy.com/2013/11/08/多线程爬虫/"><i class="fa fa-star"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://widget.renren.com/dialog/share?resourceUrl=http://www.hi-roy.com/2013/11/08/多线程爬虫/"><i class="fa fa-renren"></i></a></li><li class="post-action"><a class="post-action-btn btn btn--default" href="#"><i class="fa fa-list"></i></a></li></ul></div></div><div id="share-options-bar" class="share-options-bar" data-behavior="4"><i id="btn-close-shareoptions" class="fa fa-close"></i><ul class="share-options"><li class="share-option"><a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://www.hi-roy.com/2013/11/08/多线程爬虫/"><i class="fa fa-facebook-official"></i><span>分享到 Facebook</span></a></li><li class="share-option"><a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=http://www.hi-roy.com/2013/11/08/多线程爬虫/"><i class="fa fa-twitter"></i><span>分享到 Twitter</span></a></li><li class="share-option"><a class="share-option-btn" target="new" href="https://plus.google.com/share?url=http://www.hi-roy.com/2013/11/08/多线程爬虫/"><i class="fa fa-google-plus"></i><span>分享到 Google+</span></a></li><li class="share-option"><a class="share-option-btn" target="new" href="http://service.weibo.com/share/share.php?&amp;title=http://www.hi-roy.com/2013/11/08/多线程爬虫/"><i class="fa fa-weibo"></i><span>分享到 Weibo</span></a></li><li class="share-option"><a class="share-option-btn" target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.hi-roy.com/2013/11/08/多线程爬虫/&amp;title=多线程爬虫"><i class="fa fa-qq"></i><span>分享到 QQ</span></a></li><li class="share-option"><a class="share-option-btn" target="new" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://www.hi-roy.com/2013/11/08/多线程爬虫/"><i class="fa fa-star"></i><span>分享到 Qzone</span></a></li><li class="share-option"><a class="share-option-btn" target="new" href="http://widget.renren.com/dialog/share?resourceUrl=http://www.hi-roy.com/2013/11/08/多线程爬虫/"><i class="fa fa-renren"></i><span>分享到 Renren</span></a></li></ul></div></div><div id="about"><div id="about-card"><div id="about-btn-close"><i class="fa fa-remove"></i></div><img id="about-card-picture" src="/assets/images/my.jpg" alt="作者的图片"><h4 id="about-card-name">Roy</h4><div id="about-card-bio"><p>君以国士待我，我必以国士报君。</p></div><div id="about-card-job"><i class="fa fa-briefcase"></i><br><p>野生程序猿</p></div><div id="about-card-location"><i class="fa fa-map-marker"></i><br>China</div></div></div><div id="algolia-search-modal" class="modal-container"><div class="modal"><div class="modal-header"><span class="close-button"><i class="fa fa-close"></i></span> <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled"><span class="searchby-algolia-text text-color-light text-small">by</span> <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg"> </a><i class="search-icon fa fa-search"></i><form id="algolia-search-form"><input type="text" id="algolia-search-input" name="search" class="form-control input--large search-input" placeholder="Search "></form></div><div class="modal-body"><div class="no-result text-color-light text-center">没有找到文章</div><div class="results"><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/02/12/Ubuntu下Gogant的简易破墙术/"><h3 class="media-heading">Ubuntu下Gogant的简易破墙术</h3></a><span class="media-meta"><span class="media-date text-small">2013年2月12日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/10/31/python常用第三方库-转载/"><h3 class="media-heading">Python常用第三方库(转载)</h3></a><span class="media-meta"><span class="media-date text-small">2013年10月31日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/fedora19安装ar8161网卡驱动/"><h3 class="media-heading">fedora19安装ar8161网卡驱动</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/fedora19源，rpmforge，fastestmirror/"><h3 class="media-heading">fedora19源，rpmforge，fastestmirror</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/python中如何自定义解析域名/"><h3 class="media-heading">python中如何自定义解析域名</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/django版本更换/"><h3 class="media-heading">django版本更换</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/django-groundwork个人1-5-3修改版/"><h3 class="media-heading">django-groundwork个人1.5.3修改版</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/fedora19美化/"><h3 class="media-heading">fedora19美化</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/装饰器/"><h3 class="media-heading">装饰器</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/SVN常用操作/"><h3 class="media-heading">SVN常用操作</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div></div></div><div class="modal-footer"><p class="results-count text-medium" data-message-zero="没有找到文章" data-message-one="找到 1 篇文章" data-message-other="找到 {n} 篇文章">找到 217 篇文章</p></div></div></div><div id="cover" style="background-image:url(/assets/images/cover.jpg)"></div><script src="/assets/js/script-ivwiy10zeb8fifc4swnhkwneuk64y53w2scmdmtp8thi9cqfxh31aowtroaz.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.14.1/moment-with-locales.min.js"></script><script src="//cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script><script>var algoliaClient=algoliasearch("51U8PIBLP6","16909d9ce1780cda71113841864e7aa8"),algoliaIndex=algoliaClient.initIndex("my-blog")</script></body></html>