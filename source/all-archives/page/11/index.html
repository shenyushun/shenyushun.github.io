<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Hi!Roy!"><title>归档 - Hi!Roy!</title><meta name="author" content="Roy"><link rel="icon" href="http://www.hi-roy.com/assets/images/favicon.ico"><link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml"><meta property="og:type" content="blog"><meta property="og:title" content="Hi!Roy!"><meta property="og:url" content="http://www.hi-roy.com/source/all-archives/page/11/index.html"><meta property="og:site_name" content="Hi!Roy!"><meta property="og:locale" content="zh-cn"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Hi!Roy!"><meta property="og:image" content="http://www.hi-roy.com/assets/images/my.jpg"><link rel="stylesheet" href="/assets/css/style-sxklfps8ywgfyyjcowvnb4gxdgt0zjts3hsguljmv9uqanxjbnitrovtbrek.min.css"><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?21513ec2bcd577b3297a1b16da82fa40";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></head><body><div id="blog"><header id="header" data-behavior="1"><i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i><div class="header-title"><a class="header-title-link" href="/">Hi!Roy!</a></div><a class="header-right-icon" href="#about"><i class="fa fa-lg fa-question"></i></a></header><nav id="sidebar" data-behavior="1"><div class="sidebar-container"><div class="sidebar-profile"><a href="/#about"><img class="sidebar-profile-picture" src="/assets/images/my.jpg" alt="作者的图片"></a><h4 class="sidebar-profile-name">Roy</h4><h5 class="sidebar-profile-bio"><p>君以国士待我，我必以国士报君。</p></h5></div><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="/"><i class="sidebar-button-icon fa fa-lg fa-home"></i> <span class="sidebar-button-desc">首页</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-categories"><i class="sidebar-button-icon fa fa-lg fa-bookmark"></i> <span class="sidebar-button-desc">分类</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-tags"><i class="sidebar-button-icon fa fa-lg fa-tags"></i> <span class="sidebar-button-desc">标签</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-archives"><i class="sidebar-button-icon fa fa-lg fa-archive"></i> <span class="sidebar-button-desc">归档</span></a></li><li class="sidebar-button"><a class="sidebar-button-link open-algolia-search" href="#search"><i class="sidebar-button-icon fa fa-lg fa-search"></i> <span class="sidebar-button-desc">搜索</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="#about"><i class="sidebar-button-icon fa fa-lg fa-question"></i> <span class="sidebar-button-desc">关于</span></a></li></ul><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="https://github.com/shenyushun" target="_blank" rel="noopener"><i class="sidebar-button-icon fa fa-lg fa-github"></i> <span class="sidebar-button-desc">GitHub</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="mailto:darkcooking@gmail.com" target="_blank" rel="noopener"><i class="sidebar-button-icon fa fa-lg fa-envelope-o"></i> <span class="sidebar-button-desc">邮箱</span></a></li></ul><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="/atom.xml"><i class="sidebar-button-icon fa fa-lg fa-rss"></i> <span class="sidebar-button-desc">RSS</span></a></li></ul></div></nav><div id="main" data-behavior="1" class="hasCoverMetaIn"><section class="postShorten-group main-content-wrap"><article class="postShorten postShorten--thumbnailimg-right" itemscope itemtype="http://schema.org/BlogPosting"><div class="postShorten-wrap"><div class="postShorten-header"><h1 class="postShorten-title" itemprop="headline"><a class="link-unstyled" href="/2015/04/26/理财记录3/">理财记录3</a></h1><div class="postShorten-meta"><time itemprop="datePublished" datetime="2015-04-26T21:02:18+08:00">4月 26, 2015 </time><span>发布在 </span><a class="category-link" href="/source/all-categories/金融理财/">金融理财</a></div></div><div class="postShorten-excerpt" itemprop="articleBody"><p>上篇中主要学习了和企业盈利能力相关的知识，这篇中记录一下和企业偿债能力相关的知识，可能对于购买债券的朋友来说更看重这点吧。但我在学习过程中始终有一种似懂非懂的感觉，而没有学习关于盈利能力时那种“AHA~Get It!”的感觉，所以这里只做一些简单记录。</p><p>首先，企业是否会陷入财务困境可以从3方面来看：</p><ol><li>财务状况</li><li>盈利能力</li><li>周转速度</li></ol><p>同时衡量偿债能力的指标又有下面4种：</p><ol><li>资产负债率</li><li>流动比率</li><li>速动比率</li><li>利息保障倍数</li></ol><a href="/2015/04/26/理财记录3/" class="postShorten-excerpt_link link">阅读全文</a></div></div></article><article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemtype="http://schema.org/BlogPosting"><div class="postShorten-wrap"><div class="postShorten-header"><h1 class="postShorten-title" itemprop="headline"><a class="link-unstyled" href="/2015/04/23/使用firewalld-cmd配置防火墙/">使用firewalld-cmd配置防火墙</a></h1><div class="postShorten-meta"><time itemprop="datePublished" datetime="2015-04-23T17:44:52+08:00">4月 23, 2015 </time><span>发布在 </span><a class="category-link" href="/source/all-categories/菜鸟翻译屋/">菜鸟翻译屋</a></div></div><div class="postShorten-content" itemprop="articleBody"><p>CentOS7和fedora中的默认防火墙都变成了firewalld，当然你也可以选择禁用这个并自己安装iptables，下面内容原文：<a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Security_Guide/sec-Using_Firewalls.html" target="_blank" rel="noopener">这里</a>，而且只翻译我用到的部分文章。原文中还展示了如何使用图形界面进行配置，不过作为键盘爱好者，能不用鼠标的就尽量不用鼠标了，直接上命令行操作。</p><hr><h3 id="4-5-4-理解域概念"><a href="#4-5-4-理解域概念" class="headerlink" title="4.5.4 理解域概念"></a>4.5.4 理解域概念</h3><p>firewalld可以根据不同的信任级别，将处于不同域内的设备进行分离。NetworkManager用于管理firewalld将接口分配到哪个域中，可以通过NetworkManager界面或filrewall-config工具来进行设置。</p><p>默认的配置文件位于/etc/firewalld/可以快速的应用在网络接口上，这里有一份关于域的简短的说明：</p><p>dorp:任何入站请求都被忽略，无任何回复，只有发起的网络链接请求被放行。</p><p>block:任何入站请求都被拒绝，ipv4协议回复”icmp-host-prohibited”消息，ipv6协议回复”icmp6-adm-prohibited”，只有从系统内部发出的链接请求才被放行。</p><p>（个人感觉上面两个区别就是在于有无回复，对内的话用block、对外用dorp好一些，让外部扫描费点劲才知道被防火墙过滤了）</p><p>public:为在公共场所准备，你不相信网络中的其他电脑不会对你的电脑造成伤害，只有被选定的入站链接被接受。</p><p>external:为有伪装的外部网络特别是路由器准备，你不相信网络中的其他电脑不会对你的电脑造成伤害，只有被选定的入站链接被接受。</p><p>dmz:为那些处于隔离区(demilitarized zone)可以访问部分内部网络的电脑准备，只有被选定的入站链接被接受。</p><p>work:为工作域的电脑准备，你相信网络中其他电脑不会对你的电脑造成伤害，只有被选定的入站链接被接受。</p><p>home:为家庭域的电脑准备，你相信网络中其他电脑不会对你的电脑造成伤害，只有被选定的入站链接被接受。</p><p>internal:为内部域的电脑准备，你相信网络中其他电脑不会对你的电脑造成伤害，只有被选定的入站链接被接受。</p><p>trusted:接受全部请求。</p><p>你可以指定一个域为默认域，当一个新接口被添加到NetworkManager中时，它将被分配到默认域中。在默认情况下public为默认域。</p><h3 id="4-5-6-理解预设服务"><a href="#4-5-6-理解预设服务" class="headerlink" title="4.5.6 理解预设服务"></a>4.5.6 理解预设服务</h3><p>如果一个服务可用的话，它应该有一份本地端口和目标端口的列表，同时防火墙辅助模块自动载入这份列表。使用预设服务可以让用户轻松控制服务是否可以被访问，通过使用预设服务或用户自定义服务的方式来控制访问权限而不是通过管理端口或端口范围也许让管理员更加轻松。(翻译的不好，意思就是只记mysql而不用记3306端口了)服务的配置选项和通用文件信息在firewalld.service(5)中有介绍。服务被指定使用xml文件格式并且命名为service-name.xml这种格式。<br>可以通过下面的命令查看默认的预设服务：<code>ls /usr/lib/firewalld/services/</code></p><p>不要修改/usr/lib/firewalld/services中的文件，只有/etc/firewalld/services/才可以被修改。</p><p>查看系统或用户创建的服务可以使用:<code>ls /etc/firewalld/services/</code></p><p>服务可以通过图形界面或编辑/etc/firewalld/services/中的文件来新增或删除，如果你还没添加或修改过任何一个服务，/etc/firewalld/services/目录下是没有任何文件的，可以把从/usr/lib/firewalld/services/中复制出一个文件作为模板，比如：<br><code>cp /usr/lib/firewalld/services/[service].xml /etc/firewalld/services/[service].xml</code></p><p>你也许想新建一个文件，firewalld更喜欢新文件在/etc/firewalld/services/中而非/usr/lib/firewalld/services/中。</p><h3 id="4-5-7-理解直接接口"><a href="#4-5-7-理解直接接口" class="headerlink" title="4.5.7 理解直接接口"></a>4.5.7 理解直接接口</h3><p>firewalld中有一个功能叫做”直接接口“，它能直接通过iptables、ip6tables、ebtables的规则，这是为应用准备而不是为用户准备的。如果你对iptables不是十分熟悉的话用直接接口是很危险的，这无意间可能导致防火墙规则漏洞。某些规则被添加时仍然被firewalld所追踪，所以还可以用firewalld查看那些应用程序使用直接接口引起变化的规则。可以通过在firewalld-cmd 添加–direct来使用直接接口。</p><p>直接接口的目的是让服务或程序在运行时添加特定的防火墙规则, 通过使用–permanent参数或修改/etc/firewalld/direct.xml文件可以让这些规则持久化。如果规则没被持久化，则每次重启、重加载时都要重新添加。</p><h3 id="4-5-15-3-通过命令行查看firewalld"><a href="#4-5-15-3-通过命令行查看firewalld" class="headerlink" title="4.5.15.3 通过命令行查看firewalld"></a>4.5.15.3 通过命令行查看firewalld</h3><p>查看状态：<br><code>firewall-cmd --state</code></p><p>查看当前域：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --get-active-zones</span><br><span class="line">public</span><br><span class="line">  interfaces: em1</span><br></pre></td></tr></table></figure><p></p><p>根据接口查看所属域：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --get-zone-of-interface=em1</span><br><span class="line">public</span><br></pre></td></tr></table></figure><p></p><p>查看某域下所有接口：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --list-interfaces</span><br><span class="line">em1 wlan0</span><br></pre></td></tr></table></figure><p></p><p>这个命令的结果来自Networkmanager而且只显示接口不显示链接。</p><p>查看某域的所有设定：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --list-all</span><br><span class="line">public</span><br><span class="line">  interfaces:</span><br><span class="line">  services: mdns dhcpv6-client ssh</span><br><span class="line">  ports:</span><br><span class="line">  forward-ports:</span><br><span class="line">  icmp-blocks: source-quench</span><br></pre></td></tr></table></figure><p></p><p>查看当前哪些服务被加载：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --get-services</span><br><span class="line">cluster-suite pop3s bacula-client smtp ipp radius bacula ftp mdns samba dhcpv6-client dns openvpn imaps samba-client http https ntp vnc-server telnet libvirt ssh ipsec ipp-client amanda-client tftp-client nfs tftp libvirt-tls</span><br></pre></td></tr></table></figure><p></p><p>这将展示出所有位于/usr/lib/firewalld/services/的预设服务和当前载入的所有用户自定义服务，注意xml文件名必须是<em>service-name</em>.xml。如果用户自定义服务以及创建但没被加载，可以使用命令：<code>firewall-cmd --permanent --get-services</code></p><p>这个命令将展示所有的服务，包括未被加载的那些位于/etc/firewalld/services/的服务。</p><h3 id="4-5-15-4-通过命令行设置firewalld"><a href="#4-5-15-4-通过命令行设置firewalld" class="headerlink" title="4.5.15.4 通过命令行设置firewalld"></a>4.5.15.4 通过命令行设置firewalld</h3><h4 id="4-5-15-4-1-忽略所有包"><a href="#4-5-15-4-1-忽略所有包" class="headerlink" title="4.5.15.4.1 忽略所有包"></a>4.5.15.4.1 忽略所有包</h4><p>使用下面的命令忽略所有入站和出站请求：<code>firewall-cmd --panic-on</code></p><p>已经建立的链接将在会话过期后被终止。重新接受所有请求：<code>firewall-cmd --panic-off</code></p><p>查看panic状态：<code>firewall-cmd --query-panic</code></p><p>yes为启用，no为关闭。</p><h4 id="4-5-15-4-2-重载防火墙"><a href="#4-5-15-4-2-重载防火墙" class="headerlink" title="4.5.15.4.2 重载防火墙"></a>4.5.15.4.2 重载防火墙</h4><p>重载防火墙但并不打断用户链接：<code>firewall-cmd --reload</code></p><p>重载防火墙同时打断用户链接：<code>firewall-cmd --complete-reload</code></p><p>通常情况这个命令只有在防火墙服务出问题了才被使用。</p><h4 id="4-5-15-4-3-通过命令行添加新接口到某个域"><a href="#4-5-15-4-3-通过命令行添加新接口到某个域" class="headerlink" title="4.5.15.4.3 通过命令行添加新接口到某个域"></a>4.5.15.4.3 通过命令行添加新接口到某个域</h4><p>更改接口到某个域:<code>firewall-cmd --zone=public --add-interface=em1</code></p><p>从域中删除某接口:<code>firewall-cmd --zone=dmz --change-interface=em1</code></p><p>如果想要持久化，记得添加–permanent参数以及重载防火墙:<code>firewall-cmd --zone=public --remove-interface=em1</code></p><h4 id="4-5-15-4-4-通过修改文件添加新接口到某个域"><a href="#4-5-15-4-4-通过修改文件添加新接口到某个域" class="headerlink" title="4.5.15.4.4 通过修改文件添加新接口到某个域"></a>4.5.15.4.4 通过修改文件添加新接口到某个域</h4><p>编辑ifcfg-em1文件(一般位于/ets/sysconfig/network-scripts目录)，添加<br><code>ZONE=work</code></p><p>如果你省略zone或zone=””,默认将使用默认域。修改完成后NetworkManager将自动重连并设置相应域。</p><h4 id="4-5-15-4-5-通过修改配置文件修改默认域"><a href="#4-5-15-4-5-通过修改配置文件修改默认域" class="headerlink" title="4.5.15.4.5 通过修改配置文件修改默认域"></a>4.5.15.4.5 通过修改配置文件修改默认域</h4><p>编辑 /etc/firewalld/firewalld.conf<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">default zone</span><br><span class="line"># The default zone used if an empty zone string is used.</span><br><span class="line"># Default: public</span><br><span class="line">DefaultZone=home</span><br></pre></td></tr></table></figure><p></p><p>保存后重载防火墙，这将中断所有链接。</p><h4 id="4-5-15-4-6-通过命令行修改默认域"><a href="#4-5-15-4-6-通过命令行修改默认域" class="headerlink" title="4.5.15.4.6 通过命令行修改默认域"></a>4.5.15.4.6 通过命令行修改默认域</h4><p>使用命令：<code>firewall-cmd --set-default-zone=public</code></p><p>将立即生效而不需要重载防火墙 。</p><h4 id="4-5-15-4-7-通过命令行开放端口"><a href="#4-5-15-4-7-通过命令行开放端口" class="headerlink" title="4.5.15.4.7 通过命令行开放端口"></a>4.5.15.4.7 通过命令行开放端口</h4><p>首先列出所有开放的端口，以dmz域为例：<code>firewall-cmd --zone=dmz --list-ports</code></p><p>注意，这里不会展示被–add-services参数打开的端口。</p><p>开放某域内的端口，比如开放dmz域的8080端口，命令如下：<code>firewall-cmd --zone=dmz --add-port=8080/tcp</code></p><p>开放某段的端口，命令如下：<code>firewall-cmd --zone=public --add-port=5060-5065/udp</code></p><p>如果需要的话，记得使用<code>--permanent</code>参数进行持久化。</p><h4 id="4-5-15-4-8-通过命令行添加删除服务到某域"><a href="#4-5-15-4-8-通过命令行添加删除服务到某域" class="headerlink" title="4.5.15.4.8 通过命令行添加删除服务到某域"></a>4.5.15.4.8 通过命令行添加删除服务到某域</h4><p>这里以smtp服务添加到work域为例：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=work --add-service=smtp</span><br><span class="line">firewall-cmd --zone=work --remove-service=smtp</span><br></pre></td></tr></table></figure><p></p><p>同样的添加<code>--permanent</code>进行持久化，如果你使用了这个参数并想立即生效，请重载防火墙。</p><h4 id="4-5-15-4-9-通过修改xml文件添加删除服务到某域"><a href="#4-5-15-4-9-通过修改xml文件添加删除服务到某域" class="headerlink" title="4.5.15.4.9 通过修改xml文件添加删除服务到某域"></a>4.5.15.4.9 通过修改xml文件添加删除服务到某域</h4><p>首先查看默认域文件：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ls /usr/lib/firewalld/zones/</span><br><span class="line">block.xml  drop.xml      home.xml      public.xml   work.xml</span><br><span class="line">dmz.xml    external.xml  internal.xml  trusted.xml</span><br></pre></td></tr></table></figure><p></p><p>不要编辑这些文件，如果/etc/firewalld/zones/目录中没有等效文件这些文件将被使用。</p><p>想查看哪些域文件被修改，使用：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls /etc/firewalld/zones/</span><br><span class="line">external.xml  public.xml  public.xml.old</span><br></pre></td></tr></table></figure><p></p><p>这里我们以向work域添加服务为例，首先：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/lib/firewalld/zones/work.xml /etc/firewalld/zones/</span><br></pre></td></tr></table></figure><p></p><p>现在可以编辑位于/etc/firewalld/zones下的文件了，以添加smtp服务为例，修改work.xml添加：<code>&lt;service name=&quot;smtp&quot;/&gt;</code></p><p>如果你删除了这个文件，那么/usr/lib/firewalld/zones/中的文件将被使用。</p><p>删除操作和添加相反，删除我们编辑的xml文件中添加的行就行了，就不翻了。</p><h4 id="4-5-14-4-12-ip地址伪装"><a href="#4-5-14-4-12-ip地址伪装" class="headerlink" title="4.5.14.4.12 ip地址伪装"></a>4.5.14.4.12 ip地址伪装</h4><p>查看:<code>firewall-cmd --zone=external --query-masquerade</code></p><p>启用:<code>firewall-cmd --zone=external --add-masquerade</code></p><p>禁用:<code>firewall-cmd --zone=external --remove-masquerade</code></p><p>记得添加<code>--permanent</code>以及重载防火墙。</p><h4 id="4-5-14-4-12-端口转发"><a href="#4-5-14-4-12-端口转发" class="headerlink" title="4.5.14.4.12 端口转发"></a>4.5.14.4.12 端口转发</h4><p>想要进行端口转发，先要启用ip地址伪装，然后使用:<code>firewall-cmd --zone=external --add-forward-port=port=22:proto=tcp:toport=3753</code></p><p>上面的例子中把external域中22端口转发给本机的3753端口，协议为tcp。其中端口可以是一个端口也可以是端口范围，而proto则只能是tcp或udp的协议中的一个。</p><p>如果是转发给另一个ip，通常是内部Ip并且端口不变，则<code>firewall-cmd --zone=external --add-forward-port=port=22:proto=tcp:toaddr=192.0.2.55</code></p><p>如果端口也变了:<code>firewall-cmd --zone=external --add-forward-port=port=22:proto=tcp:toport=2055:toaddr=192.0.2.55</code></p><p>记得添加<code>--permanent</code>以及重载防火墙。</p><h3 id="4-5-14-6-使用直接接口"><a href="#4-5-14-6-使用直接接口" class="headerlink" title="4.5.14.6 使用直接接口"></a>4.5.14.6 使用直接接口</h3><p>车轱辘话略过，见上面</p><h4 id="4-5-14-6-1-添加用户规则"><a href="#4-5-14-6-1-添加用户规则" class="headerlink" title="4.5.14.6.1 添加用户规则"></a>4.5.14.6.1 添加用户规则</h4><p>添加规则链<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --direct --add-rule ipv4 filter IN_public_allow \</span><br><span class="line">      0 -m tcp -p tcp --dport 666 -j ACCEPT</span><br></pre></td></tr></table></figure><p></p><h4 id="4-5-14-6-2-删除用户规则"><a href="#4-5-14-6-2-删除用户规则" class="headerlink" title="4.5.14.6.2 删除用户规则"></a>4.5.14.6.2 删除用户规则</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --direct --remove-rule ipv4 filter IN_public_allow \</span><br><span class="line">      0 -m tcp -p tcp --dport 666 -j ACCEPT</span><br></pre></td></tr></table></figure><h4 id="4-5-14-6-3-展示用户规则"><a href="#4-5-14-6-3-展示用户规则" class="headerlink" title="4.5.14.6.3 展示用户规则"></a>4.5.14.6.3 展示用户规则</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --direct --get-rules ipv4 filter IN_public_allow</span><br></pre></td></tr></table></figure><p>如果需要的话，同样使用<code>--permanent</code>以及重载防火墙。</p><hr><p>翻到后面发现车轮话太多了，就只进行了意译，而且个人也就使用开放端口、转发一类的常见操作，高深地方就不不翻译了，用到了在说吧。注意的就是如果不加<code>--permanent</code>参数则会实时生效，但重启或重加载后会失效。加<code>--permanent</code>参数则不会实时生效，需要重新reload。<br>再补充一些东西，类似于黑白名单机制，比如我想根据来源ip来分配不同的域规则，则相关命令如下<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --zone=public --list-sources</span><br><span class="line">firewall-cmd --permanent --zone=public --add-source=192.168.100.0/24</span><br><span class="line">firewall-cmd --permanent --zone=public --add-source=192.168.222.123/32</span><br><span class="line">firewall-cmd --permanent --zone=public --add-port=1-22/tcp</span><br><span class="line">firewall-cmd --permanent --zone=public --add-port=1-22/udp</span><br></pre></td></tr></table></figure><p></p><p>有add-source、port自然就会有remove-source、port了，当你只想让某些指定的ip访问某些服务的话，就可以把这些ip放到相应的域内，加载规则如下:</p><ol><li>如果一个包的来源已经绑定在某个域内，则使用这个域的规则。</li><li>如果一个包的来源没绑定任何一个域，但来源访问的接口绑定了某个域（比如eth0），则使用端口绑定的域规则。</li><li>如果一个包的来源和来源接口都没绑定某个域，则使用默认域规则。<br>这里还要注意，一个ip地址只能属于一个域，否则会提示域冲突。</li></ol><p><a href="/2015/04/23/使用firewalld-cmd配置防火墙/#post-footer" class="postShorten-excerpt_link link">评论和分享</a></p></div></div></article><article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemtype="http://schema.org/BlogPosting"><div class="postShorten-wrap"><div class="postShorten-header"><h1 class="postShorten-title" itemprop="headline"><a class="link-unstyled" href="/2015/04/22/fedora21安装有道词典linux版/">fedora21安装有道词典linux版</a></h1><div class="postShorten-meta"><time itemprop="datePublished" datetime="2015-04-22T16:18:19+08:00">4月 22, 2015 </time><span>发布在 </span><a class="category-link" href="/source/all-categories/Linux/">Linux</a></div></div><div class="postShorten-content" itemprop="articleBody"><p>今天发现有道词典出了linux版，不过万恶的只有deepin和ubuntu的安装包，作为忠实的红帽系用户只能下源码了。首先从 <a href="http://cidian.youdao.com/index-linux.html" target="_blank" rel="noopener">http://cidian.youdao.com/index-linux.html</a> 选择二进制安装包并解压。</p><p>这里注意2个地方，首先fedora21默认为qt4，python2.7，而有道词典需要qt5以及python3，所以先要去官网下载QT5离线安装版（个人建议，我这在线安装qt5慢的不可忍受）。下载完成我们得到qt-opensource-linux-x64-5.4.1.run添加执行权限后执行即可。</p><p>安装完成后进入到解压后的有道词典目录，我这里叫youdao-dict_1.0.2~binary_amd64，给里面的install.sh添加执行权限并执行即可。</p><p>接下来到了最纠结的地方了，我们要手动安装各个依赖，这里我就直接给出经过N次失败后成功的结果把，下面这些都要用yum命令安装：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">yum install python3-qt5</span><br><span class="line">yum install python3-requests</span><br><span class="line">yum install python3-xlib</span><br><span class="line">yum install python3-lxml</span><br><span class="line">yum install python3-pillow</span><br><span class="line">yum install tesseract-langpack-chi_sim</span><br><span class="line">yum install tesseract-langpack-chi_tra</span><br><span class="line">yum install qt5-qtquickcontrols</span><br><span class="line">yum install qt5-qtgraphicaleffects</span><br></pre></td></tr></table></figure><p></p><p>都安装完成后就可以用了，支持取词、划词，不过取词识别度还有待提高，划词翻译比较好用。当然了，如果你想更geek一点，可以安装openyoudao也很酷。</p><p><a href="/2015/04/22/fedora21安装有道词典linux版/#post-footer" class="postShorten-excerpt_link link">评论和分享</a></p></div></div></article><article class="postShorten postShorten--thumbnailimg-right" itemscope itemtype="http://schema.org/BlogPosting"><div class="postShorten-wrap"><div class="postShorten-header"><h1 class="postShorten-title" itemprop="headline"><a class="link-unstyled" href="/2015/04/19/理财记录2/">理财记录2</a></h1><div class="postShorten-meta"><time itemprop="datePublished" datetime="2015-04-19T14:47:01+08:00">4月 19, 2015 </time><span>发布在 </span><a class="category-link" href="/source/all-categories/金融理财/">金融理财</a></div></div><div class="postShorten-excerpt" itemprop="articleBody"><p>这个月拿到了人生中第一笔5位数薪水，可仔细一看，税、五险一金居然扣了将近2K！这可把我肉疼坏了，正好最近看到了关于和税有关的会计知识，发现当老板也不容易啊！就拿所得税来说，不管你利润多少，先把25%交上去再说，颇有“此路是我开，此树是我栽，要想过此路，留下买路财”的味道。呃……不知道这么说会不会被跨省——我纳税，我光荣！</p><p>上篇记录主要是说了金钱的时间成本，这篇主要和财务报表有关，但相关的会计概念实在太多，我在学习时3页书就记了整整6页A4纸的笔记，所以在这里可能不会解释相关的概念了，有需要的自行百度。老规矩先来个声明：本人非科班出身，所记录均为个人学习心得，不保证正确性、时效性。</p><a href="/2015/04/19/理财记录2/" class="postShorten-excerpt_link link">阅读全文</a></div></div></article><article class="postShorten postShorten--thumbnailimg-right" itemscope itemtype="http://schema.org/BlogPosting"><div class="postShorten-wrap"><div class="postShorten-header"><h1 class="postShorten-title" itemprop="headline"><a class="link-unstyled" href="/2015/04/10/理财纪录1/">理财纪录1</a></h1><div class="postShorten-meta"><time itemprop="datePublished" datetime="2015-04-10T00:07:07+08:00">4月 10, 2015 </time><span>发布在 </span><a class="category-link" href="/source/all-categories/金融理财/">金融理财</a></div></div><div class="postShorten-excerpt" itemprop="articleBody"><p>复利是什么？爱因斯坦说它是世界第八大奇迹。下面涉及到复利终值和现值、普通年金终值和现值、预付年金终值与现值、偿债基金、年资本回收额等初级会计知识，本人非会计出身，下面说的仅凭个人理解，如有错误恳请指正。</p><p>复利终值是什么？简言之就是今年的x元钱，在保持q%的利率或利率下，相当于n年后多少钱。</p><a href="/2015/04/10/理财纪录1/" class="postShorten-excerpt_link link">阅读全文</a></div></div></article><article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemtype="http://schema.org/BlogPosting"><div class="postShorten-wrap"><div class="postShorten-header"><h1 class="postShorten-title" itemprop="headline"><a class="link-unstyled" href="/2015/04/09/django-userena使用记录/">django-userena使用记录</a></h1><div class="postShorten-meta"><time itemprop="datePublished" datetime="2015-04-09T17:31:47+08:00">4月 09, 2015 </time><span>发布在 </span><a class="category-link" href="/source/all-categories/Django/">Django</a></div></div><div class="postShorten-content" itemprop="articleBody"><p><a href="http://docs.django-userena.org/en/latest/installation.html" target="_blank" rel="noopener">django-userena</a>扩展了django原生的用户系统，提供了注册、登录、修改密码、邮件验证等一系列常用功能。直接使用pip安装即可：<code>pip install django-userena</code></p><p>会自动安装其所需的依赖包，不过个人建议为了更好的定制模板或相关功能，把这个包放到项目目录下当作一个app更方便一些。安装完成后修改settings.py，首先来创建一个app用于扩展用户系统<br><code>python manage.py startapp accounts</code><br>然后修改Models.py来扩展原生用户字段，我这里以添加用户等级为例：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User</span><br><span class="line"><span class="keyword">from</span> django.utils.translation <span class="keyword">import</span> ugettext <span class="keyword">as</span> _</span><br><span class="line"><span class="keyword">from</span> userena.models <span class="keyword">import</span> UserenaBaseProfile</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomerProfile</span><span class="params">(UserenaBaseProfile)</span>:</span></span><br><span class="line">    user = models.OneToOneField(User,</span><br><span class="line">                                unique=<span class="literal">True</span>,</span><br><span class="line">                                verbose_name=_(<span class="string">'user'</span>),</span><br><span class="line">                                related_name=<span class="string">'customer_profile'</span>)</span><br><span class="line">    level = models.IntegerField(_(<span class="string">u"用户等级"</span>), default=<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p></p><p>接下来修改settings.py，首先把<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;django.contrib.sites&quot;,</span><br><span class="line">&quot;accounts&quot;,</span><br><span class="line">&apos;userena&apos;,</span><br><span class="line">&apos;guardian&apos;,</span><br><span class="line">&apos;easy_thumbnails&apos;</span><br></pre></td></tr></table></figure><p></p><p>添加到INSTALLED_APPS中，然后把<code>&#39;django.contrib.sites.middleware.CurrentSiteMiddleware&#39;,</code><br>添加到MIDDLEWARE_CLASSES中，在django1.7.7中如果不添加和site有关的东西时，userena注册用户会抛出”Site matching query does not exist“异常。最后添加下面的配置：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">AUTHENTICATION_BACKENDS = (</span><br><span class="line">    <span class="string">'userena.backends.UserenaAuthenticationBackend'</span>,</span><br><span class="line">    <span class="string">'guardian.backends.ObjectPermissionBackend'</span>,</span><br><span class="line">    <span class="string">'django.contrib.auth.backends.ModelBackend'</span>,</span><br><span class="line">)</span><br><span class="line">EMAIL_HOST = <span class="string">'xxxx'</span></span><br><span class="line">EMAIL_HOST_USER = <span class="string">'xxxx@xxxx'</span></span><br><span class="line">EMAIL_HOST_PASSWORD = <span class="string">'xxxx'</span></span><br><span class="line">EMAIL_PORT = <span class="number">25</span></span><br><span class="line">DEFAULT_FROM_EMAIL = <span class="string">'xxxx@xxxx'</span></span><br><span class="line">ANONYMOUS_USER_ID = <span class="number">-1</span></span><br><span class="line">AUTH_PROFILE_MODULE = <span class="string">'accounts.CustomerProfile'</span></span><br><span class="line">USERENA_SIGNIN_REDIRECT_URL = <span class="string">'/accounts/%(username)s/'</span></span><br><span class="line">LOGIN_URL = <span class="string">'/accounts/signin/'</span></span><br><span class="line">LOGOUT_URL = <span class="string">'/accounts/signout/'</span></span><br></pre></td></tr></table></figure><p></p><p>xxxx根据实际情况修改，和发送验证邮件有关。这些都添加完毕后，执行<br><code>./manage.py migrate</code><br>创建数据库，接下来执行<br><code>./manage.py check_permissions</code><br>否则报错”Permission matching query does not exist“。最后记得添加url<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(<span class="string">r'^accounts/'</span>, include(<span class="string">'userena.urls'</span>)),</span><br></pre></td></tr></table></figure><p></p><p>都完成后，运行程序，访问<code>http://127.0.0.1:8000/accounts/signup/</code>就可以看见注册页面了。</p><p>所有html文件以及email模板都在<code>userena/templates/userena</code>路径下，进行相应定制即可。</p><p><a href="/2015/04/09/django-userena使用记录/#post-footer" class="postShorten-excerpt_link link">评论和分享</a></p></div></div></article><article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemtype="http://schema.org/BlogPosting"><div class="postShorten-wrap"><div class="postShorten-header"><h1 class="postShorten-title" itemprop="headline"><a class="link-unstyled" href="/2015/04/06/MacOS安装Wireshark－qt/">MacOS安装Wireshark-qt</a></h1><div class="postShorten-meta"><time itemprop="datePublished" datetime="2015-04-06T11:29:54+08:00">4月 06, 2015 </time><span>发布在 </span><a class="category-link" href="/source/all-categories/Mac/">Mac</a></div></div><div class="postShorten-content" itemprop="articleBody"><p>大名鼎鼎的Wireshark不必多说，在win、linux系统中安装也都比较便捷，不过在网上大多写MacOS中如何安装的都狠麻烦，因为他们写的都是安装gtk版本的方式，而wireshark早就投入了qt阵营的怀抱了。</p><p>在brew中直接使用<code>brew install wireshark --with-qt</code>即可安装成功，不过安装后会提示:<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; If your list of available capture interfaces is empty</span><br><span class="line">&gt; (default OS X behavior), try the following commands:</span><br><span class="line">&gt; curl https://bugs.wireshark.org/bugzilla/attachment.cgi?id=3373 -o ChmodBPF.tar.gz</span><br><span class="line">&gt; tar zxvf ChmodBPF.tar.gz</span><br><span class="line">&gt; open ChmodBPF/Install\ ChmodBPF.app</span><br><span class="line">&gt; This adds a launch daemon that changes the permissions of your BPF</span><br><span class="line">&gt; devices so that all users in the &apos;admin&apos; group - all users with</span><br><span class="line">&gt; &apos;Allow user to administer this computer&apos; turned on - have both read</span><br><span class="line">&gt; and write access to those devices.</span><br><span class="line">&gt; See bug report:</span><br><span class="line">&gt; https://bugs.wireshark.org/bugzilla/show_bug.cgi?id=3760</span><br></pre></td></tr></table></figure><p></p><p>就是由于某些原因Wireshark找不到网卡，按照上面提示解决后再启动即可。</p><p>这种方式安装完后的Wireshark是不会在LaunchPad中有图标的，想启动的话在终端中输入wireshark-qt即可启动gui界面版，tshark则启动命令行版。</p><p><a href="/2015/04/06/MacOS安装Wireshark－qt/#post-footer" class="postShorten-excerpt_link link">评论和分享</a></p></div></div></article><article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemtype="http://schema.org/BlogPosting"><div class="postShorten-wrap"><div class="postShorten-header"><h1 class="postShorten-title" itemprop="headline"><a class="link-unstyled" href="/2015/04/02/fedora21安装MITMf框架/">fedora21安装MITMf框架</a></h1><div class="postShorten-meta"><time itemprop="datePublished" datetime="2015-04-02T14:42:02+08:00">4月 02, 2015 </time><span>发布在 </span><a class="category-link" href="/source/all-categories/Linux/">Linux</a></div></div><div class="postShorten-content" itemprop="articleBody"><p>关于这大名鼎鼎的中间人攻击框架不多介绍了，如果是kali linux用户直接apt-get install mitmf即可;如果是win用户呢，基本就放弃吧;如果是os x用户呢，有几个依赖我始终安装失败，你要安装成功了请联系我。</p><p>网上很多都是讲ubuntu怎么安装这个框架的，这里我记录一下在fedora21上我的安装记录。</p><p>首先安装一些系统依赖，这里我系统原来就安装了很多杂七杂八的东西，不保证下面的就是齐全的：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install libnetfilter_queue-devel</span><br><span class="line">sudo yum install libffi-devel</span><br><span class="line">sudo yum install libpcap-devel</span><br></pre></td></tr></table></figure><p></p><p>接下来下载一个不能用pip安装的包<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/fqrouter/python-netfilterqueue.git</span><br></pre></td></tr></table></figure><p></p><p>然后进入目录中执行python setup.py install即可。</p><p>然后把mitmf框架下载下来<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/byt3bl33d3r/MITMf.git</span><br></pre></td></tr></table></figure><p></p><p>进入目录后，修改requirements.txt，我安装成功后所有的依赖如下，不保证时效。<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># NetfilterQueue==0.6  这个是手动安装的</span><br><span class="line">Pillow==2.8.0</span><br><span class="line">PyYAML==3.11</span><br><span class="line">Twisted==15.0.0</span><br><span class="line">capstone==3.0.2</span><br><span class="line">cffi==0.9.2</span><br><span class="line">characteristic==14.3.0</span><br><span class="line">configobj==5.0.6</span><br><span class="line">cryptography==0.8.1</span><br><span class="line">dnspython==1.12.0</span><br><span class="line">enum34==1.0.4</span><br><span class="line">msgpack-python==0.4.6</span><br><span class="line">pefile==1.2.10-114</span><br><span class="line">pyOpenSSL==0.14</span><br><span class="line">pyasn1==0.1.7</span><br><span class="line">pyasn1-modules==0.0.5</span><br><span class="line">pycparser==2.10</span><br><span class="line">pypcap==1.1.1</span><br><span class="line">requests==2.6.0</span><br><span class="line">scapy==2.3.1</span><br><span class="line">service-identity==14.0.0</span><br><span class="line">six==1.9.0</span><br><span class="line">ua-parser==0.3.6</span><br><span class="line">user-agents==0.3.2</span><br><span class="line">wsgiref==0.1.2</span><br><span class="line">zope.interface==4.1.2</span><br></pre></td></tr></table></figure><p></p><p>都安装完就可以了，如果安装某个包时报错xxx.h不存在，基本就是某个系统依赖的devel包没安装的问题，使用yum安装即可。还有一点，运行这个框架要用root权限。<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(mitmfenv)┌─[cpu0@localhost] - [~/git/MITMf] - [5230]</span><br><span class="line">└─[#] ./mitmf.py -h                                                                                                                [14:43:41]</span><br><span class="line">   ▄▄▄▄███▄▄▄▄    ▄█      ███       ▄▄▄▄███▄▄▄▄      ▄████████</span><br><span class="line"> ▄██▀▀▀███▀▀▀██▄ ███  ▀█████████▄ ▄██▀▀▀███▀▀▀██▄   ███    ███</span><br><span class="line"> ███   ███   ███ ███▌    ▀███▀▀██ ███   ███   ███   ███    █▀  </span><br><span class="line"> ███   ███   ███ ███▌     ███   ▀ ███   ███   ███  ▄███▄▄▄     </span><br><span class="line"> ███   ███   ███ ███▌     ███     ███   ███   ███ ▀▀███▀▀▀     </span><br><span class="line"> ███   ███   ███ ███      ███     ███   ███   ███   ███        </span><br><span class="line"> ███   ███   ███ ███      ███     ███   ███   ███   ███        </span><br><span class="line">  ▀█   ███   █▀  █▀      ▄████▀    ▀█   ███   █▀    ███        </span><br><span class="line">usage:</span><br><span class="line">MITMf v0.9.5 - Framework for MITM attacks</span><br></pre></td></tr></table></figure><p></p><p><a href="/2015/04/02/fedora21安装MITMf框架/#post-footer" class="postShorten-excerpt_link link">评论和分享</a></p></div></div></article><article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemtype="http://schema.org/BlogPosting"><div class="postShorten-wrap"><div class="postShorten-header"><h1 class="postShorten-title" itemprop="headline"><a class="link-unstyled" href="/2015/03/29/滕王阁序/">滕王阁序</a></h1><div class="postShorten-meta"><time itemprop="datePublished" datetime="2015-03-29T23:58:12+08:00">3月 29, 2015 </time><span>发布在 </span><a class="category-link" href="/source/all-categories/杂/">杂</a></div></div><div class="postShorten-content" itemprop="articleBody"><p>时隔多年，又偶然看见了高中课堂上学过的《滕王阁序》，突然明白了当时语文老师为什么能那么充满激情的讲解，有些东西——没有一定的年龄和阅历是看不懂的。<br>以前只是觉得这是要求背诵的课文，真讨厌。但是现在读到</p><blockquote><p>“嗟乎！时运不齐，命途多舛。<strong>冯唐易老，李广难封。</strong>屈贾谊于长沙，非无圣主；窜梁鸿于海曲，岂乏明时？所赖君子见机，达人知命。<strong>老当益壮，宁移白首之心？穷且益坚，不坠青云之志。</strong>酌贪泉而觉爽，处涸辙以犹欢。北海虽赊，扶摇可接；<strong>东隅已逝，桑榆非晚</strong>。孟尝高洁，空余报国之情；阮籍猖狂，岂效穷途之哭！”<br>心中却有了不可名状的触动。每个人都渴望做出名留青史的一番事业，但更多数的人却过完了普普通通的一生。或许是因为最近有些焦躁，觉得自己都这个年龄了却还一事无成才会有所触动吧。明知道这种事急不来，却依然恨不得明天就能做出一番轰轰烈烈的大事来。最近最明显的一个感觉就是，以前日子是一天一天过的，现在是一周一周过的，再过几年就是一个月一个月过的了吧。<br>突然想起丰子恺的一句话：孩子，我多么羡慕你们！羡慕你们的现在的生活！但是当你们明白我这句话的时候，你们已经不再令我羡慕了。就好像，长大了才知道《麦兜》不是给孩子看的，《幽游白书》的结局为什么那么平淡。</p></blockquote><p>有人说，以前看《大话西游》看着看着就笑了，现在却是看着看着就哭了。虽然再次重温经典的时候我没有哭，却笑不出来了。以前一直觉得片尾夕阳武士对着悟空背影说的那句“他好像一条狗”十分突兀，不明所以。现在明白，电影中表明至尊宝最后顿悟了，带上头箍是为了保护唐僧取经，让大众脱离苦海，而非单单为了拯救紫霞。选择事业放弃爱情，却抹不掉心中的那个人影，这也就是最后悟空借夕阳武士之口对自己说“你好像一条狗”的原因吧。</p><p>你好像一条狗。</p><p><a href="/2015/03/29/滕王阁序/#post-footer" class="postShorten-excerpt_link link">评论和分享</a></p></div></div></article><article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemtype="http://schema.org/BlogPosting"><div class="postShorten-wrap"><div class="postShorten-header"><h1 class="postShorten-title" itemprop="headline"><a class="link-unstyled" href="/2015/03/19/NodeJS学习记录1/">NodeJS学习记录1</a></h1><div class="postShorten-meta"><time itemprop="datePublished" datetime="2015-03-19T17:03:56+08:00">3月 19, 2015 </time><span>发布在 </span><a class="category-link" href="/source/all-categories/Nodejs/">Nodejs</a></div></div><div class="postShorten-content" itemprop="articleBody"><p>本来学oc学的正爽，结果由于某些原因必须先学习NodeJS，所以oc的学习就先暂停一段时间吧。这几天恶补了相关基础知识，如果oc只是语法上让我不太习惯的话，那nodejs就是从编程思想上将原来所学的知识进行了颠覆。至于nodejs相关介绍、优缺点等这里就不多说了，如果想在学习过程中不“一头雾水”，就要理解几个概念：同步/异步、阻塞/非阻塞、闭包、回调、事件轮循。</p><p>本人以前并没有任何javascript语言的学习经验，这里仅仅记录我这几天学习的理解，如有什么偏颇，还望大家指正。</p><p>首先，nodejs是单线程的，同时只能进行一项任务。这点引起较大的批评就是无法利用多核CPU的能力，但同时在多个CPU运行程序也并不是完美的，因为想要多个CPU有效的拆分任务并执行，它们之间需要频繁的交换信息，比如当前执行状态、各自完成了哪些操作等。</p><p>关于上面的几个概念，网上答案五花八门都有，不过我更倾向于下面的答案，引用于知乎，<a href="http://www.zhihu.com/question/19732473" target="_blank" rel="noopener">原文链接</a>：</p><blockquote><p>“阻塞”与”非阻塞”与”同步”与“异步”不能简单的从字面理解，提供一个从分布式系统角度的回答。</p></blockquote><blockquote><p>1.同步与异步</p></blockquote><blockquote><p>同步和异步关注的是消息通信机制 (synchronous communication/ asynchronous communication)</p></blockquote><blockquote><p>所谓同步，就是在发出一个调用时，在没有得到结果之前，该调用就不返回。但是一旦调用返回，就得到返回值了。</p></blockquote><blockquote><p>换句话说，就是由调用者主动等待这个调用的结果。</p></blockquote><blockquote><p>而异步则是相反，调用在发出之后，这个调用就直接返回了，所以没有返回结果。换句话说，当一个异步过程调用发出后，调用者不会立刻得到结果。而是在调用发出后，被调用者通过状态、通知来通知调用者，或通过回调函数处理这个调用。</p></blockquote><blockquote><p>典型的异步编程模型比如Node.js</p></blockquote><blockquote><p>举个通俗的例子：</p></blockquote><blockquote><p>你打电话问书店老板有没有《分布式系统》这本书，如果是同步通信机制，书店老板会说，你稍等，”我查一下”，然后开始查啊查，等查好了（可能是5秒，也可能是一天）告诉你结果（返回结果）。</p></blockquote><blockquote><p>而异步通信机制，书店老板直接告诉你我查一下啊，查好了打电话给你，然后直接挂电话了（不返回结果）。然后查好了，他会主动打电话给你。在这里老板通过“回电”这种方式来回调。</p></blockquote><blockquote><p>2.阻塞与非阻塞</p></blockquote><blockquote><p>阻塞和非阻塞关注的是程序在等待调用结果（消息，返回值）时的状态.</p></blockquote><blockquote><p>阻塞调用是指调用结果返回之前，当前线程会被挂起。调用线程只有在得到结果之后才会返回。<br>非阻塞调用指在不能立刻得到结果之前，该调用不会阻塞当前线程。</p></blockquote><blockquote><p>还是上面的例子，</p></blockquote><blockquote><p>你打电话问书店老板有没有《分布式系统》这本书，你如果是阻塞式调用，你会一直把自己“挂起”，直到得到这本书有没有的结果，如果是非阻塞式调用，你不管老板有没有告诉你，你自己先一边去玩了， 当然你也要偶尔过几分钟check一下老板有没有返回结果。</p></blockquote><blockquote><p>在这里阻塞与非阻塞与是否同步异步无关。跟老板通过什么方式回答你结果无关。</p></blockquote><p>这里补充一下，老板给你打电话回来，然后你去取书就是”回调“。上面网友回答也说道了要偶尔check一下返回结果，个人的理解这就是事件轮循。并不是说这个check这个动作，而是你要找老板这个事件。比如你先去一边玩去了，然后觉得饿了给老妈打电话问饭做好了没，老妈说还没好，你就又继续玩去了。那么事件列表中此时就有2个事件：给老板打电话（确认书到没到）和给老妈打电话（确认饭做没做好）。</p><p>再说闭包，什么是闭包（closure）呢？这里又不得不提起“作用域”这个东东了。类比c++、c#、java来说，javascrept中函数内（域内）的成员是不能在域外访问的，类似于”私有成员“。那么怎么得到内部数据呢？这时，闭包就华丽丽的出场了。英语好的小伙伴可以直接看<a href="https://stackoverflow.com/questions/111102/how-do-javascript-closures-work" target="_blank" rel="noopener">这里</a>，我在下面直接引用了其中比喻非常好的那个小公主的代码<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">princess</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> adventures = [];</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">princeCharming</span>(<span class="params"></span>) </span>&#123; / ... / &#125;</span><br><span class="line">	<span class="keyword">var</span> unicorn = &#123; / ... / &#125;,</span><br><span class="line">		dragons = [ <span class="regexp">/ ... /</span> ],</span><br><span class="line">		squirrel = <span class="string">"Hello!"</span>;</span><br><span class="line">	adventures.push(unicorn, dragons, squirrel);</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		story: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> adventures[adventures.length - <span class="number">1</span>];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> littleGirl = princess();</span><br><span class="line">x = littleGirl.story();</span><br><span class="line">y = littleGirl.dragons;</span><br><span class="line"><span class="built_in">console</span>.log(x);</span><br><span class="line"><span class="built_in">console</span>.log(y);</span><br></pre></td></tr></table></figure><p></p><p>执行后结果是<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">localhost :: ~<span class="regexp">/mynode/</span>v55 » node test.js</span><br><span class="line">Hello!</span><br><span class="line"><span class="literal">undefined</span></span><br></pre></td></tr></table></figure><p></p><p>可以看到，闭包是个函数，它可以让你在作用域访问到作用域内部的变量。这里多说一句，虽然javascrept中并没有”类“这一结构，但上面的例子明显就是一个”类“的实现。关于孩子取垃圾袋的类比也不错，代码如下<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeKitchen</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> trashBags = [<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>]; <span class="comment">// only 3 at first</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    getTrashBag: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> trashBags.pop();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> kitchen = makeKitchen();</span><br><span class="line">kitchen.getTrashBag(); <span class="comment">// returns trash bag C</span></span><br><span class="line">kitchen.getTrashBag(); <span class="comment">// returns trash bag B</span></span><br><span class="line">kitchen.getTrashBag(); <span class="comment">// returns trash bag A</span></span><br></pre></td></tr></table></figure><p></p><p>这个例子中看出，闭包不单可以取得值，还能改变它。这里不得不佩服歪国人那强大的类比能力，正如爱因斯坦说的：</p><blockquote><p>If you can’t explain it to a six-year-old, you really don’t understand it yourself.</p></blockquote><p>至于更底层的细节，比如inx和windows系统中实现异步的库并不一样啦、内存分配回收神码的，作为初学者的我也不懂，有兴趣的同学可以自行研究。</p><p>在fedora21中使用’yum install nodejs’安装即可，会自动把npm管理工具安装上,npm就是python的pip，负责三方模块的安装。当然也可以去官网下载源码或相应安装包进行安装。安装完毕后使用”node -v”可以查看版本，这里我安装的是0.10.36。接下来，直接使用node命令进入Node解释器，老规矩，先”hello world“一下：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ node</span><br><span class="line">&gt; console.log(&quot;hello world!&quot;)</span><br><span class="line">hello world!</span><br></pre></td></tr></table></figure><p></p><p>至于上面说的“同一时刻只能执行一项操作”从下面的代码可以加深理解：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">eve = <span class="built_in">require</span>(<span class="string">'events'</span>).EventEmitter;  </span><br><span class="line">e = <span class="keyword">new</span> eve();                                                           </span><br><span class="line">die = <span class="literal">false</span>;</span><br><span class="line">e.on(<span class="string">'die'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;die = <span class="literal">true</span>;&#125;);</span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;e.emit(<span class="string">'die'</span>)&#125;,<span class="number">1000</span>);</span><br><span class="line"><span class="keyword">while</span>(!die)&#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"done"</span>);</span><br></pre></td></tr></table></figure><p></p><p>上面的代码永远不会输出done，虽然我们设定了1秒钟后通过事件回调将die设为true，但while循环在这里是永远执行不完的，回调事件永远没机会被触发。</p><p><a href="/2015/03/19/NodeJS学习记录1/#post-footer" class="postShorten-excerpt_link link">评论和分享</a></p></div></div></article><div class="pagination-bar"><ul class="pagination"><li class="pagination-prev"><a class="btn btn--default btn--small" href="/source/all-archives/page/10/"><i class="fa fa-angle-left text-base icon-mr"></i> <span>上一页</span></a></li><li class="pagination-next"><a class="btn btn--default btn--small" href="/source/all-archives/page/12/"><span>下一页</span> <i class="fa fa-angle-right text-base icon-ml"></i></a></li><li class="pagination-number">第 11 页 共 22 页</li></ul></div></section><footer id="footer" class="main-content-wrap"><span class="copyrights">Copyrights &copy; 2019 Roy. All Rights Reserved.</span></footer></div></div><div id="about"><div id="about-card"><div id="about-btn-close"><i class="fa fa-remove"></i></div><img id="about-card-picture" src="/assets/images/my.jpg" alt="作者的图片"><h4 id="about-card-name">Roy</h4><div id="about-card-bio"><p>君以国士待我，我必以国士报君。</p></div><div id="about-card-job"><i class="fa fa-briefcase"></i><br><p>野生程序猿</p></div><div id="about-card-location"><i class="fa fa-map-marker"></i><br>China</div></div></div><div id="algolia-search-modal" class="modal-container"><div class="modal"><div class="modal-header"><span class="close-button"><i class="fa fa-close"></i></span> <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled"><span class="searchby-algolia-text text-color-light text-small">by</span> <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg"> </a><i class="search-icon fa fa-search"></i><form id="algolia-search-form"><input type="text" id="algolia-search-input" name="search" class="form-control input--large search-input" placeholder="Search "></form></div><div class="modal-body"><div class="no-result text-color-light text-center">没有找到文章</div><div class="results"><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/02/12/Ubuntu下Gogant的简易破墙术/"><h3 class="media-heading">Ubuntu下Gogant的简易破墙术</h3></a><span class="media-meta"><span class="media-date text-small">2013年2月12日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/10/31/python常用第三方库-转载/"><h3 class="media-heading">Python常用第三方库(转载)</h3></a><span class="media-meta"><span class="media-date text-small">2013年10月31日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/fedora19安装ar8161网卡驱动/"><h3 class="media-heading">fedora19安装ar8161网卡驱动</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/fedora19源，rpmforge，fastestmirror/"><h3 class="media-heading">fedora19源，rpmforge，fastestmirror</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/python中如何自定义解析域名/"><h3 class="media-heading">python中如何自定义解析域名</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/django版本更换/"><h3 class="media-heading">django版本更换</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/django-groundwork个人1-5-3修改版/"><h3 class="media-heading">django-groundwork个人1.5.3修改版</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/fedora19美化/"><h3 class="media-heading">fedora19美化</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/装饰器/"><h3 class="media-heading">装饰器</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/SVN常用操作/"><h3 class="media-heading">SVN常用操作</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div></div></div><div class="modal-footer"><p class="results-count text-medium" data-message-zero="没有找到文章" data-message-one="找到 1 篇文章" data-message-other="找到 {n} 篇文章">找到 216 篇文章</p></div></div></div><div id="cover" style="background-image:url(/assets/images/cover.jpg)"></div><script src="/assets/js/script-ivwiy10zeb8fifc4swnhkwneuk64y53w2scmdmtp8thi9cqfxh31aowtroaz.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.14.1/moment-with-locales.min.js"></script><script src="//cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script><script>var algoliaClient=algoliasearch("51U8PIBLP6","16909d9ce1780cda71113841864e7aa8"),algoliaIndex=algoliaClient.initIndex("my-blog")</script></body></html>