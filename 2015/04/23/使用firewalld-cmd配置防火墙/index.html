<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Hi!Roy!"><title>使用firewalld-cmd配置防火墙 - Hi!Roy!</title><meta name="author" content="Roy"><link rel="icon" href="http://www.hi-roy.com/assets/images/favicon.ico"><link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml"><meta name="description" content="CentOS7和fedora中的默认防火墙都变成了firewalld，当然你也可以选择禁用这个并自己安装iptables，下面内容原文：这里，而且只翻译我用到的部分文章。原文中还展示了如何使用图形界面进行配置，不过作为键盘爱好者，能不用鼠标的就尽量不用鼠标了，直接上命令行操作。4.5.4 理解域概念firewalld可以根据不同的信任级别，将处于不同域内的设备进行分离。NetworkManager"><meta property="og:type" content="blog"><meta property="og:title" content="使用firewalld-cmd配置防火墙"><meta property="og:url" content="http://www.hi-roy.com/2015/04/23/使用firewalld-cmd配置防火墙/index.html"><meta property="og:site_name" content="Hi!Roy!"><meta property="og:description" content="CentOS7和fedora中的默认防火墙都变成了firewalld，当然你也可以选择禁用这个并自己安装iptables，下面内容原文：这里，而且只翻译我用到的部分文章。原文中还展示了如何使用图形界面进行配置，不过作为键盘爱好者，能不用鼠标的就尽量不用鼠标了，直接上命令行操作。4.5.4 理解域概念firewalld可以根据不同的信任级别，将处于不同域内的设备进行分离。NetworkManager"><meta property="og:locale" content="zh-cn"><meta property="og:updated_time" content="2019-09-16T08:11:51.513Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="使用firewalld-cmd配置防火墙"><meta name="twitter:description" content="CentOS7和fedora中的默认防火墙都变成了firewalld，当然你也可以选择禁用这个并自己安装iptables，下面内容原文：这里，而且只翻译我用到的部分文章。原文中还展示了如何使用图形界面进行配置，不过作为键盘爱好者，能不用鼠标的就尽量不用鼠标了，直接上命令行操作。4.5.4 理解域概念firewalld可以根据不同的信任级别，将处于不同域内的设备进行分离。NetworkManager"><meta property="og:image" content="http://www.hi-roy.com/assets/images/my.jpg"><link rel="stylesheet" href="/assets/css/style-sxklfps8ywgfyyjcowvnb4gxdgt0zjts3hsguljmv9uqanxjbnitrovtbrek.min.css"><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?21513ec2bcd577b3297a1b16da82fa40";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></head><body><div id="blog"><header id="header" data-behavior="4"><i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i><div class="header-title"><a class="header-title-link" href="/">Hi!Roy!</a></div><a class="header-right-icon" href="#about"><i class="fa fa-lg fa-question"></i></a></header><nav id="sidebar" data-behavior="4"><div class="sidebar-container"><div class="sidebar-profile"><a href="/#about"><img class="sidebar-profile-picture" src="/assets/images/my.jpg" alt="作者的图片"></a><h4 class="sidebar-profile-name">Roy</h4><h5 class="sidebar-profile-bio"><p>君以国士待我，我必以国士报君。</p></h5></div><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="/"><i class="sidebar-button-icon fa fa-lg fa-home"></i> <span class="sidebar-button-desc">首页</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-categories"><i class="sidebar-button-icon fa fa-lg fa-bookmark"></i> <span class="sidebar-button-desc">分类</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-tags"><i class="sidebar-button-icon fa fa-lg fa-tags"></i> <span class="sidebar-button-desc">标签</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-archives"><i class="sidebar-button-icon fa fa-lg fa-archive"></i> <span class="sidebar-button-desc">归档</span></a></li><li class="sidebar-button"><a class="sidebar-button-link open-algolia-search" href="#search"><i class="sidebar-button-icon fa fa-lg fa-search"></i> <span class="sidebar-button-desc">搜索</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="#about"><i class="sidebar-button-icon fa fa-lg fa-question"></i> <span class="sidebar-button-desc">关于</span></a></li></ul><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="https://github.com/shenyushun" target="_blank" rel="noopener"><i class="sidebar-button-icon fa fa-lg fa-github"></i> <span class="sidebar-button-desc">GitHub</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="mailto:darkcooking@gmail.com" target="_blank" rel="noopener"><i class="sidebar-button-icon fa fa-lg fa-envelope-o"></i> <span class="sidebar-button-desc">邮箱</span></a></li></ul><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="/atom.xml"><i class="sidebar-button-icon fa fa-lg fa-rss"></i> <span class="sidebar-button-desc">RSS</span></a></li></ul></div></nav><div id="main" data-behavior="4" class="hasCoverMetaIn"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><div class="post-header main-content-wrap text-left"><h1 class="post-title" itemprop="headline">使用firewalld-cmd配置防火墙</h1><div class="post-meta"><time itemprop="datePublished" datetime="2015-04-23T17:44:52+08:00">4月 23, 2015 </time><span>发布在 </span><a class="category-link" href="/source/all-categories/菜鸟翻译屋/">菜鸟翻译屋</a></div></div><div class="post-content markdown" itemprop="articleBody"><div class="main-content-wrap"><p>CentOS7和fedora中的默认防火墙都变成了firewalld，当然你也可以选择禁用这个并自己安装iptables，下面内容原文：<a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Security_Guide/sec-Using_Firewalls.html" target="_blank" rel="noopener">这里</a>，而且只翻译我用到的部分文章。原文中还展示了如何使用图形界面进行配置，不过作为键盘爱好者，能不用鼠标的就尽量不用鼠标了，直接上命令行操作。</p><hr><h3 id="4-5-4-理解域概念"><a href="#4-5-4-理解域概念" class="headerlink" title="4.5.4 理解域概念"></a>4.5.4 理解域概念</h3><p>firewalld可以根据不同的信任级别，将处于不同域内的设备进行分离。NetworkManager用于管理firewalld将接口分配到哪个域中，可以通过NetworkManager界面或filrewall-config工具来进行设置。</p><p>默认的配置文件位于/etc/firewalld/可以快速的应用在网络接口上，这里有一份关于域的简短的说明：</p><p>dorp:任何入站请求都被忽略，无任何回复，只有发起的网络链接请求被放行。</p><p>block:任何入站请求都被拒绝，ipv4协议回复”icmp-host-prohibited”消息，ipv6协议回复”icmp6-adm-prohibited”，只有从系统内部发出的链接请求才被放行。</p><p>（个人感觉上面两个区别就是在于有无回复，对内的话用block、对外用dorp好一些，让外部扫描费点劲才知道被防火墙过滤了）</p><p>public:为在公共场所准备，你不相信网络中的其他电脑不会对你的电脑造成伤害，只有被选定的入站链接被接受。</p><p>external:为有伪装的外部网络特别是路由器准备，你不相信网络中的其他电脑不会对你的电脑造成伤害，只有被选定的入站链接被接受。</p><p>dmz:为那些处于隔离区(demilitarized zone)可以访问部分内部网络的电脑准备，只有被选定的入站链接被接受。</p><p>work:为工作域的电脑准备，你相信网络中其他电脑不会对你的电脑造成伤害，只有被选定的入站链接被接受。</p><p>home:为家庭域的电脑准备，你相信网络中其他电脑不会对你的电脑造成伤害，只有被选定的入站链接被接受。</p><p>internal:为内部域的电脑准备，你相信网络中其他电脑不会对你的电脑造成伤害，只有被选定的入站链接被接受。</p><p>trusted:接受全部请求。</p><p>你可以指定一个域为默认域，当一个新接口被添加到NetworkManager中时，它将被分配到默认域中。在默认情况下public为默认域。</p><h3 id="4-5-6-理解预设服务"><a href="#4-5-6-理解预设服务" class="headerlink" title="4.5.6 理解预设服务"></a>4.5.6 理解预设服务</h3><p>如果一个服务可用的话，它应该有一份本地端口和目标端口的列表，同时防火墙辅助模块自动载入这份列表。使用预设服务可以让用户轻松控制服务是否可以被访问，通过使用预设服务或用户自定义服务的方式来控制访问权限而不是通过管理端口或端口范围也许让管理员更加轻松。(翻译的不好，意思就是只记mysql而不用记3306端口了)服务的配置选项和通用文件信息在firewalld.service(5)中有介绍。服务被指定使用xml文件格式并且命名为service-name.xml这种格式。<br>可以通过下面的命令查看默认的预设服务：<code>ls /usr/lib/firewalld/services/</code></p><p>不要修改/usr/lib/firewalld/services中的文件，只有/etc/firewalld/services/才可以被修改。</p><p>查看系统或用户创建的服务可以使用:<code>ls /etc/firewalld/services/</code></p><p>服务可以通过图形界面或编辑/etc/firewalld/services/中的文件来新增或删除，如果你还没添加或修改过任何一个服务，/etc/firewalld/services/目录下是没有任何文件的，可以把从/usr/lib/firewalld/services/中复制出一个文件作为模板，比如：<br><code>cp /usr/lib/firewalld/services/[service].xml /etc/firewalld/services/[service].xml</code></p><p>你也许想新建一个文件，firewalld更喜欢新文件在/etc/firewalld/services/中而非/usr/lib/firewalld/services/中。</p><h3 id="4-5-7-理解直接接口"><a href="#4-5-7-理解直接接口" class="headerlink" title="4.5.7 理解直接接口"></a>4.5.7 理解直接接口</h3><p>firewalld中有一个功能叫做”直接接口“，它能直接通过iptables、ip6tables、ebtables的规则，这是为应用准备而不是为用户准备的。如果你对iptables不是十分熟悉的话用直接接口是很危险的，这无意间可能导致防火墙规则漏洞。某些规则被添加时仍然被firewalld所追踪，所以还可以用firewalld查看那些应用程序使用直接接口引起变化的规则。可以通过在firewalld-cmd 添加–direct来使用直接接口。</p><p>直接接口的目的是让服务或程序在运行时添加特定的防火墙规则, 通过使用–permanent参数或修改/etc/firewalld/direct.xml文件可以让这些规则持久化。如果规则没被持久化，则每次重启、重加载时都要重新添加。</p><h3 id="4-5-15-3-通过命令行查看firewalld"><a href="#4-5-15-3-通过命令行查看firewalld" class="headerlink" title="4.5.15.3 通过命令行查看firewalld"></a>4.5.15.3 通过命令行查看firewalld</h3><p>查看状态：<br><code>firewall-cmd --state</code></p><p>查看当前域：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --get-active-zones</span><br><span class="line">public</span><br><span class="line">  interfaces: em1</span><br></pre></td></tr></table></figure><p></p><p>根据接口查看所属域：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --get-zone-of-interface=em1</span><br><span class="line">public</span><br></pre></td></tr></table></figure><p></p><p>查看某域下所有接口：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --list-interfaces</span><br><span class="line">em1 wlan0</span><br></pre></td></tr></table></figure><p></p><p>这个命令的结果来自Networkmanager而且只显示接口不显示链接。</p><p>查看某域的所有设定：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --list-all</span><br><span class="line">public</span><br><span class="line">  interfaces:</span><br><span class="line">  services: mdns dhcpv6-client ssh</span><br><span class="line">  ports:</span><br><span class="line">  forward-ports:</span><br><span class="line">  icmp-blocks: source-quench</span><br></pre></td></tr></table></figure><p></p><p>查看当前哪些服务被加载：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --get-services</span><br><span class="line">cluster-suite pop3s bacula-client smtp ipp radius bacula ftp mdns samba dhcpv6-client dns openvpn imaps samba-client http https ntp vnc-server telnet libvirt ssh ipsec ipp-client amanda-client tftp-client nfs tftp libvirt-tls</span><br></pre></td></tr></table></figure><p></p><p>这将展示出所有位于/usr/lib/firewalld/services/的预设服务和当前载入的所有用户自定义服务，注意xml文件名必须是<em>service-name</em>.xml。如果用户自定义服务以及创建但没被加载，可以使用命令：<code>firewall-cmd --permanent --get-services</code></p><p>这个命令将展示所有的服务，包括未被加载的那些位于/etc/firewalld/services/的服务。</p><h3 id="4-5-15-4-通过命令行设置firewalld"><a href="#4-5-15-4-通过命令行设置firewalld" class="headerlink" title="4.5.15.4 通过命令行设置firewalld"></a>4.5.15.4 通过命令行设置firewalld</h3><h4 id="4-5-15-4-1-忽略所有包"><a href="#4-5-15-4-1-忽略所有包" class="headerlink" title="4.5.15.4.1 忽略所有包"></a>4.5.15.4.1 忽略所有包</h4><p>使用下面的命令忽略所有入站和出站请求：<code>firewall-cmd --panic-on</code></p><p>已经建立的链接将在会话过期后被终止。重新接受所有请求：<code>firewall-cmd --panic-off</code></p><p>查看panic状态：<code>firewall-cmd --query-panic</code></p><p>yes为启用，no为关闭。</p><h4 id="4-5-15-4-2-重载防火墙"><a href="#4-5-15-4-2-重载防火墙" class="headerlink" title="4.5.15.4.2 重载防火墙"></a>4.5.15.4.2 重载防火墙</h4><p>重载防火墙但并不打断用户链接：<code>firewall-cmd --reload</code></p><p>重载防火墙同时打断用户链接：<code>firewall-cmd --complete-reload</code></p><p>通常情况这个命令只有在防火墙服务出问题了才被使用。</p><h4 id="4-5-15-4-3-通过命令行添加新接口到某个域"><a href="#4-5-15-4-3-通过命令行添加新接口到某个域" class="headerlink" title="4.5.15.4.3 通过命令行添加新接口到某个域"></a>4.5.15.4.3 通过命令行添加新接口到某个域</h4><p>更改接口到某个域:<code>firewall-cmd --zone=public --add-interface=em1</code></p><p>从域中删除某接口:<code>firewall-cmd --zone=dmz --change-interface=em1</code></p><p>如果想要持久化，记得添加–permanent参数以及重载防火墙:<code>firewall-cmd --zone=public --remove-interface=em1</code></p><h4 id="4-5-15-4-4-通过修改文件添加新接口到某个域"><a href="#4-5-15-4-4-通过修改文件添加新接口到某个域" class="headerlink" title="4.5.15.4.4 通过修改文件添加新接口到某个域"></a>4.5.15.4.4 通过修改文件添加新接口到某个域</h4><p>编辑ifcfg-em1文件(一般位于/ets/sysconfig/network-scripts目录)，添加<br><code>ZONE=work</code></p><p>如果你省略zone或zone=””,默认将使用默认域。修改完成后NetworkManager将自动重连并设置相应域。</p><h4 id="4-5-15-4-5-通过修改配置文件修改默认域"><a href="#4-5-15-4-5-通过修改配置文件修改默认域" class="headerlink" title="4.5.15.4.5 通过修改配置文件修改默认域"></a>4.5.15.4.5 通过修改配置文件修改默认域</h4><p>编辑 /etc/firewalld/firewalld.conf<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">default zone</span><br><span class="line"># The default zone used if an empty zone string is used.</span><br><span class="line"># Default: public</span><br><span class="line">DefaultZone=home</span><br></pre></td></tr></table></figure><p></p><p>保存后重载防火墙，这将中断所有链接。</p><h4 id="4-5-15-4-6-通过命令行修改默认域"><a href="#4-5-15-4-6-通过命令行修改默认域" class="headerlink" title="4.5.15.4.6 通过命令行修改默认域"></a>4.5.15.4.6 通过命令行修改默认域</h4><p>使用命令：<code>firewall-cmd --set-default-zone=public</code></p><p>将立即生效而不需要重载防火墙 。</p><h4 id="4-5-15-4-7-通过命令行开放端口"><a href="#4-5-15-4-7-通过命令行开放端口" class="headerlink" title="4.5.15.4.7 通过命令行开放端口"></a>4.5.15.4.7 通过命令行开放端口</h4><p>首先列出所有开放的端口，以dmz域为例：<code>firewall-cmd --zone=dmz --list-ports</code></p><p>注意，这里不会展示被–add-services参数打开的端口。</p><p>开放某域内的端口，比如开放dmz域的8080端口，命令如下：<code>firewall-cmd --zone=dmz --add-port=8080/tcp</code></p><p>开放某段的端口，命令如下：<code>firewall-cmd --zone=public --add-port=5060-5065/udp</code></p><p>如果需要的话，记得使用<code>--permanent</code>参数进行持久化。</p><h4 id="4-5-15-4-8-通过命令行添加删除服务到某域"><a href="#4-5-15-4-8-通过命令行添加删除服务到某域" class="headerlink" title="4.5.15.4.8 通过命令行添加删除服务到某域"></a>4.5.15.4.8 通过命令行添加删除服务到某域</h4><p>这里以smtp服务添加到work域为例：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=work --add-service=smtp</span><br><span class="line">firewall-cmd --zone=work --remove-service=smtp</span><br></pre></td></tr></table></figure><p></p><p>同样的添加<code>--permanent</code>进行持久化，如果你使用了这个参数并想立即生效，请重载防火墙。</p><h4 id="4-5-15-4-9-通过修改xml文件添加删除服务到某域"><a href="#4-5-15-4-9-通过修改xml文件添加删除服务到某域" class="headerlink" title="4.5.15.4.9 通过修改xml文件添加删除服务到某域"></a>4.5.15.4.9 通过修改xml文件添加删除服务到某域</h4><p>首先查看默认域文件：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ls /usr/lib/firewalld/zones/</span><br><span class="line">block.xml  drop.xml      home.xml      public.xml   work.xml</span><br><span class="line">dmz.xml    external.xml  internal.xml  trusted.xml</span><br></pre></td></tr></table></figure><p></p><p>不要编辑这些文件，如果/etc/firewalld/zones/目录中没有等效文件这些文件将被使用。</p><p>想查看哪些域文件被修改，使用：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls /etc/firewalld/zones/</span><br><span class="line">external.xml  public.xml  public.xml.old</span><br></pre></td></tr></table></figure><p></p><p>这里我们以向work域添加服务为例，首先：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/lib/firewalld/zones/work.xml /etc/firewalld/zones/</span><br></pre></td></tr></table></figure><p></p><p>现在可以编辑位于/etc/firewalld/zones下的文件了，以添加smtp服务为例，修改work.xml添加：<code>&lt;service name=&quot;smtp&quot;/&gt;</code></p><p>如果你删除了这个文件，那么/usr/lib/firewalld/zones/中的文件将被使用。</p><p>删除操作和添加相反，删除我们编辑的xml文件中添加的行就行了，就不翻了。</p><h4 id="4-5-14-4-12-ip地址伪装"><a href="#4-5-14-4-12-ip地址伪装" class="headerlink" title="4.5.14.4.12 ip地址伪装"></a>4.5.14.4.12 ip地址伪装</h4><p>查看:<code>firewall-cmd --zone=external --query-masquerade</code></p><p>启用:<code>firewall-cmd --zone=external --add-masquerade</code></p><p>禁用:<code>firewall-cmd --zone=external --remove-masquerade</code></p><p>记得添加<code>--permanent</code>以及重载防火墙。</p><h4 id="4-5-14-4-12-端口转发"><a href="#4-5-14-4-12-端口转发" class="headerlink" title="4.5.14.4.12 端口转发"></a>4.5.14.4.12 端口转发</h4><p>想要进行端口转发，先要启用ip地址伪装，然后使用:<code>firewall-cmd --zone=external --add-forward-port=port=22:proto=tcp:toport=3753</code></p><p>上面的例子中把external域中22端口转发给本机的3753端口，协议为tcp。其中端口可以是一个端口也可以是端口范围，而proto则只能是tcp或udp的协议中的一个。</p><p>如果是转发给另一个ip，通常是内部Ip并且端口不变，则<code>firewall-cmd --zone=external --add-forward-port=port=22:proto=tcp:toaddr=192.0.2.55</code></p><p>如果端口也变了:<code>firewall-cmd --zone=external --add-forward-port=port=22:proto=tcp:toport=2055:toaddr=192.0.2.55</code></p><p>记得添加<code>--permanent</code>以及重载防火墙。</p><h3 id="4-5-14-6-使用直接接口"><a href="#4-5-14-6-使用直接接口" class="headerlink" title="4.5.14.6 使用直接接口"></a>4.5.14.6 使用直接接口</h3><p>车轱辘话略过，见上面</p><h4 id="4-5-14-6-1-添加用户规则"><a href="#4-5-14-6-1-添加用户规则" class="headerlink" title="4.5.14.6.1 添加用户规则"></a>4.5.14.6.1 添加用户规则</h4><p>添加规则链<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --direct --add-rule ipv4 filter IN_public_allow \</span><br><span class="line">      0 -m tcp -p tcp --dport 666 -j ACCEPT</span><br></pre></td></tr></table></figure><p></p><h4 id="4-5-14-6-2-删除用户规则"><a href="#4-5-14-6-2-删除用户规则" class="headerlink" title="4.5.14.6.2 删除用户规则"></a>4.5.14.6.2 删除用户规则</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --direct --remove-rule ipv4 filter IN_public_allow \</span><br><span class="line">      0 -m tcp -p tcp --dport 666 -j ACCEPT</span><br></pre></td></tr></table></figure><h4 id="4-5-14-6-3-展示用户规则"><a href="#4-5-14-6-3-展示用户规则" class="headerlink" title="4.5.14.6.3 展示用户规则"></a>4.5.14.6.3 展示用户规则</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --direct --get-rules ipv4 filter IN_public_allow</span><br></pre></td></tr></table></figure><p>如果需要的话，同样使用<code>--permanent</code>以及重载防火墙。</p><hr><p>翻到后面发现车轮话太多了，就只进行了意译，而且个人也就使用开放端口、转发一类的常见操作，高深地方就不不翻译了，用到了在说吧。注意的就是如果不加<code>--permanent</code>参数则会实时生效，但重启或重加载后会失效。加<code>--permanent</code>参数则不会实时生效，需要重新reload。<br>再补充一些东西，类似于黑白名单机制，比如我想根据来源ip来分配不同的域规则，则相关命令如下<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --zone=public --list-sources</span><br><span class="line">firewall-cmd --permanent --zone=public --add-source=192.168.100.0/24</span><br><span class="line">firewall-cmd --permanent --zone=public --add-source=192.168.222.123/32</span><br><span class="line">firewall-cmd --permanent --zone=public --add-port=1-22/tcp</span><br><span class="line">firewall-cmd --permanent --zone=public --add-port=1-22/udp</span><br></pre></td></tr></table></figure><p></p><p>有add-source、port自然就会有remove-source、port了，当你只想让某些指定的ip访问某些服务的话，就可以把这些ip放到相应的域内，加载规则如下:</p><ol><li>如果一个包的来源已经绑定在某个域内，则使用这个域的规则。</li><li>如果一个包的来源没绑定任何一个域，但来源访问的接口绑定了某个域（比如eth0），则使用端口绑定的域规则。</li><li>如果一个包的来源和来源接口都没绑定某个域，则使用默认域规则。<br>这里还要注意，一个ip地址只能属于一个域，否则会提示域冲突。</li></ol></div></div><div id="post-footer" class="post-footer main-content-wrap"><div class="post-actions-wrap"><nav><ul class="post-actions post-action-nav"><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/2015/04/26/理财记录3/" data-tooltip="理财记录3"><i class="fa fa-angle-left"></i> <span class="hide-xs hide-sm text-small icon-ml">上一篇</span></a></li><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/2015/04/22/fedora21安装有道词典linux版/" data-tooltip="fedora21安装有道词典linux版"><span class="hide-xs hide-sm text-small icon-mr">下一篇</span> <i class="fa fa-angle-right"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions"><i class="fa fa-share-alt"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://www.hi-roy.com/2015/04/23/使用firewalld-cmd配置防火墙/"><i class="fa fa-facebook-official"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://www.hi-roy.com/2015/04/23/使用firewalld-cmd配置防火墙/"><i class="fa fa-twitter"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://www.hi-roy.com/2015/04/23/使用firewalld-cmd配置防火墙/"><i class="fa fa-google-plus"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://service.weibo.com/share/share.php?&amp;title=http://www.hi-roy.com/2015/04/23/使用firewalld-cmd配置防火墙/"><i class="fa fa-weibo"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.hi-roy.com/2015/04/23/使用firewalld-cmd配置防火墙/&amp;title=使用firewalld-cmd配置防火墙"><i class="fa fa-qq"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://www.hi-roy.com/2015/04/23/使用firewalld-cmd配置防火墙/"><i class="fa fa-star"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://widget.renren.com/dialog/share?resourceUrl=http://www.hi-roy.com/2015/04/23/使用firewalld-cmd配置防火墙/"><i class="fa fa-renren"></i></a></li><li class="post-action"><a class="post-action-btn btn btn--default" href="#"><i class="fa fa-list"></i></a></li></ul></div></div></article><footer id="footer" class="main-content-wrap"><span class="copyrights">Copyrights &copy; 2020 Roy. All Rights Reserved.</span></footer></div><div id="bottom-bar" class="post-bottom-bar" data-behavior="4"><div class="post-actions-wrap"><nav><ul class="post-actions post-action-nav"><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/2015/04/26/理财记录3/" data-tooltip="理财记录3"><i class="fa fa-angle-left"></i> <span class="hide-xs hide-sm text-small icon-ml">上一篇</span></a></li><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/2015/04/22/fedora21安装有道词典linux版/" data-tooltip="fedora21安装有道词典linux版"><span class="hide-xs hide-sm text-small icon-mr">下一篇</span> <i class="fa fa-angle-right"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions"><i class="fa fa-share-alt"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://www.hi-roy.com/2015/04/23/使用firewalld-cmd配置防火墙/"><i class="fa fa-facebook-official"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://www.hi-roy.com/2015/04/23/使用firewalld-cmd配置防火墙/"><i class="fa fa-twitter"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://www.hi-roy.com/2015/04/23/使用firewalld-cmd配置防火墙/"><i class="fa fa-google-plus"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://service.weibo.com/share/share.php?&amp;title=http://www.hi-roy.com/2015/04/23/使用firewalld-cmd配置防火墙/"><i class="fa fa-weibo"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.hi-roy.com/2015/04/23/使用firewalld-cmd配置防火墙/&amp;title=使用firewalld-cmd配置防火墙"><i class="fa fa-qq"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://www.hi-roy.com/2015/04/23/使用firewalld-cmd配置防火墙/"><i class="fa fa-star"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://widget.renren.com/dialog/share?resourceUrl=http://www.hi-roy.com/2015/04/23/使用firewalld-cmd配置防火墙/"><i class="fa fa-renren"></i></a></li><li class="post-action"><a class="post-action-btn btn btn--default" href="#"><i class="fa fa-list"></i></a></li></ul></div></div><div id="share-options-bar" class="share-options-bar" data-behavior="4"><i id="btn-close-shareoptions" class="fa fa-close"></i><ul class="share-options"><li class="share-option"><a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://www.hi-roy.com/2015/04/23/使用firewalld-cmd配置防火墙/"><i class="fa fa-facebook-official"></i><span>分享到 Facebook</span></a></li><li class="share-option"><a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=http://www.hi-roy.com/2015/04/23/使用firewalld-cmd配置防火墙/"><i class="fa fa-twitter"></i><span>分享到 Twitter</span></a></li><li class="share-option"><a class="share-option-btn" target="new" href="https://plus.google.com/share?url=http://www.hi-roy.com/2015/04/23/使用firewalld-cmd配置防火墙/"><i class="fa fa-google-plus"></i><span>分享到 Google+</span></a></li><li class="share-option"><a class="share-option-btn" target="new" href="http://service.weibo.com/share/share.php?&amp;title=http://www.hi-roy.com/2015/04/23/使用firewalld-cmd配置防火墙/"><i class="fa fa-weibo"></i><span>分享到 Weibo</span></a></li><li class="share-option"><a class="share-option-btn" target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.hi-roy.com/2015/04/23/使用firewalld-cmd配置防火墙/&amp;title=使用firewalld-cmd配置防火墙"><i class="fa fa-qq"></i><span>分享到 QQ</span></a></li><li class="share-option"><a class="share-option-btn" target="new" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://www.hi-roy.com/2015/04/23/使用firewalld-cmd配置防火墙/"><i class="fa fa-star"></i><span>分享到 Qzone</span></a></li><li class="share-option"><a class="share-option-btn" target="new" href="http://widget.renren.com/dialog/share?resourceUrl=http://www.hi-roy.com/2015/04/23/使用firewalld-cmd配置防火墙/"><i class="fa fa-renren"></i><span>分享到 Renren</span></a></li></ul></div></div><div id="about"><div id="about-card"><div id="about-btn-close"><i class="fa fa-remove"></i></div><img id="about-card-picture" src="/assets/images/my.jpg" alt="作者的图片"><h4 id="about-card-name">Roy</h4><div id="about-card-bio"><p>君以国士待我，我必以国士报君。</p></div><div id="about-card-job"><i class="fa fa-briefcase"></i><br><p>野生程序猿</p></div><div id="about-card-location"><i class="fa fa-map-marker"></i><br>China</div></div></div><div id="algolia-search-modal" class="modal-container"><div class="modal"><div class="modal-header"><span class="close-button"><i class="fa fa-close"></i></span> <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled"><span class="searchby-algolia-text text-color-light text-small">by</span> <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg"> </a><i class="search-icon fa fa-search"></i><form id="algolia-search-form"><input type="text" id="algolia-search-input" name="search" class="form-control input--large search-input" placeholder="Search "></form></div><div class="modal-body"><div class="no-result text-color-light text-center">没有找到文章</div><div class="results"><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/02/12/Ubuntu下Gogant的简易破墙术/"><h3 class="media-heading">Ubuntu下Gogant的简易破墙术</h3></a><span class="media-meta"><span class="media-date text-small">2013年2月12日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/10/31/python常用第三方库-转载/"><h3 class="media-heading">Python常用第三方库(转载)</h3></a><span class="media-meta"><span class="media-date text-small">2013年10月31日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/fedora19安装ar8161网卡驱动/"><h3 class="media-heading">fedora19安装ar8161网卡驱动</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/fedora19源，rpmforge，fastestmirror/"><h3 class="media-heading">fedora19源，rpmforge，fastestmirror</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/python中如何自定义解析域名/"><h3 class="media-heading">python中如何自定义解析域名</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/django版本更换/"><h3 class="media-heading">django版本更换</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/django-groundwork个人1-5-3修改版/"><h3 class="media-heading">django-groundwork个人1.5.3修改版</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/fedora19美化/"><h3 class="media-heading">fedora19美化</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/装饰器/"><h3 class="media-heading">装饰器</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/SVN常用操作/"><h3 class="media-heading">SVN常用操作</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div></div></div><div class="modal-footer"><p class="results-count text-medium" data-message-zero="没有找到文章" data-message-one="找到 1 篇文章" data-message-other="找到 {n} 篇文章">找到 230 篇文章</p></div></div></div><div id="cover" style="background-image:url(/assets/images/cover.jpg)"></div><script src="/assets/js/script-ivwiy10zeb8fifc4swnhkwneuk64y53w2scmdmtp8thi9cqfxh31aowtroaz.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.14.1/moment-with-locales.min.js"></script><script src="//cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script><script>var algoliaClient=algoliasearch("51U8PIBLP6","16909d9ce1780cda71113841864e7aa8"),algoliaIndex=algoliaClient.initIndex("my-blog")</script></body></html>