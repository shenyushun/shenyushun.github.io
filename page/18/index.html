<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Hi!Roy!"><title>Hi!Roy!</title><meta name="author" content="Roy"><link rel="icon" href="http://www.hi-roy.com/assets/images/favicon.ico"><link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml"><meta property="og:type" content="blog"><meta property="og:title" content="Hi!Roy!"><meta property="og:url" content="http://www.hi-roy.com/page/18/index.html"><meta property="og:site_name" content="Hi!Roy!"><meta property="og:locale" content="zh-cn"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Hi!Roy!"><meta property="og:image" content="http://www.hi-roy.com/assets/images/my.jpg"><link rel="stylesheet" href="/assets/css/style-sxklfps8ywgfyyjcowvnb4gxdgt0zjts3hsguljmv9uqanxjbnitrovtbrek.min.css"><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?21513ec2bcd577b3297a1b16da82fa40";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></head><body><div id="blog"><header id="header" data-behavior="1"><i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i><div class="header-title"><a class="header-title-link" href="/">Hi!Roy!</a></div><a class="header-right-icon" href="#about"><i class="fa fa-lg fa-question"></i></a></header><nav id="sidebar" data-behavior="1"><div class="sidebar-container"><div class="sidebar-profile"><a href="/#about"><img class="sidebar-profile-picture" src="/assets/images/my.jpg" alt="作者的图片"></a><h4 class="sidebar-profile-name">Roy</h4><h5 class="sidebar-profile-bio"><p>君以国士待我，我必以国士报君。</p></h5></div><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="/"><i class="sidebar-button-icon fa fa-lg fa-home"></i> <span class="sidebar-button-desc">首页</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-categories"><i class="sidebar-button-icon fa fa-lg fa-bookmark"></i> <span class="sidebar-button-desc">分类</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-tags"><i class="sidebar-button-icon fa fa-lg fa-tags"></i> <span class="sidebar-button-desc">标签</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-archives"><i class="sidebar-button-icon fa fa-lg fa-archive"></i> <span class="sidebar-button-desc">归档</span></a></li><li class="sidebar-button"><a class="sidebar-button-link open-algolia-search" href="#search"><i class="sidebar-button-icon fa fa-lg fa-search"></i> <span class="sidebar-button-desc">搜索</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="#about"><i class="sidebar-button-icon fa fa-lg fa-question"></i> <span class="sidebar-button-desc">关于</span></a></li></ul><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="https://github.com/shenyushun" target="_blank" rel="noopener"><i class="sidebar-button-icon fa fa-lg fa-github"></i> <span class="sidebar-button-desc">GitHub</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="mailto:darkcooking@gmail.com" target="_blank" rel="noopener"><i class="sidebar-button-icon fa fa-lg fa-envelope-o"></i> <span class="sidebar-button-desc">邮箱</span></a></li></ul><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="/atom.xml"><i class="sidebar-button-icon fa fa-lg fa-rss"></i> <span class="sidebar-button-desc">RSS</span></a></li></ul></div></nav><div id="main" data-behavior="1" class="hasCoverMetaIn"><section class="postShorten-group main-content-wrap"><article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemtype="http://schema.org/BlogPosting"><div class="postShorten-wrap"><div class="postShorten-header"><h1 class="postShorten-title" itemprop="headline"><a class="link-unstyled" href="/2014/04/14/虚拟环境pycurl的import错误/">虚拟环境pycurl的import错误</a></h1><div class="postShorten-meta"><time itemprop="datePublished" datetime="2014-04-14T11:56:49+08:00">4月 14, 2014 </time><span>发布在 </span><a class="category-link" href="/source/all-categories/Python/">Python</a></div></div><div class="postShorten-content" itemprop="articleBody"><p>今天需要在虚拟环境下使用pycurl，使用pip安装时候没问题，不过再代码中import后则报错：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ImportError: pycurl: libcurl link-time ssl backend (nss) is different from compile-time ssl backend (none/other)</span><br></pre></td></tr></table></figure><p></p><p>解决方法：</p><ol><li>卸载pip uninstall pycurl</li><li>执行：export PYCURL_SSL_LIBRARY=nss</li><li>使用easy_install pycurl重新安装。</li></ol><p>转自<a href="http://www.tuicool.com/articles/qAFBvi" target="_blank" rel="noopener">http://www.tuicool.com/articles/qAFBvi</a></p><p><a href="/2014/04/14/虚拟环境pycurl的import错误/#post-footer" class="postShorten-excerpt_link link">评论和分享</a></p></div></div></article><article class="postShorten postShorten--thumbnailimg-right" itemscope itemtype="http://schema.org/BlogPosting"><div class="postShorten-wrap"><div class="postShorten-header"><h1 class="postShorten-title" itemprop="headline"><a class="link-unstyled" href="/2014/04/10/调试python程序/">调试python程序</a></h1><div class="postShorten-meta"><time itemprop="datePublished" datetime="2014-04-10T18:06:03+08:00">4月 10, 2014 </time><span>发布在 </span><a class="category-link" href="/source/all-categories/Python/">Python</a></div></div><div class="postShorten-excerpt" itemprop="articleBody"><p>怪不得这几天头疼的厉害，原来是发生了2件大事：官方的XP彻底和我们告别了and爆发了OpenSSL HeartBleed漏洞。这个漏洞可以说是一场大地震，不知道又会有多少网站被“扒光脱裤”，过一阵又得改密码玩了。面对这种网络安全问题，真的是一种待宰羔羊的无力感。</p><p>调试python程序我知道有3个东东：pdb,ipdb,pudb。</p><p>第一个是python自带模块，第二个如果安了ipython的话貌似自己就被安装了，最后一个有图形界面，十分复古的——蓝底，真是让人怀念。后2个都可以使用pip安装。<br>ipdb支持语法高亮，不过貌似中文支持不太好。</p><a href="/2014/04/10/调试python程序/" class="postShorten-excerpt_link link">阅读全文</a></div></div></article><article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemtype="http://schema.org/BlogPosting"><div class="postShorten-wrap"><div class="postShorten-header"><h1 class="postShorten-title" itemprop="headline"><a class="link-unstyled" href="/2014/04/09/python列表展开/">python列表展开</a></h1><div class="postShorten-meta"><time itemprop="datePublished" datetime="2014-04-09T16:27:16+08:00">4月 09, 2014 </time><span>发布在 </span><a class="category-link" href="/source/all-categories/Python/">Python</a></div></div><div class="postShorten-content" itemprop="articleBody"><p>某网站今年笔试题，本质就是把某多维数组变成一维数组并去重。本来要求用JS实现，不过用python更简洁一点，就是对列表进行展开操作，递归就KO了。</p><p>首先来个不简洁的：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">arr = [<span class="number">1</span>, [<span class="number">1</span>, <span class="number">2</span>, [<span class="number">2</span>, <span class="number">3</span>]], [<span class="number">4</span>], [<span class="number">4</span>]]</span><br><span class="line">final=[]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"x is:"</span>,x</span><br><span class="line">    <span class="keyword">if</span> isinstance(x, list):</span><br><span class="line">        <span class="keyword">for</span> l <span class="keyword">in</span> x:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"l is:"</span>,l</span><br><span class="line">            change(l)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        final.append(x)</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"now final is"</span>,final</span><br><span class="line">change(arr)</span><br><span class="line"><span class="keyword">print</span> final</span><br></pre></td></tr></table></figure><p></p><p>简洁的：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">change = <span class="keyword">lambda</span> x: [y <span class="keyword">for</span> l <span class="keyword">in</span> x <span class="keyword">for</span> y <span class="keyword">in</span> change(l)] <span class="keyword">if</span> type(x) <span class="keyword">is</span> list <span class="keyword">else</span> [x]</span><br><span class="line"><span class="keyword">print</span> change(arr)</span><br></pre></td></tr></table></figure><p></p><p>至于去重就使用set()就可以了。</p><p><a href="/2014/04/09/python列表展开/#post-footer" class="postShorten-excerpt_link link">评论和分享</a></p></div></div></article><article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemtype="http://schema.org/BlogPosting"><div class="postShorten-wrap"><div class="postShorten-header"><h1 class="postShorten-title" itemprop="headline"><a class="link-unstyled" href="/2014/04/09/Mongodb初用记录/">Mongodb初用记录</a></h1><div class="postShorten-meta"><time itemprop="datePublished" datetime="2014-04-09T09:06:23+08:00">4月 09, 2014 </time><span>发布在 </span><a class="category-link" href="/source/all-categories/Linux/">Linux</a></div></div><div class="postShorten-content" itemprop="articleBody"><p>关于介绍以及缺点等网上介绍很多，这里记录一下我遇到的问题：</p><p>首先就是使用yum install安装后的mongodb无法设定开机启动。其次，即使修改了/etc/monggdb.conf文件的相关路径，运行时还必须手动指定dbpath参数才可运行。</p><p>于是按照官方指南说明的方法，添加了mongodb的源，安装yum install mongo-10gen mongo-10gen-server之后chkconfig mongod on才能设定成为开机启动。不过使用service mongod start启动、停止、重起服务会出现假死。但是不影响使用。</p><p>配置文件为：/etc/mongod.conf</p><p>初始化脚本为：/etc/rc.d/init.d/mongod</p><p>数据存储路径：/var/lib/mongo/</p><p>日志文件存储路径：/var/log/mongo/</p><p>守护进程运行用户为：mongod</p><p>任何数据最最基本的操作不外乎增删改查：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.test.save(&#123;a:1&#125;)</span><br><span class="line">&gt; db.test.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;530d3ec2d93e8e1410a1caf6&quot;), &quot;a&quot; : 1 &#125;</span><br><span class="line">&gt; doc = &#123;author:&apos;xsy&apos;,created: new Date(&apos;02/26/2014&apos;)&#125;</span><br><span class="line">&#123; &quot;author&quot; : &quot;xsy&quot;, &quot;created&quot; : ISODate(&quot;2014-02-25T16:00:00Z&quot;) &#125;</span><br><span class="line">&gt; db.test.insert(doc)</span><br><span class="line">&gt; db.test.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;530d3ec2d93e8e1410a1caf6&quot;), &quot;a&quot; : 1 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;530d3f1ed93e8e1410a1caf7&quot;), &quot;author&quot; : &quot;xsy&quot;, &quot;created&quot; : ISODate(&quot;2014-02-25T16:00:00Z&quot;) &#125;</span><br><span class="line">&gt; db.test.update(&#123;author:&apos;xsy&apos;&#125;,&#123;$inc:&#123;check:400&#125;&#125;)</span><br><span class="line">&gt; db.test.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;530d3ec2d93e8e1410a1caf6&quot;), &quot;a&quot; : 1 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;530d3f1ed93e8e1410a1caf7&quot;), &quot;author&quot; : &quot;xsy&quot;, &quot;check&quot; : 400, &quot;created&quot; : ISODate(&quot;2014-02-25T16:00:00Z&quot;) &#125;</span><br><span class="line">&gt; db.test.remove(&#123;a:1&#125;)删除</span><br><span class="line">&gt; db.test.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;530d3f1ed93e8e1410a1caf7&quot;), &quot;author&quot; : &quot;xsy&quot;, &quot;check&quot; : 400, &quot;created&quot; : ISODate(&quot;2014-02-25T16:00:00Z&quot;) &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure><p></p><p>更换数据库：默认情况下启动mongodb shell后自动使用的是test库，想换的话使用命令 use newname:<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; use mydb</span><br><span class="line">switched to db mydb</span><br><span class="line">&gt; db.mydb.save(&#123;a:2&#125;)</span><br><span class="line">&gt; db.test.find()</span><br><span class="line">&gt; db.mydb.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;530d498ed93e8e1410a1caf8&quot;), &quot;a&quot; : 2 &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure><p></p><p>如上所示，当切换（或者说新建）数据库mydb后，再查询test数据是不显示的。而数据库目录下也多处了mydb.ns、mydb.0等相关文件。</p><p>看了增删改查的操作后，发现mongodb的操作更类似于编程语言，操作都是对于函数的调用，条件则是函数的参数。而且居然还支持正则表达式的查询方式，甚至for\foreach这两种循环都有。带$符号的则是关键字。</p><p>啊哈，mongodb的存储过程居然是用js写，书到用时方恨少阿！！真得抽时间学学JS了…</p><p>继续看，发现可以直接把文件存放在mongo数据库中，用到了gridfs。突然想起，mysql中有一种类型叫做blob，用于存放文件。</p><p>要在python中操作mongodb，需要一个pymongo,文档：<a href="http://api.mongodb.org/python/current/tutorial.html" target="_blank" rel="noopener">http://api.mongodb.org/python/current/tutorial.html</a></p><p><a href="/2014/04/09/Mongodb初用记录/#post-footer" class="postShorten-excerpt_link link">评论和分享</a></p></div></div></article><article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemtype="http://schema.org/BlogPosting"><div class="postShorten-wrap"><div class="postShorten-header"><h1 class="postShorten-title" itemprop="headline"><a class="link-unstyled" href="/2014/04/04/django自带的评论模块/">django自带的评论模块</a></h1><div class="postShorten-meta"><time itemprop="datePublished" datetime="2014-04-04T11:01:59+08:00">4月 04, 2014 </time><span>发布在 </span><a class="category-link" href="/source/all-categories/Django/">Django</a></div></div><div class="postShorten-content" itemprop="articleBody"><p>某个设计本来采用了一个比较不错的在线评论模块，不过答辩的时候丫居然不给网！！想偷个懒还是挺难啊….</p><p>那就用自带的评论模块吧，django版本是1.5.3。</p><p>首先把<code>&#39;django.contrib.comments&#39;</code>添加到INSTALLED_APPS中，然后添加url:<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = patterns(<span class="string">''</span>,</span><br><span class="line">......</span><br><span class="line">url(<span class="string">r'^comments/'</span>, include(<span class="string">'django.contrib.comments.urls'</span>)),</span><br><span class="line">......</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p></p><p>在需要显示评论的HTML中：<br></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% load comments %&#125;</span><br><span class="line">&#123;% render_comment_list for post %&#125; &lt;!--显示所有属于这个文章的评论--&gt;</span><br><span class="line">&#123;% render_comment_form for post %&#125; &lt;!--显示自带的添加评论的form--&gt;</span><br></pre></td></tr></table></figure><p></p><p>不过自带的添加评论实在太丑了，我们可以自己改造一下：<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;% get_comment_form for post as form %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">'&#123;%comment_form_target%&#125;'</span> <span class="attr">method</span>=<span class="string">'post'</span>&gt;</span></span><br><span class="line">    &#123;% csrf_token %&#125;</span><br><span class="line">    &#123;&#123;form.object_pk&#125;&#125;</span><br><span class="line">    &#123;&#123;form.content_type&#125;&#125;</span><br><span class="line">    &#123;&#123;form.timestamp&#125;&#125;</span><br><span class="line">    &#123;&#123;form.security_hash&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"id_name"</span>&gt;</span>姓名（必填）：<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">id</span>=<span class="string">"id_name"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"id_email"</span>&gt;</span>邮箱（必填）：<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"email"</span> <span class="attr">id</span>=<span class="string">"id_email"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"id_url"</span>&gt;</span>网站（可选）：<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">id</span>=<span class="string">"id_url"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"id_comment"</span>&gt;</span>评论（必填）：<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">"id_comment"</span> <span class="attr">rows</span>=<span class="string">"10"</span> <span class="attr">cols</span>=<span class="string">"40"</span> <span class="attr">name</span>=<span class="string">"comment"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">"display:none;"</span>&gt;</span><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"id_honeypot"</span>&gt;</span>垃圾评论。<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"honeypot"</span> <span class="attr">id</span>=<span class="string">"id_honeypot"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"post"</span> <span class="attr">value</span>=<span class="string">"发表"</span> <span class="attr">type</span>=<span class="string">"submit"</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'hidden'</span> <span class="attr">name</span>=<span class="string">'next'</span> <span class="attr">value</span>=<span class="string">"/blog/post/&#123;&#123;post.id&#125;&#125;"</span>/&gt;</span> <span class="comment">&lt;!--这个是提交后的重定向，使用软编码总报错...--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>然后再进行CSS或者JS一类的特效美化就OK了。</p><p><a href="/2014/04/04/django自带的评论模块/#post-footer" class="postShorten-excerpt_link link">评论和分享</a></p></div></div></article><article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemtype="http://schema.org/BlogPosting"><div class="postShorten-wrap"><div class="postShorten-header"><h1 class="postShorten-title" itemprop="headline"><a class="link-unstyled" href="/2014/04/01/django中由类实例引起的小坑/">django中由类实例引起的小坑</a></h1><div class="postShorten-meta"><time itemprop="datePublished" datetime="2014-04-01T11:38:13+08:00">4月 01, 2014 </time><span>发布在 </span><a class="category-link" href="/source/all-categories/Django/">Django</a></div></div><div class="postShorten-content" itemprop="articleBody"><p>自己封装了一个logging在django中使用，结果发现输出的时候总是重复输出，比如：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">DEBUG---- 2014/03/31 10:38:13:</span><br><span class="line">!!</span><br><span class="line">DEBUG---- 2014/03/31 10:38:13:</span><br><span class="line">!!</span><br><span class="line">DEBUG---- 2014/03/31 10:38:13:</span><br><span class="line">!!</span><br><span class="line">DEBUG---- 2014/03/31 10:38:13:</span><br><span class="line">!!</span><br><span class="line">DEBUG---- 2014/03/31 10:38:13:</span><br><span class="line">140091903388560</span><br><span class="line">DEBUG---- 2014/03/31 10:38:13:</span><br><span class="line">140091903388560</span><br><span class="line">DEBUG---- 2014/03/31 10:38:13:</span><br><span class="line">140091903388560</span><br><span class="line">DEBUG---- 2014/03/31 10:38:13:</span><br><span class="line">140091903388560</span><br></pre></td></tr></table></figure><p></p><p>可以看出，id都是一样的。而且我查了一下，正好4个地方引入了mylog。mylog的完整代码见以前日志，这里给出导致错误的原因：<br><code>self.logger = logging.getLogger(__name__)</code></p><p>简单测试：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mlog = MyLog()</span><br><span class="line"><span class="keyword">print</span> id(mlog)</span><br><span class="line"><span class="keyword">print</span> id(mlog.logger)</span><br><span class="line">xmlog = MyLog()</span><br><span class="line"><span class="keyword">print</span> id(xmlog)</span><br><span class="line"><span class="keyword">print</span> id(xmlog.logger)</span><br></pre></td></tr></table></figure><p></p><p>结果如下：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">123456666</span><br><span class="line">123456789</span><br><span class="line">123457777</span><br><span class="line">123456789</span><br></pre></td></tr></table></figure><p></p><p>可以看出虽然类id不同，不过核心的logger却是一个。因为我们执行runserver后，<code>__name__</code>就确定为mylog了，所以不管我们引用的时候如何写，<code>__name__</code>不变则都指向了同一个logger。更简单的例子如下：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: x = <span class="number">1</span></span><br><span class="line">In [<span class="number">2</span>]: y = <span class="number">1</span></span><br><span class="line">In [<span class="number">3</span>]: id(x)</span><br><span class="line">Out[<span class="number">3</span>]: <span class="number">11279464</span></span><br><span class="line">In [<span class="number">4</span>]: id(y)</span><br><span class="line">Out[<span class="number">4</span>]: <span class="number">11279464</span></span><br></pre></td></tr></table></figure><p></p><p>更细节的原因可以看《python源码分析》。</p><p>改起来就让<code>__name__</code>不一样就解决了。比如：</p><p><code>self.logger = logging.getLogger(str(uuid.uuid4()))</code></p><p><a href="/2014/04/01/django中由类实例引起的小坑/#post-footer" class="postShorten-excerpt_link link">评论和分享</a></p></div></div></article><article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemtype="http://schema.org/BlogPosting"><div class="postShorten-wrap"><div class="postShorten-header"><h1 class="postShorten-title" itemprop="headline"><a class="link-unstyled" href="/2014/03/27/mysql-python-not-all-arguments-converted-during-string-formatting/">mysql-python:not all arguments converted during string formatting</a></h1><div class="postShorten-meta"><time itemprop="datePublished" datetime="2014-03-27T18:07:49+08:00">3月 27, 2014 </time><span>发布在 </span><a class="category-link" href="/source/all-categories/Python/">Python</a></div></div><div class="postShorten-content" itemprop="articleBody"><p>今天把django从1.5.5升级到了1.6.2，结果使用mysql-python查询数据库时候就报了这个错误：“not all arguments converted during string formatting”</p><p>貌似这个问题应该和django没什么关系，正好今天就看看mysql-python的源码吧。想看如何解决的请直接跳到最后。</p><p>查询部分简化后如下：<br></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">posistion = "top"</span><br><span class="line">order = r"<span class="keyword">select</span> <span class="keyword">id</span>,p_name,p_explain,p_href <span class="keyword">from</span> pictures <span class="keyword">where</span> p_position = %s <span class="keyword">and</span> p_show = <span class="number">1</span> <span class="keyword">order</span> <span class="keyword">by</span> -<span class="keyword">id</span><span class="string">"</span></span><br><span class="line"><span class="string">self.cur.execute(order, position)</span></span><br></pre></td></tr></table></figure><p></p><p>mysql-python中execute函数：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">execute</span><span class="params">(self, query, args=None)</span>:</span></span><br><span class="line">        <span class="string">"""Execute a query.</span></span><br><span class="line"><span class="string">        query -- string, query to execute on server</span></span><br><span class="line"><span class="string">        args -- optional sequence or mapping, parameters to use with query.</span></span><br><span class="line"><span class="string">        Note: If args is a sequence, then %s must be used as the</span></span><br><span class="line"><span class="string">        parameter placeholder in the query. If a mapping is used,</span></span><br><span class="line"><span class="string">        %(key)s must be used as the placeholder.</span></span><br><span class="line"><span class="string">        Returns long integer rows affected, if any</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">del</span> self.messages[:]</span><br><span class="line">        db = self._get_db()</span><br><span class="line">        <span class="keyword">if</span> isinstance(query, unicode):</span><br><span class="line">            query = query.encode(db.unicode_literal.charset)</span><br><span class="line">        <span class="keyword">if</span> args <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">if</span> isinstance(args, dict):</span><br><span class="line">                query = query % dict((key, db.literal(item))</span><br><span class="line">                                     <span class="keyword">for</span> key, item <span class="keyword">in</span> args.iteritems())</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                query = query % tuple([db.literal(item) <span class="keyword">for</span> item <span class="keyword">in</span> args]) <span class="comment">##########################这里！！</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = <span class="literal">None</span></span><br><span class="line">            r = self._query(query)</span><br><span class="line">        <span class="keyword">except</span> TypeError, m:</span><br><span class="line">            <span class="keyword">if</span> m.args[<span class="number">0</span>] <span class="keyword">in</span> (<span class="string">"not enough arguments for format string"</span>,</span><br><span class="line">                             <span class="string">"not all arguments converted"</span>):</span><br><span class="line">                self.messages.append((ProgrammingError, m.args[<span class="number">0</span>]))</span><br><span class="line">                self.errorhandler(self, ProgrammingError, m.args[<span class="number">0</span>])</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.messages.append((TypeError, m))</span><br><span class="line">                self.errorhandler(self, TypeError, m)</span><br><span class="line">        <span class="keyword">except</span> (SystemExit, KeyboardInterrupt):</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            exc, value, tb = sys.exc_info()</span><br><span class="line">            <span class="keyword">del</span> tb</span><br><span class="line">            self.messages.append((exc, value))</span><br><span class="line">            self.errorhandler(self, exc, value)</span><br><span class="line">        self._executed = query</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self._defer_warnings: self._warning_check()</span><br><span class="line">        <span class="keyword">return</span> r</span><br></pre></td></tr></table></figure><p></p><p>错误地方就是后面加了#的语句。</p><p>可以看到，因为字符串也是可序列化的，所以一个字符串被拆分成了单个的字符进行db.literal()处理。这个db是什么呢？</p><p>往上找：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, connection)</span>:</span></span><br><span class="line">        <span class="keyword">from</span> weakref <span class="keyword">import</span> proxy</span><br><span class="line">        self.connection = proxy(connection)</span><br><span class="line">        self.description = <span class="literal">None</span></span><br><span class="line">        self.description_flags = <span class="literal">None</span></span><br><span class="line">        self.rowcount = <span class="number">-1</span></span><br><span class="line">        self.arraysize = <span class="number">1</span></span><br><span class="line">        self._executed = <span class="literal">None</span></span><br><span class="line">        self.lastrowid = <span class="literal">None</span></span><br><span class="line">        self.messages = []</span><br><span class="line">        self.errorhandler = connection.errorhandler</span><br><span class="line">        self._result = <span class="literal">None</span></span><br><span class="line">        self._warnings = <span class="number">0</span></span><br><span class="line">        self._info = <span class="literal">None</span></span><br><span class="line">        self.rownumber = <span class="literal">None</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_get_db</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.connection:</span><br><span class="line">            self.errorhandler(self, ProgrammingError, <span class="string">"cursor closed"</span>)</span><br><span class="line">        <span class="keyword">return</span> self.connection</span><br><span class="line">```        </span><br><span class="line">可以看出，这个db就是connection的一个弱引用。再进一步，这个connnection哪来的呢？</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">open</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">""" 返回一个默认的数据库连接游标 """</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        self.conn = MySQLdb.Connection(</span><br><span class="line">            self.db_ip,</span><br><span class="line">            self.db_un,</span><br><span class="line">            self.db_pd,</span><br><span class="line">            self.db_db,</span><br><span class="line">            charset=self.db_ch)</span><br><span class="line">        self.cur = self.conn.cursor()</span><br><span class="line">    <span class="keyword">except</span> MySQLdb.Error <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">print</span> e</span><br><span class="line">`</span><br></pre></td></tr></table></figure><p></p><p>mysqldb-python的connection.py中:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Connection</span><span class="params">(_mysql.connection)</span>:</span></span><br><span class="line">    <span class="string">"""MySQL Database Connection Object"""</span></span><br><span class="line">    default_cursor = cursors.Cursor</span><br></pre></td></tr></table></figure><p>那这个Cursor又是什么呢？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cursor</span><span class="params">(CursorStoreResultMixIn, CursorTupleRowsMixIn,</span></span></span><br><span class="line"><span class="class"><span class="params">             BaseCursor)</span>:</span></span><br><span class="line">    <span class="string">"""This is the standard Cursor class that returns rows as tuples</span></span><br><span class="line"><span class="string">    and stores the result set in the client."""</span></span><br></pre></td></tr></table></figure><p>这个Cursor这些类的子类，其中最上面出错函数就是BaseCursor的一个方法。</p><p>有点跑偏，先看看那literal函数吧：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">literal</span><span class="params">(self, o)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> o,type(o)</span><br><span class="line">        <span class="keyword">print</span> self.encoders</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        If o is a single object, returns an SQL literal as a string.</span></span><br><span class="line"><span class="string">        If o is a non-string sequence, the items of the sequence are</span></span><br><span class="line"><span class="string">        converted and returned as a sequence.</span></span><br><span class="line"><span class="string">        Non-standard. For internal use; do not use this in your</span></span><br><span class="line"><span class="string">        applications.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> self.escape(o, self.encoders)</span><br></pre></td></tr></table></figure><p></p><p>print是我添加的，输出如下：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">t &lt;type &apos;str&apos;&gt;</span><br><span class="line">&#123;&lt;type &apos;instance&apos;&gt;: &lt;function Instance2Str at 0x17b3aa0&gt;, &lt;type &apos;set&apos;&gt;: &lt;function Set2Str at 0x17b3cf8&gt;, &lt;type &apos;long&apos;&gt;: &lt;function Thing2Str at 0x17b3de8&gt;, &lt;type &apos;bool&apos;&gt;: &lt;function Bool2Str at 0x17b3ed8&gt;, &lt;type &apos;unicode&apos;&gt;: &lt;function unicode_literal at 0x7f12e42c4230&gt;, &lt;type &apos;str&apos;&gt;: &lt;function string_literal at 0x7f12e42be2a8&gt;, &lt;type &apos;float&apos;&gt;: &lt;function Float2Str at 0x17b3c08&gt;, &lt;type &apos;list&apos;&gt;: &lt;function quote_tuple at 0x17b3938&gt;, &lt;type &apos;tuple&apos;&gt;: &lt;function quote_tuple at 0x17b3938&gt;, &lt;type &apos;array.array&apos;&gt;: &lt;function array2Str at 0x17b39b0&gt;, &lt;type &apos;NoneType&apos;&gt;: &lt;function None2NULL at 0x17b3b90&gt;, &lt;type &apos;datetime.datetime&apos;&gt;: &lt;function DateTime2literal at 0x17b30c8&gt;, &lt;type &apos;dict&apos;&gt;: &lt;built-in function escape_dict&gt;, &lt;type &apos;object&apos;&gt;: &lt;function Instance2Str at 0x17b3aa0&gt;, &lt;type &apos;int&apos;&gt;: &lt;function Thing2Str at 0x17b3de8&gt;, &lt;type &apos;datetime.timedelta&apos;&gt;: &lt;function DateTimeDelta2literal at 0x17b3140&gt;&#125;</span><br><span class="line">o &lt;type &apos;str&apos;&gt;</span><br><span class="line">&#123;&lt;type &apos;instance&apos;&gt;: &lt;function Instance2Str at 0x17b3aa0&gt;, &lt;type &apos;set&apos;&gt;: &lt;function Set2Str at 0x17b3cf8&gt;, &lt;type &apos;long&apos;&gt;: &lt;function Thing2Str at 0x17b3de8&gt;, &lt;type &apos;bool&apos;&gt;: &lt;function Bool2Str at 0x17b3ed8&gt;, &lt;type &apos;unicode&apos;&gt;: &lt;function unicode_literal at 0x7f12e42c4230&gt;, &lt;type &apos;str&apos;&gt;: &lt;function string_literal at 0x7f12e42be2a8&gt;, &lt;type &apos;float&apos;&gt;: &lt;function Float2Str at 0x17b3c08&gt;, &lt;type &apos;list&apos;&gt;: &lt;function quote_tuple at 0x17b3938&gt;, &lt;type &apos;tuple&apos;&gt;: &lt;function quote_tuple at 0x17b3938&gt;, &lt;type &apos;array.array&apos;&gt;: &lt;function array2Str at 0x17b39b0&gt;, &lt;type &apos;NoneType&apos;&gt;: &lt;function None2NULL at 0x17b3b90&gt;, &lt;type &apos;datetime.datetime&apos;&gt;: &lt;function DateTime2literal at 0x17b30c8&gt;, &lt;type &apos;dict&apos;&gt;: &lt;built-in function escape_dict&gt;, &lt;type &apos;object&apos;&gt;: &lt;function Instance2Str at 0x17b3aa0&gt;, &lt;type &apos;int&apos;&gt;: &lt;function Thing2Str at 0x17b3de8&gt;, &lt;type &apos;datetime.timedelta&apos;&gt;: &lt;function DateTimeDelta2literal at 0x17b3140&gt;&#125;</span><br><span class="line">p &lt;type &apos;str&apos;&gt;</span><br><span class="line">&#123;&lt;type &apos;instance&apos;&gt;: &lt;function Instance2Str at 0x17b3aa0&gt;, &lt;type &apos;set&apos;&gt;: &lt;function Set2Str at 0x17b3cf8&gt;, &lt;type &apos;long&apos;&gt;: &lt;function Thing2Str at 0x17b3de8&gt;, &lt;type &apos;bool&apos;&gt;: &lt;function Bool2Str at 0x17b3ed8&gt;, &lt;type &apos;unicode&apos;&gt;: &lt;function unicode_literal at 0x7f12e42c4230&gt;, &lt;type &apos;str&apos;&gt;: &lt;function string_literal at 0x7f12e42be2a8&gt;, &lt;type &apos;float&apos;&gt;: &lt;function Float2Str at 0x17b3c08&gt;, &lt;type &apos;list&apos;&gt;: &lt;function quote_tuple at 0x17b3938&gt;, &lt;type &apos;tuple&apos;&gt;: &lt;function quote_tuple at 0x17b3938&gt;, &lt;type &apos;array.array&apos;&gt;: &lt;function array2Str at 0x17b39b0&gt;, &lt;type &apos;NoneType&apos;&gt;: &lt;function None2NULL at 0x17b3b90&gt;, &lt;type &apos;datetime.datetime&apos;&gt;: &lt;function DateTime2literal at 0x17b30c8&gt;, &lt;type &apos;dict&apos;&gt;: &lt;built-in function escape_dict&gt;, &lt;type &apos;object&apos;&gt;: &lt;function Instance2Str at 0x17b3aa0&gt;, &lt;type &apos;int&apos;&gt;: &lt;function Thing2Str at 0x17b3de8&gt;, &lt;type &apos;datetime.timedelta&apos;&gt;: &lt;function DateTimeDelta2literal at 0x17b3140&gt;&#125;</span><br></pre></td></tr></table></figure><p></p><p>就像上面说的，”top”被拆分成了3个，可是我们语句中的占位符%s只有一个！所以报错 not all arguments converted during string formatting。最初这里我理解成了是哪里转化出了错误，最后醒悟这意思是因为占位符个数和传入参数个数不一样导致！英语不过关阿～不过以前怎么没报错呢？？奇怪……</p><p>解决办法有2个，简单的方法就是执行语句修改如下：<code>self.cur.execute(order, (position,)) #注意逗号。</code></p><p>更推荐的方法就是使用字典传值：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> show:</span><br><span class="line">    order = <span class="string">r"select id,p_name,p_explain,p_href from pictures where p_position = %(position)s and p_show = 1 order by -id"</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    order = <span class="string">r"select id,p_name,p_explain,p_href,p_uploaddate,p_show from pictures where p_position = %(position)s"</span></span><br><span class="line">self.cur.execute(order, &#123;<span class="string">'position'</span>: position&#125;)</span><br></pre></td></tr></table></figure><p></p><p>这样虽然多打了几个字母，不过却是一种最稳妥的方式，不用担心由于参数顺序造成错误了。</p><p>mysql-python源码写的狠帅阿!</p><p><a href="/2014/03/27/mysql-python-not-all-arguments-converted-during-string-formatting/#post-footer" class="postShorten-excerpt_link link">评论和分享</a></p></div></div></article><article class="postShorten postShorten--thumbnailimg-right" itemscope itemtype="http://schema.org/BlogPosting"><div class="postShorten-wrap"><div class="postShorten-header"><h1 class="postShorten-title" itemprop="headline"><a class="link-unstyled" href="/2014/03/25/django的view中常用return方法/">Django的view中常用return方法</a></h1><div class="postShorten-meta"><time itemprop="datePublished" datetime="2014-03-25T18:28:00+08:00">3月 25, 2014 </time><span>发布在 </span><a class="category-link" href="/source/all-categories/Django/">Django</a></div></div><div class="postShorten-excerpt" itemprop="articleBody"><p>第一种HttpResponse，最基本的返回方式，可以直接返回字符:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(“a test”)</span><br></pre></td></tr></table></figure><p>或者结合contextloder返回网页：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.template <span class="keyword">import</span> Context, loader  </span><br><span class="line"><span class="keyword">from</span> polls.models <span class="keyword">import</span> Poll</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span>  </span><br><span class="line">    latest_poll_list = Poll.objects.order_by(<span class="string">'-pub_date'</span>)[:<span class="number">5</span>]  </span><br><span class="line">    template = loader.get_template(<span class="string">'polls/index.html'</span>)</span><br><span class="line">    context = Context(&#123; <span class="string">'latest_poll_list'</span>: latest_poll_list, &#125;)  </span><br><span class="line">    <span class="keyword">return</span> HttpResponse(template.render(context))</span><br></pre></td></tr></table></figure><p></p><a href="/2014/03/25/django的view中常用return方法/" class="postShorten-excerpt_link link">阅读全文</a></div></div></article><article class="postShorten postShorten--thumbnailimg-right" itemscope itemtype="http://schema.org/BlogPosting"><div class="postShorten-wrap"><div class="postShorten-header"><h1 class="postShorten-title" itemprop="headline"><a class="link-unstyled" href="/2014/03/21/关于最优价格计算的想法/">关于最优价格计算的想法</a></h1><div class="postShorten-meta"><time itemprop="datePublished" datetime="2014-03-21T15:53:11+08:00">3月 21, 2014 </time><span>发布在 </span><a class="category-link" href="/source/all-categories/杂/">杂</a></div></div><div class="postShorten-excerpt" itemprop="articleBody"><p>假设现在某型号有2个供货商提供,最简化模型如下：</p><p>A: (P X),(Q Y)</p><p>B: (P M),(Q N)</p><p>根据实际情况,买的多价格越低，故<code>X&gt;Y,M&gt;N</code></p><p>如果<code>M&gt;X</code>,<code>N&gt;Y</code>,明显的不论数量多少都应该去A买，反之亦然。</p><p>以<code>M&gt;X</code>,<code>N&lt;Y</code>为例,则可推断出<code>M&gt;X&gt;Y&gt;N</code>。</p><a href="/2014/03/21/关于最优价格计算的想法/" class="postShorten-excerpt_link link">阅读全文</a></div></div></article><article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemtype="http://schema.org/BlogPosting"><div class="postShorten-wrap"><div class="postShorten-header"><h1 class="postShorten-title" itemprop="headline"><a class="link-unstyled" href="/2014/03/18/KaliLinux安装失败的解决方法/">KaliLinux安装失败的解决方法</a></h1><div class="postShorten-meta"><time itemprop="datePublished" datetime="2014-03-18T12:38:47+08:00">3月 18, 2014 </time><span>发布在 </span><a class="category-link" href="/source/all-categories/Kali/">Kali</a></div></div><div class="postShorten-content" itemprop="articleBody"><p>不知道什么原因，安装kalilinux的时候总是安装失败，失败步骤：安装操作系统。偶尔这步通过了，又出现了grub无法安装的情况。</p><p>下载了各个版本都是这样之后，对比了一下sha的值，发现和官网上给出的并不一样….什么情况？！然后根据<a href="http://cdimage.kali.org/kali-latest/amd64/这发现，正确的值应该是" target="_blank" rel="noopener">http://cdimage.kali.org/kali-latest/amd64/这发现，正确的值应该是</a><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">d859cc2798a24c48ddd37c6aafd88c5dc5e6e123  kali-linux-1.0.6-amd64-mini.iso</span><br><span class="line">281ddb3d14619a973e254b8f484b7fe27defa822  kali-linux-1.0.6-amd64.iso</span><br><span class="line">3cf383be7778d1676c015cb5430422e672ec59fa  kali-linux-1.0.6-amd64-mini.torrent</span><br><span class="line">cfa0ad0dce1d4a170adf1cd342c622db23e785ef  kali-linux-1.0.6-amd64.torrent</span><br></pre></td></tr></table></figure><p></p><p>又下载了sha值一样的镜像后，还是无法安装操作系统。</p><p>最后发现，如果在磁盘分区时候没选择全放在一起(即第一项推荐新手)而是选择了下面的2项就会导致安装操作系统失败。</p><p>真是奇怪的问题….不过总算安装成功了。</p><p><a href="/2014/03/18/KaliLinux安装失败的解决方法/#post-footer" class="postShorten-excerpt_link link">评论和分享</a></p></div></div></article><div class="pagination-bar"><ul class="pagination"><li class="pagination-prev"><a class="btn btn--default btn--small" href="/page/17/"><i class="fa fa-angle-left text-base icon-mr"></i> <span>上一页</span></a></li><li class="pagination-next"><a class="btn btn--default btn--small" href="/page/19/"><span>下一页</span> <i class="fa fa-angle-right text-base icon-ml"></i></a></li><li class="pagination-number">第 18 页 共 24 页</li></ul></div></section><footer id="footer" class="main-content-wrap"><span class="copyrights">Copyrights &copy; 2020 Roy. All Rights Reserved.</span></footer></div></div><div id="about"><div id="about-card"><div id="about-btn-close"><i class="fa fa-remove"></i></div><img id="about-card-picture" src="/assets/images/my.jpg" alt="作者的图片"><h4 id="about-card-name">Roy</h4><div id="about-card-bio"><p>君以国士待我，我必以国士报君。</p></div><div id="about-card-job"><i class="fa fa-briefcase"></i><br><p>野生程序猿</p></div><div id="about-card-location"><i class="fa fa-map-marker"></i><br>China</div></div></div><div id="algolia-search-modal" class="modal-container"><div class="modal"><div class="modal-header"><span class="close-button"><i class="fa fa-close"></i></span> <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled"><span class="searchby-algolia-text text-color-light text-small">by</span> <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg"> </a><i class="search-icon fa fa-search"></i><form id="algolia-search-form"><input type="text" id="algolia-search-input" name="search" class="form-control input--large search-input" placeholder="Search "></form></div><div class="modal-body"><div class="no-result text-color-light text-center">没有找到文章</div><div class="results"><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/02/12/Ubuntu下Gogant的简易破墙术/"><h3 class="media-heading">Ubuntu下Gogant的简易破墙术</h3></a><span class="media-meta"><span class="media-date text-small">2013年2月12日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/10/31/python常用第三方库-转载/"><h3 class="media-heading">Python常用第三方库(转载)</h3></a><span class="media-meta"><span class="media-date text-small">2013年10月31日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/fedora19安装ar8161网卡驱动/"><h3 class="media-heading">fedora19安装ar8161网卡驱动</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/fedora19源，rpmforge，fastestmirror/"><h3 class="media-heading">fedora19源，rpmforge，fastestmirror</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/python中如何自定义解析域名/"><h3 class="media-heading">python中如何自定义解析域名</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/django版本更换/"><h3 class="media-heading">django版本更换</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/django-groundwork个人1-5-3修改版/"><h3 class="media-heading">django-groundwork个人1.5.3修改版</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/fedora19美化/"><h3 class="media-heading">fedora19美化</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/装饰器/"><h3 class="media-heading">装饰器</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/SVN常用操作/"><h3 class="media-heading">SVN常用操作</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div></div></div><div class="modal-footer"><p class="results-count text-medium" data-message-zero="没有找到文章" data-message-one="找到 1 篇文章" data-message-other="找到 {n} 篇文章">找到 232 篇文章</p></div></div></div><div id="cover" style="background-image:url(/assets/images/cover.jpg)"></div><script src="/assets/js/script-ivwiy10zeb8fifc4swnhkwneuk64y53w2scmdmtp8thi9cqfxh31aowtroaz.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.14.1/moment-with-locales.min.js"></script><script src="//cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script><script>var algoliaClient=algoliasearch("51U8PIBLP6","16909d9ce1780cda71113841864e7aa8"),algoliaIndex=algoliaClient.initIndex("my-blog")</script></body></html>