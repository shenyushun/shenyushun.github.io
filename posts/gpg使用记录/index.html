<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>GPG使用记录 - Hi~Roy!</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="GPG使用记录" />
<meta property="og:description" content="GPG简单来说是一种加密机制，可以用来加密文件、邮件等。这里以Centos为例记录一下生成密钥以及相关操作。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/gpg%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/" />
<meta property="article:published_time" content="2016-09-05T16:05:32+00:00" />
<meta property="article:modified_time" content="2016-09-05T16:05:32+00:00" />

		<meta itemprop="name" content="GPG使用记录">
<meta itemprop="description" content="GPG简单来说是一种加密机制，可以用来加密文件、邮件等。这里以Centos为例记录一下生成密钥以及相关操作。">
<meta itemprop="datePublished" content="2016-09-05T16:05:32&#43;00:00" />
<meta itemprop="dateModified" content="2016-09-05T16:05:32&#43;00:00" />
<meta itemprop="wordCount" content="353">



<meta itemprop="keywords" content="centos," />
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/css/roy.css">

	<link rel="shortcut icon" href="/favicon.ico">
		
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-81207387-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo logo--mixed">
		<a class="logo__link" href="/" title="Roy&#39;s Blog" rel="home">
			<div class="logo__item logo__imagebox">
					<img class="logo__img" src="/images/logo.png">
				</div><div class="logo__item logo__text">
					<div class="logo__title">Roy&#39;s Blog</div>
					<div class="logo__tagline">From the moment I first saw you, All the darkness turned to light.</div>
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/">
				
				<span class="menu__text">Home</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">GPG使用记录</h1>
			<div class="post__meta meta"><div class="meta__item-author meta__item">
	<svg class="meta__icon icon icon-author" width="16" height="16" viewBox="0 0 12 16"><path d="M6 1c2.2 0 3.5 2 3.5 4.5C9.5 7 8.9 8.2 8 9c2.9.8 4 2.5 4 5v1H0v-1c0-2.5 1.1-4.2 4-5-.9-.8-1.5-2-1.5-3.5C2.5 3 3.8 1 6 1z"/></svg><span class="meta__text">Roy</span>
</div>
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class="meta__text" datetime="2016-09-05T16:05:32Z">2016-09-05</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg><span class="meta__text"><a class="meta__link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" rel="category">操作系统</a>
	</span>
</div></div>
		</header><div class="content post__content clearfix">
			<p>GPG简单来说是一种加密机制，可以用来加密文件、邮件等。这里以Centos为例记录一下生成密钥以及相关操作。</p>
<h3 id="安装">安装</h3>
<p>直接使用yum命令进行安装即可<code>yum install gnupg</code></p>
<h3 id="生成密钥">生成密钥</h3>
<p>首先执行<code>gpg --gen-key</code></p>
<pre><code>gpg (GnuPG) 1.4.21; Copyright (C) 2015 Free Software Foundation, Inc.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

gpg: 钥匙环‘/home/xxx/.gnupg/secring.gpg’已建立
请选择您要使用的密钥种类：
   (1) RSA and RSA (default)
   (2) DSA and Elgamal
   (3) DSA (仅用于签名)
   (4) RSA (仅用于签名)
您的选择？ 1
RSA 密钥长度应在 1024 位与 4096 位之间。
您想要用多大的密钥尺寸？(2048)4096
您所要求的密钥尺寸是 4096 位
请设定这把密钥的有效期限。
         0 = 密钥永不过期
      &lt;n&gt;  = 密钥在 n 天后过期
      &lt;n&gt;w = 密钥在 n 周后过期
      &lt;n&gt;m = 密钥在 n 月后过期
      &lt;n&gt;y = 密钥在 n 年后过期
密钥的有效期限是？(0)
密钥永远不会过期
以上正确吗？(y/n)y
</code></pre><p>根据自己需要选择相应选项即可，不过这里我遇到一个问题，如果选择密钥长度为2048，最后会报错，错误信息类似：</p>
<pre><code>gpg: lookup_hashtable failed: eof
gpg: lookup_hashtable failed: eof
gpg: upd_hashtable: read failed: eof
gpg: 信任记录 1，类别 12：写入失败：eof
gpg: Error: The trustdb is corrupted.
gpg: You may try to re-create the trustdb using the commands:
gpg:   cd ~/.gnupg
gpg:   gpg2 --export-ownertrust &gt; otrust.tmp
gpg:   rm trustdb.gpg
gpg:   gpg2 --import-ownertrust &lt; otrust.tmp
gpg: If that does not work, please consult the manual
</code></pre><p>如果使用4096则没问题，原因未知。</p>
<p>接下来按照提示依次输入自己的信息即可：</p>
<pre><code>您需要一个用户标识来辨识您的密钥；本软件会用真实姓名、注释和电子邮件地址组合
成用户标识，如下所示：
    “Heinrich Heine (Der Dichter) &lt;heinrichh@duesseldorf.de&gt;”

真实姓名：Xxx Xxxx
电子邮件地址：xxxx@xxxx.com
注释：
您选定了这个用户标识：
    “Xxx Xxxx &lt;xxxx@xxxx.com&gt;”

更改姓名(N)、注释(C)、电子邮件地址(E)或确定(O)/退出(Q)？O
您需要一个密码来保护您的私钥。

我们需要生成大量的随机字节。这个时候您可以多做些琐事(像是敲打键盘、移动
鼠标、读写硬盘之类的)，这会让随机数字发生器有更好的机会获得足够的熵数。
+++++
....+++++
我们需要生成大量的随机字节。这个时候您可以多做些琐事(像是敲打键盘、移动
鼠标、读写硬盘之类的)，这会让随机数字发生器有更好的机会获得足够的熵数。
++d+++
.++++a+
sgpg: 密钥 3F95181G 被标记为绝对信任
公钥和私钥已经生成并经签名。

gpg: 正在检查信任度数据库
gpg: 需要 3 份勉强信任和 1 份完全信任，PGP 信任模型
gpg: 深度：0 有效性：  1 已签名：  0 信任度：0-，0q，0n，0m，0f，1u
pub   4096R/3F95181G 2016-09-05
密钥指纹 = 6274 A3B2 CA41 0D5A F22E  D1D8 5532 5279 3D8A 4089
uid                  Xxx Xxxx &lt;xxxx@xxxx.com&gt;
sub   4096R/3A6F870F 2016-09-05
</code></pre><p>上面的密钥3F95181G就是用户ID。</p>
<h3 id="上传公钥">上传公钥</h3>
<p>使用下面的命令把生成的公钥上传到公钥服务器：</p>
<pre><code>gpg --send-keys 3F95181G
gpg: 将密钥‘3F95181G’上传到 hkp 服务器 keys.gnupg.net
</code></pre><p>这里，由于任何人都可以用你的名义上传公钥，所以我们可以在网上公布一个公钥指纹，来让别人核对公钥是否为真：</p>
<pre><code>gpg --fingerprint [用户ID]
</code></pre><h3 id="生成撤销证书">生成&quot;撤销证书&rdquo;</h3>
<p>如果未来某一天，你不想用这个密钥或者密钥泄漏了，可以使用这个来请求公钥服务器撤销公钥：</p>
<pre><code>gpg --gen-revoke 3F95181G

sec  4096R/3F95181G 2016-09-05 Xxx Xxxx &lt;xxxx@xxxx.com&gt;

要为这把密钥建立一份吊销证书吗？(y/N)y
请选择吊销的原因：
  0 = 未指定原因
  1 = 密钥已泄漏
  2 = 密钥被替换
  3 = 密钥不再使用
  Q = 取消
(也许您会想要在这里选择 1)
您的决定是什么？2
请输入描述(可选)；以空白行结束：
&gt;
吊销原因：密钥被替换
(不给定描述)
这样可以吗？ (y/N)y

您需要输入密码，才能解开这个用户的私钥：“Xxx Xxxx &lt;xxxx@xxxx.com&gt;”
4096 位的 RSA 密钥，钥匙号 3F95181G，建立于 2016-09-05

已强行使用 ASCII 封装过的输出。
已建立吊销证书。

请把这个文件转移到一个可隐藏起来的介质(如软盘)上；如果坏人能够取得这
份证书的话，那么他就能让您的密钥无法继续使用。把这份凭证打印出来再藏
到安全的地方也是很好的方法，以免您的保存媒体损毁而无法读取。但是千万
小心：您的机器上的打印系统可能会在打印过程中把这些数据临时在某个其他
人也能够看得到的地方！
</code></pre><h3 id="文件的加密解密">文件的加密解密</h3>
<p>加密的命令如下：</p>
<pre><code>gpg --recipient [用户ID] --output 加密后文件名 --encrypt 所需加密文件名
</code></pre><p>解密：</p>
<pre><code>gpg --output 解密后文件名 --decrypt 已经加密的文件名

您需要输入密码，才能解开这个用户的私钥：“Xxx Xxxx &lt;xxxx@xxxx.com&gt;”
4096 位的 RSA 密钥，钥匙号 3A6F970F，建立于 2016-09-05 (主钥匙号 3F95181G)

请输入密码：
</code></pre><h3 id="其他">其他</h3>
<ol>
<li>列出密钥<code>gpg --list-keys</code></li>
<li>删除密钥<code>gpg --delete-key [用户ID]</code></li>
<li>导出公钥<code>gpg --armor --output public-key.txt --export [用户ID]</code>，armor参数可以将其转换为ASCII码显示。</li>
<li>导出私钥<code>gpg --armor --output private-key.txt --export-secret-keys</code></li>
<li>导入密钥<code>gpg --import [密钥文件]</code></li>
<li>查看公钥指纹<code>gpg --fingerprint [用户ID]</code></li>
<li>搜索他人密钥<code>gpg --search-keys [用户ID]</code>这里需要注意核查密钥是否真实</li>
</ol>
<h3 id="参考">参考</h3>
<ol>
<li><a href="http://www.ruanyifeng.com/blog/2013/07/gpg.html">阮一峰</a></li>
</ol>
		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/centos/" rel="tag">centos</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>

<div class="authorbox clearfix">
	<figure class="authorbox__avatar">
		<img alt="Roy avatar" src="/images/my.jpg" class="avatar" height="90" width="90">
	</figure>
	<div class="authorbox__header">
		<span class="authorbox__name">About Roy</span>
	</div>
	<div class="authorbox__description">
		野生程序猿，略懂Python，略懂Golang，略懂云计算，略懂大数据，略懂拳击游泳钓鱼，略懂钢琴吉他摄影。
	</div>
</div>

<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/%E5%9C%A8mysql%E4%B8%AD%E5%AD%98%E5%82%A8%E6%A0%91%E7%BB%93%E6%9E%84/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">在MySQL中存储树状结构</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/django-auth-ldap%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">django-auth-ldap中文文档</p>
		</a>
	</div>
</nav>

<section class="comments">
	<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "www-hi-roy-com" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
<div class="footer__links">
	<a class="footer__link" href="/about/">About</a>
</div>
		<div class="footer__copyright">
			&copy; 2024 Roy.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>