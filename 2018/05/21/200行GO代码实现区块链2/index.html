<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Hi!Roy!"><title>200行GO代码实现区块链2 - Hi!Roy!</title><meta name="author" content="Roy"><link rel="icon" href="http://www.hi-roy.com/assets/images/favicon.ico"><link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml"><meta name="description" content="原文，需要科学上网。省略了一些无关的内容。上篇文章我们学习了如何编写区块链并且对进行Hash运算和验证，但所有都运行在一个节点。我们如何让其他的节点连接到我们的主节点并让这些新节点贡献新区块呢？并且，我们如何通知所有的节点区块链有更新呢？这篇文章将进行就解答。"><meta name="keywords" content="区块链,go"><meta property="og:type" content="blog"><meta property="og:title" content="200行GO代码实现区块链2"><meta property="og:url" content="http://www.hi-roy.com/2018/05/21/200行GO代码实现区块链2/index.html"><meta property="og:site_name" content="Hi!Roy!"><meta property="og:description" content="原文，需要科学上网。省略了一些无关的内容。上篇文章我们学习了如何编写区块链并且对进行Hash运算和验证，但所有都运行在一个节点。我们如何让其他的节点连接到我们的主节点并让这些新节点贡献新区块呢？并且，我们如何通知所有的节点区块链有更新呢？这篇文章将进行就解答。"><meta property="og:locale" content="zh-cn"><meta property="og:image" content="http://mypic-1252424367.coshk.myqcloud.com/bk21.png"><meta property="og:image" content="http://mypic-1252424367.coshk.myqcloud.com/bk22.png"><meta property="og:image" content="http://mypic-1252424367.coshk.myqcloud.com/bk23.png"><meta property="og:image" content="http://mypic-1252424367.coshk.myqcloud.com/bk24.png"><meta property="og:image" content="http://mypic-1252424367.coshk.myqcloud.com/bk25.png"><meta property="og:updated_time" content="2019-09-16T08:11:51.451Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="200行GO代码实现区块链2"><meta name="twitter:description" content="原文，需要科学上网。省略了一些无关的内容。上篇文章我们学习了如何编写区块链并且对进行Hash运算和验证，但所有都运行在一个节点。我们如何让其他的节点连接到我们的主节点并让这些新节点贡献新区块呢？并且，我们如何通知所有的节点区块链有更新呢？这篇文章将进行就解答。"><meta name="twitter:image" content="http://mypic-1252424367.coshk.myqcloud.com/bk21.png"><meta property="og:image" content="http://www.hi-roy.com/assets/images/my.jpg"><link rel="stylesheet" href="/assets/css/style-sxklfps8ywgfyyjcowvnb4gxdgt0zjts3hsguljmv9uqanxjbnitrovtbrek.min.css"><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?21513ec2bcd577b3297a1b16da82fa40";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></head><body><div id="blog"><header id="header" data-behavior="4"><i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i><div class="header-title"><a class="header-title-link" href="/">Hi!Roy!</a></div><a class="header-right-icon" href="#about"><i class="fa fa-lg fa-question"></i></a></header><nav id="sidebar" data-behavior="4"><div class="sidebar-container"><div class="sidebar-profile"><a href="/#about"><img class="sidebar-profile-picture" src="/assets/images/my.jpg" alt="作者的图片"></a><h4 class="sidebar-profile-name">Roy</h4><h5 class="sidebar-profile-bio"><p>君以国士待我，我必以国士报君。</p></h5></div><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="/"><i class="sidebar-button-icon fa fa-lg fa-home"></i> <span class="sidebar-button-desc">首页</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-categories"><i class="sidebar-button-icon fa fa-lg fa-bookmark"></i> <span class="sidebar-button-desc">分类</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-tags"><i class="sidebar-button-icon fa fa-lg fa-tags"></i> <span class="sidebar-button-desc">标签</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-archives"><i class="sidebar-button-icon fa fa-lg fa-archive"></i> <span class="sidebar-button-desc">归档</span></a></li><li class="sidebar-button"><a class="sidebar-button-link open-algolia-search" href="#search"><i class="sidebar-button-icon fa fa-lg fa-search"></i> <span class="sidebar-button-desc">搜索</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="#about"><i class="sidebar-button-icon fa fa-lg fa-question"></i> <span class="sidebar-button-desc">关于</span></a></li></ul><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="https://github.com/shenyushun" target="_blank" rel="noopener"><i class="sidebar-button-icon fa fa-lg fa-github"></i> <span class="sidebar-button-desc">GitHub</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="mailto:darkcooking@gmail.com" target="_blank" rel="noopener"><i class="sidebar-button-icon fa fa-lg fa-envelope-o"></i> <span class="sidebar-button-desc">邮箱</span></a></li></ul><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="/atom.xml"><i class="sidebar-button-icon fa fa-lg fa-rss"></i> <span class="sidebar-button-desc">RSS</span></a></li></ul></div></nav><div id="main" data-behavior="4" class="hasCoverMetaIn"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><div class="post-header main-content-wrap text-left"><h1 class="post-title" itemprop="headline">200行GO代码实现区块链2</h1><div class="post-meta"><time itemprop="datePublished" datetime="2018-05-21T21:32:59+08:00">5月 21, 2018 </time><span>发布在 </span><a class="category-link" href="/source/all-categories/区块链/">区块链</a>, <a class="category-link" href="/source/all-categories/区块链/Golang/">Golang</a>, <a class="category-link" href="/source/all-categories/区块链/Golang/菜鸟翻译屋/">菜鸟翻译屋</a></div></div><div class="post-content markdown" itemprop="articleBody"><div class="main-content-wrap"><p><a href="https://medium.com/@mycoralhealth/part-2-networking-code-your-own-blockchain-in-less-than-200-lines-of-go-17fe1dad46e1" target="_blank" rel="noopener">原文</a>，需要科学上网。省略了一些无关的内容。</p><p>上篇文章我们学习了如何编写区块链并且对进行Hash运算和验证，但所有都运行在一个节点。我们如何让其他的节点连接到我们的主节点并让这些新节点贡献新区块呢？并且，我们如何通知所有的节点区块链有更新呢？</p><p>这篇文章将进行就解答。</p><a id="more"></a><h2 id="工作流"><a href="#工作流" class="headerlink" title="工作流"></a>工作流</h2><p><img src="http://mypic-1252424367.coshk.myqcloud.com/bk21.png" alt="bk1"></p><ul><li>第一个终端负责创建创世块和TCP服务以便新节点可以连接它</li></ul><p><em>第一步</em></p><ul><li>打开一个新终端并使用TCP连接到第一个终端</li><li>向第一个终端添加一个新区块</li></ul><p><em>第二步</em></p><ul><li>第一个终端对区块进行验证</li><li>第一个终端对所有节点进行广播通知有新区块生成</li></ul><p><em>第三步</em></p><ul><li>所有终端都有同步后的新区块链</li></ul><p>完成这篇文章后，尝试：让每个新终端都和第一个终端一样，有自己的TCP端口让其他节点连接，组成一个真实的网络！<br><!-- more --></p><p><strong>在这篇文章中，你将：</strong></p><ul><li>运行一个生成创世块的终端</li><li>运行更多的终端并且向第一个终端写如区块</li><li>第一个终端可以通过广播使其他终端的区块链更新</li></ul><p><strong>在这篇文章中，没讲：</strong><br>就像上篇文章一样，这篇文章的目的是创建一个可以工作的基础网络，为你以后的区块链学习之路做好铺垫。所以你不能在其他网络中的电脑向第一个终端写入区块信息。 但通过把程序部署在云服务器上可以容易的实现这点。同样，区块链广播也将在其他节点上被模仿。不用担心，我们晚点再解释。</p><h3 id="开始编码"><a href="#开始编码" class="headerlink" title="开始编码"></a>开始编码</h3><p>我们将用到上篇文章中写好的一些函数，比如创建区块、Hash和验证函数。但不会再使用和HTTP相关的函数，因为我们接下来将使用TCP协议在终端中进行操作。</p><p><em>TCP和HTTP啥区别？</em></p><p>这里我们不打算介绍太多，TCP是一种网络传输基本协议，而HTTP则是基于TCP在浏览器和网络的一种封装。当你访问一个网页时，你在使用HTTP协议，它是由TCP底层数据传输协议支持的。</p><h3 id="前期设置、引用包和回顾"><a href="#前期设置、引用包和回顾" class="headerlink" title="前期设置、引用包和回顾"></a>前期设置、引用包和回顾</h3><p><em>前期设置</em></p><p>在根目录创建一个<code>.env</code>文件并写入：<br></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ADDR=<span class="number">9000</span></span><br></pre></td></tr></table></figure><p></p><p>我们将TCP端口存储在<code>ADDR</code>这个环境变量中。然后安装下面２个包:</p><p><code>go get github.com/davecgh/go-spew/spew</code>　用来更好的在终端打印我们的区块链结构。</p><p><code>go get github.com/joho/godotenv</code>　用来载入我们的<code>.env</code>文件。</p><p>接下来创建一个空的<code>main.go</code>文件。</p><p><em>引用包</em></p><p>添加如下代码：<br></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"bufio"</span></span><br><span class="line">	<span class="string">"crypto/sha256"</span></span><br><span class="line">	<span class="string">"encoding/hex"</span></span><br><span class="line">	<span class="string">"encoding/json"</span></span><br><span class="line">	<span class="string">"io"</span></span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">	<span class="string">"net"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">	<span class="string">"strconv"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"github.com/davecgh/go-spew/spew"</span></span><br><span class="line">	<span class="string">"github.com/joho/godotenv"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p></p><p><em>回顾</em><br>下面几个函数在之前的文章中已经详细说过了，我们把这些复制过来。</p><p>创建<code>Block</code>结构并声明一个由<code>Block</code>组成的<code>slices</code>变量<code>Blockchain</code>。<br></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Block represents each 'item' in the blockchain</span></span><br><span class="line"><span class="keyword">type</span> Block <span class="keyword">struct</span> &#123;</span><br><span class="line">	Index     <span class="keyword">int</span></span><br><span class="line">	Timestamp <span class="keyword">string</span></span><br><span class="line">	BPM       <span class="keyword">int</span></span><br><span class="line">	Hash      <span class="keyword">string</span></span><br><span class="line">	PrevHash  <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Blockchain is a series of validated Blocks</span></span><br><span class="line"><span class="keyword">var</span> Blockchain []Block</span><br></pre></td></tr></table></figure><p></p><p>接下来是创建区块需要的Hash函数：<br></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SHA256 hashing</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">calculateHash</span><span class="params">(block Block)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	record := <span class="keyword">string</span>(block.Index) + block.Timestamp + <span class="keyword">string</span>(block.BPM) + block.PrevHash</span><br><span class="line">	h := sha256.New()</span><br><span class="line">	h.Write([]<span class="keyword">byte</span>(record))</span><br><span class="line">	hashed := h.Sum(<span class="literal">nil</span>)</span><br><span class="line">	<span class="keyword">return</span> hex.EncodeToString(hashed)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>区块生成函数：<br></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create a new block using previous block's hash</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">generateBlock</span><span class="params">(oldBlock Block, BPM <span class="keyword">int</span>)</span> <span class="params">(Block, error)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> newBlock Block</span><br><span class="line"></span><br><span class="line">	t := time.Now()</span><br><span class="line"></span><br><span class="line">	newBlock.Index = oldBlock.Index + <span class="number">1</span></span><br><span class="line">	newBlock.Timestamp = t.String()</span><br><span class="line">	newBlock.BPM = BPM</span><br><span class="line">	newBlock.PrevHash = oldBlock.Hash</span><br><span class="line">	newBlock.Hash = calculateHash(newBlock)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> newBlock, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>验证函数：<br></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// make sure block is valid by checking index, and comparing the hash of the previous block</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isBlockValid</span><span class="params">(newBlock, oldBlock Block)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> oldBlock.Index+<span class="number">1</span> != newBlock.Index &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> oldBlock.Hash != newBlock.PrevHash &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> calculateHash(newBlock) != newBlock.Hash &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>确保最长的链是主链：<br></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// make sure the chain we're checking is longer than the current blockchain</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">replaceChain</span><span class="params">(newBlocks []Block)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(newBlocks) &gt; <span class="built_in">len</span>(Blockchain) &#123;</span><br><span class="line">		Blockchain = newBlocks</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>现在我们已经把和区块相关的函数复制过来并且剥离了和HTTP相关的函数，接下来处理网络部分。</p><h3 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h3><p>现在我们来设置网络，可以通过这个来进行区块分发，并把其加入到区块链并把新区块链广播回网络中。</p><p>首先我们在其他结构体声明位置下面声明一个全局变量<code>bcServer</code>(short for blockchain server)，这是一个<code>channel</code>用来接收传入的区块。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bcServer handles incoming concurrent Blocks</span></span><br><span class="line"><span class="keyword">var</span> bcServer <span class="keyword">chan</span> []Block</span><br></pre></td></tr></table></figure><p><em>题外话：channel是GO语言中最流行的一个特性，准许我们优雅的进行数据读写，经常用来解决数据竞争问题。当和go routines同时使用时将十分强大，因为多个go　routines可以写入同一个channel。在Java或者类c语言中，你不得不通过互斥锁来控制数据的写入。尽管GO中也有互斥锁，但channel让这些变得简单。更多相关可以看<a href="https://golangbot.com/channels/" target="_blank" rel="noopener">这里</a>。</em></p><p>接下来编写main函数并从<code>.env</code>文件中载入环境变量，记住我们将在晚一些使用环境变量<code>ADDR</code>9090作为TCP端口使用。同样，在main函数中初始化<code>bcServer</code>：<br></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	err := godotenv.Load()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	bcServer = <span class="built_in">make</span>(<span class="keyword">chan</span> []Block)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// create genesis block</span></span><br><span class="line">	t := time.Now()</span><br><span class="line">	genesisBlock := Block&#123;<span class="number">0</span>, t.String(), <span class="number">0</span>, <span class="string">""</span>, <span class="string">""</span>&#125;</span><br><span class="line">	spew.Dump(genesisBlock)</span><br><span class="line">	Blockchain = <span class="built_in">append</span>(Blockchain, genesisBlock)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>接下来编写TCP服务，你可以认为这个和HTTP十分类似，但没有浏览器支持。所有的数据传输都通过终端进行，并且能处理多个连接。<br>添加如下代码:<br></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// start TCP and serve TCP server</span></span><br><span class="line">server, err := net.Listen(<span class="string">"tcp"</span>, <span class="string">":"</span>+os.Getenv(<span class="string">"ADDR"</span>))</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  log.Fatal(err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> server.Close()</span><br></pre></td></tr></table></figure><p></p><p>这里监听9090端口，并且<code>defer server.Close()</code>是很重要的，当我们不再需要连接后可以简洁的断开。关于<code>defer</code>可以看<a href="https://blog.golang.org/defer-panic-and-recover" target="_blank" rel="noopener">这里</a>。</p><p>当每次有新的连接请求时我们都需要创建一个新的连接来处理，添加如下代码：<br></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">  conn, err := server.Accept()</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    log.Fatal(err)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">go</span> handleConn(conn)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>我们创建了一个死循环用来处理连接，并且通过<code>go handleConn(conn)</code>并发的处理每一个连接，所以没阻塞<code>for</code>循环。这也是能够并发处理连接的原因。</p><p>细心的读者可能发现了，我们并没有<code>handleConn</code>函数，别急，先看看完整的<code>main</code>函数：<br></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	err := godotenv.Load()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	bcServer = <span class="built_in">make</span>(<span class="keyword">chan</span> []Block)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// create genesis block</span></span><br><span class="line">	t := time.Now()</span><br><span class="line">	genesisBlock := Block&#123;<span class="number">0</span>, t.String(), <span class="number">0</span>, <span class="string">""</span>, <span class="string">""</span>&#125;</span><br><span class="line">	spew.Dump(genesisBlock)</span><br><span class="line">	Blockchain = <span class="built_in">append</span>(Blockchain, genesisBlock)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// start TCP and serve TCP server</span></span><br><span class="line">	server, err := net.Listen(<span class="string">"tcp"</span>, <span class="string">":"</span>+os.Getenv(<span class="string">"ADDR"</span>))</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> server.Close()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		conn, err := server.Accept()</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Fatal(err)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">go</span> handleConn(conn)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>下面编写<code>handleConn</code>函数，这个函数接受一个<code>net.Conn</code>类型的接口作为参数。接口非常神奇，在我看来，接口让GO和其他类Ｃ语言产生本质区别。并发和go routines得到了大量关注，但接口才是最强大的特性。如果你目前不使用接口，那么尽快的熟悉它，接口将助你成为GO大神。</p><p>首先创建一个骨架并且加入<code>defer</code>语句来关闭连接：<br></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handleConn</span><span class="params">(conn net.Conn)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> conn.Close()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>现在我们需要准许客户端添加区块到区块链中，我们还以BPM为例，需要：</p><ul><li>提示客户端输入BPM值</li><li>使用<code>stdin</code>获取输入值</li><li>使用之前的<code>generateBlock</code>、<code>isBlockValid</code>和<code>replaceChain</code>创建新区块</li><li>将新区块链放入channel中，以便向网络中广播</li><li>准许客户端输入新的BPM</li></ul><p>代码如下：<br></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">io.WriteString(conn, <span class="string">"Enter a new BPM:"</span>)</span><br><span class="line"></span><br><span class="line">scanner := bufio.NewScanner(conn)</span><br><span class="line"></span><br><span class="line"><span class="comment">// take in BPM from stdin and add it to blockchain after conducting necessary validation</span></span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> scanner.Scan() &#123;</span><br><span class="line">		bpm, err := strconv.Atoi(scanner.Text())</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Printf(<span class="string">"%v not a number: %v"</span>, scanner.Text(), err)</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		&#125;</span><br><span class="line">		newBlock, err := generateBlock(Blockchain[<span class="built_in">len</span>(Blockchain)<span class="number">-1</span>], bpm)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Println(err)</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> isBlockValid(newBlock, Blockchain[<span class="built_in">len</span>(Blockchain)<span class="number">-1</span>]) &#123;</span><br><span class="line">			newBlockchain := <span class="built_in">append</span>(Blockchain, newBlock)</span><br><span class="line">			replaceChain(newBlockchain)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		bcServer &lt;- Blockchain</span><br><span class="line">		io.WriteString(conn, <span class="string">"\nEnter a new BPM:"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure><p></p><p>我们创建了一个新的scanner，<code>for scanner.Scan()</code>是阻塞调用，所以我们把他放到go routines中以便支持并发处理连接。并且将字符串转换为整数，完成区块生成和验证后，我们创建了含有新区块的区块链。</p><p><code>bcServer &lt;- Blockchain</code>这句是把新区块链加入到channel中，接下来我们提示客户端输入新的BPM来创建新区块。</p><p><em>广播</em></p><p>我们需要将新区块链广播给所有建立连接的客户端，由于我们仅仅是在一台电脑上进行测试，我们将模拟数据传递到客户端的过程。在<code>handleConn</code>函数的最后一行，我们需要做：</p><ul><li>将区块链转换成JSON格式方便阅读</li><li>将新区块链写到每个建立了连接的客户端</li><li>设置一个计时器定期执行，这样我们就不会被数据淹没了。这在区块链网络中很常见，每隔Ｘ分钟新区块链被广播一次。这里我们设定３０秒。</li><li>在第一个终端中优雅的打印主链，这样我们就可以知道发生了什么并且确保其他节点产生的区块被正常添加到了主链中。</li></ul><p>代码如下：<br></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// simulate receiving broadcast</span></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">for</span> &#123;</span><br><span class="line">			time.Sleep(<span class="number">30</span> * time.Second)</span><br><span class="line">			output, err := json.Marshal(Blockchain)</span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">				log.Fatal(err)</span><br><span class="line">			&#125;</span><br><span class="line">			io.WriteString(conn, <span class="keyword">string</span>(output))</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> _ = <span class="keyword">range</span> bcServer &#123;</span><br><span class="line">		spew.Dump(Blockchain)</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure><p></p><p>一切都完成了！完整代码在<a href="https://github.com/mycoralhealth/blockchain-tutorial/blob/master/networking/main.go" target="_blank" rel="noopener">这里</a>。</p><h2 id="娱乐时间"><a href="#娱乐时间" class="headerlink" title="娱乐时间"></a>娱乐时间</h2><p>让我们来试试，执行<code>go run main.go</code>:</p><p><img src="http://mypic-1252424367.coshk.myqcloud.com/bk22.png" alt="bk2"></p><p>正如预料之中的，我们看到了创世块并且启动了一个TCP服务监听9000端口。</p><p>接下来启动一个新终端并使用命令<code>nc localhost 9000</code>建立连接，你可以创建多个终端执行这个命令几次。输入BPM，并且我们可以在第一个终端看到新区块已经被添加了！</p><p><img src="http://mypic-1252424367.coshk.myqcloud.com/bk23.png" alt="bk3"></p><p><img src="http://mypic-1252424367.coshk.myqcloud.com/bk24.png" alt="bk4"></p><p>等待３０秒，查看另一个终端，你将看到新区块链被广播到所有建立了连接的终端中了，即便这个终端没输入过BPM！</p><p><img src="http://mypic-1252424367.coshk.myqcloud.com/bk25.png" alt="bk5"></p><h2 id="接下来"><a href="#接下来" class="headerlink" title="接下来"></a>接下来</h2><p>恭喜！你不仅仅创建了区块链还为其添加了网络功能，接下来你还可以：</p><ul><li>在本地创建一个更大的网络，复制代码到不同的目录并且更换不同的端口，对于每个终端都可以互相连接并读写数据。</li><li>在多个端口实现数据流，这是另一个文章的主题了。</li></ul><p>这就是完整的区块链网络，它接收数据并且广播数据到外部。挖矿时在同一个终端中实现这两者是十分高效的。</p><ul><li>如果你想和朋友一起测试这个程序，把它部署到云服务器上让你的朋友连接并发送数据即可。这里会有些额外的安全问题，如果有需要我们会专门写篇教程。</li></ul><p>你已经近距离的了解了关于区块链的几个概念，这里我们强烈建议你去阅读一些共识算法，比如POW或者POS。</p><p>或者……等我们的下一篇文章:-)</p></div></div><div id="post-footer" class="post-footer main-content-wrap"><div class="post-footer-tags"><span class="text-color-light text-small">标签</span><br><a class="tag tag--primary tag--small t-link" href="/source/all-tags/go/">go</a> <a class="tag tag--primary tag--small t-link" href="/source/all-tags/区块链/">区块链</a></div><div class="post-actions-wrap"><nav><ul class="post-actions post-action-nav"><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/2018/05/22/GO语言学习笔记-接口1/" data-tooltip="GO语言学习笔记-接口1"><i class="fa fa-angle-left"></i> <span class="hide-xs hide-sm text-small icon-ml">上一篇</span></a></li><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/2018/05/18/200行GO代码实现区块链1/" data-tooltip="200行GO代码实现区块链1"><span class="hide-xs hide-sm text-small icon-mr">下一篇</span> <i class="fa fa-angle-right"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions"><i class="fa fa-share-alt"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://www.hi-roy.com/2018/05/21/200行GO代码实现区块链2/"><i class="fa fa-facebook-official"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://www.hi-roy.com/2018/05/21/200行GO代码实现区块链2/"><i class="fa fa-twitter"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://www.hi-roy.com/2018/05/21/200行GO代码实现区块链2/"><i class="fa fa-google-plus"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://service.weibo.com/share/share.php?&amp;title=http://www.hi-roy.com/2018/05/21/200行GO代码实现区块链2/"><i class="fa fa-weibo"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.hi-roy.com/2018/05/21/200行GO代码实现区块链2/&amp;title=200行GO代码实现区块链2"><i class="fa fa-qq"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://www.hi-roy.com/2018/05/21/200行GO代码实现区块链2/"><i class="fa fa-star"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://widget.renren.com/dialog/share?resourceUrl=http://www.hi-roy.com/2018/05/21/200行GO代码实现区块链2/"><i class="fa fa-renren"></i></a></li><li class="post-action"><a class="post-action-btn btn btn--default" href="#"><i class="fa fa-list"></i></a></li></ul></div></div></article><footer id="footer" class="main-content-wrap"><span class="copyrights">Copyrights &copy; 2019 Roy. All Rights Reserved.</span></footer></div><div id="bottom-bar" class="post-bottom-bar" data-behavior="4"><div class="post-actions-wrap"><nav><ul class="post-actions post-action-nav"><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/2018/05/22/GO语言学习笔记-接口1/" data-tooltip="GO语言学习笔记-接口1"><i class="fa fa-angle-left"></i> <span class="hide-xs hide-sm text-small icon-ml">上一篇</span></a></li><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/2018/05/18/200行GO代码实现区块链1/" data-tooltip="200行GO代码实现区块链1"><span class="hide-xs hide-sm text-small icon-mr">下一篇</span> <i class="fa fa-angle-right"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions"><i class="fa fa-share-alt"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://www.hi-roy.com/2018/05/21/200行GO代码实现区块链2/"><i class="fa fa-facebook-official"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://www.hi-roy.com/2018/05/21/200行GO代码实现区块链2/"><i class="fa fa-twitter"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://www.hi-roy.com/2018/05/21/200行GO代码实现区块链2/"><i class="fa fa-google-plus"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://service.weibo.com/share/share.php?&amp;title=http://www.hi-roy.com/2018/05/21/200行GO代码实现区块链2/"><i class="fa fa-weibo"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.hi-roy.com/2018/05/21/200行GO代码实现区块链2/&amp;title=200行GO代码实现区块链2"><i class="fa fa-qq"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://www.hi-roy.com/2018/05/21/200行GO代码实现区块链2/"><i class="fa fa-star"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://widget.renren.com/dialog/share?resourceUrl=http://www.hi-roy.com/2018/05/21/200行GO代码实现区块链2/"><i class="fa fa-renren"></i></a></li><li class="post-action"><a class="post-action-btn btn btn--default" href="#"><i class="fa fa-list"></i></a></li></ul></div></div><div id="share-options-bar" class="share-options-bar" data-behavior="4"><i id="btn-close-shareoptions" class="fa fa-close"></i><ul class="share-options"><li class="share-option"><a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://www.hi-roy.com/2018/05/21/200行GO代码实现区块链2/"><i class="fa fa-facebook-official"></i><span>分享到 Facebook</span></a></li><li class="share-option"><a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=http://www.hi-roy.com/2018/05/21/200行GO代码实现区块链2/"><i class="fa fa-twitter"></i><span>分享到 Twitter</span></a></li><li class="share-option"><a class="share-option-btn" target="new" href="https://plus.google.com/share?url=http://www.hi-roy.com/2018/05/21/200行GO代码实现区块链2/"><i class="fa fa-google-plus"></i><span>分享到 Google+</span></a></li><li class="share-option"><a class="share-option-btn" target="new" href="http://service.weibo.com/share/share.php?&amp;title=http://www.hi-roy.com/2018/05/21/200行GO代码实现区块链2/"><i class="fa fa-weibo"></i><span>分享到 Weibo</span></a></li><li class="share-option"><a class="share-option-btn" target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.hi-roy.com/2018/05/21/200行GO代码实现区块链2/&amp;title=200行GO代码实现区块链2"><i class="fa fa-qq"></i><span>分享到 QQ</span></a></li><li class="share-option"><a class="share-option-btn" target="new" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://www.hi-roy.com/2018/05/21/200行GO代码实现区块链2/"><i class="fa fa-star"></i><span>分享到 Qzone</span></a></li><li class="share-option"><a class="share-option-btn" target="new" href="http://widget.renren.com/dialog/share?resourceUrl=http://www.hi-roy.com/2018/05/21/200行GO代码实现区块链2/"><i class="fa fa-renren"></i><span>分享到 Renren</span></a></li></ul></div></div><div id="about"><div id="about-card"><div id="about-btn-close"><i class="fa fa-remove"></i></div><img id="about-card-picture" src="/assets/images/my.jpg" alt="作者的图片"><h4 id="about-card-name">Roy</h4><div id="about-card-bio"><p>君以国士待我，我必以国士报君。</p></div><div id="about-card-job"><i class="fa fa-briefcase"></i><br><p>野生程序猿</p></div><div id="about-card-location"><i class="fa fa-map-marker"></i><br>China</div></div></div><div id="algolia-search-modal" class="modal-container"><div class="modal"><div class="modal-header"><span class="close-button"><i class="fa fa-close"></i></span> <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled"><span class="searchby-algolia-text text-color-light text-small">by</span> <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg"> </a><i class="search-icon fa fa-search"></i><form id="algolia-search-form"><input type="text" id="algolia-search-input" name="search" class="form-control input--large search-input" placeholder="Search "></form></div><div class="modal-body"><div class="no-result text-color-light text-center">没有找到文章</div><div class="results"><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/02/12/Ubuntu下Gogant的简易破墙术/"><h3 class="media-heading">Ubuntu下Gogant的简易破墙术</h3></a><span class="media-meta"><span class="media-date text-small">2013年2月12日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/10/31/python常用第三方库-转载/"><h3 class="media-heading">Python常用第三方库(转载)</h3></a><span class="media-meta"><span class="media-date text-small">2013年10月31日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/fedora19安装ar8161网卡驱动/"><h3 class="media-heading">fedora19安装ar8161网卡驱动</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/fedora19源，rpmforge，fastestmirror/"><h3 class="media-heading">fedora19源，rpmforge，fastestmirror</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/python中如何自定义解析域名/"><h3 class="media-heading">python中如何自定义解析域名</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/django版本更换/"><h3 class="media-heading">django版本更换</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/django-groundwork个人1-5-3修改版/"><h3 class="media-heading">django-groundwork个人1.5.3修改版</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/fedora19美化/"><h3 class="media-heading">fedora19美化</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/装饰器/"><h3 class="media-heading">装饰器</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div><div class="media"><div class="media-body"><a class="link-unstyled" href="http://www.hi-roy.com/2013/11/01/SVN常用操作/"><h3 class="media-heading">SVN常用操作</h3></a><span class="media-meta"><span class="media-date text-small">2013年11月1日</span></span><div class="media-content hide-xs font-merryweather"></div></div><div style="clear:both"></div><hr></div></div></div><div class="modal-footer"><p class="results-count text-medium" data-message-zero="没有找到文章" data-message-one="找到 1 篇文章" data-message-other="找到 {n} 篇文章">找到 222 篇文章</p></div></div></div><div id="cover" style="background-image:url(/assets/images/cover.jpg)"></div><script src="/assets/js/script-ivwiy10zeb8fifc4swnhkwneuk64y53w2scmdmtp8thi9cqfxh31aowtroaz.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.14.1/moment-with-locales.min.js"></script><script src="//cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script><script>var algoliaClient=algoliasearch("51U8PIBLP6","16909d9ce1780cda71113841864e7aa8"),algoliaIndex=algoliaClient.initIndex("my-blog")</script></body></html>